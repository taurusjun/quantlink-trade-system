# QuantlinkTrader Live Trading Configuration File
# 实盘交易配置 - 生产环境专用
# 使用方法: ./bin/trader -config config/trader.live.yaml

# ═══════════════════════════════════════════════════════════
# System Configuration
# ═══════════════════════════════════════════════════════════
system:
  mode: "live"                          # 运行模式: live
  multi_strategy: true                  # 启用多策略模式

# ═══════════════════════════════════════════════════════════
# Strategy Configuration (Multi-Strategy Mode)
# ═══════════════════════════════════════════════════════════
strategies:
  # 策略1: 白银配对套利 (ag2603/ag2605)
  - id: "live_ag_spread"                # 策略唯一标识符（白银）
    type: "pairwise_arb"                # 策略类型: pairwise_arb
    enabled: true                       # 是否启用此策略
    allocation: 0.5                     # 资金分配比例 (50%)
    symbols:                            # 交易品种（配对交易需要两个）
      - "ag2603"                        # 白银 2026年3月
      - "ag2605"                        # 白银 2026年5月
    exchanges:                          # 交易所
      - "SHFE"                          # 上期所
    max_position_size: 20               # 最大持仓数量（实盘：更保守）
    max_exposure: 200000.0              # 最大风险敞口（20万）

    # Strategy-specific parameters (策略特定参数)
    parameters:
      spread_type: "difference"         # 价差类型: difference, ratio, log
      lookback_period: 20.0             # 回看周期（测试：20个数据点，约20秒）
      entry_zscore: 1.5                 # 入场Z-Score阈值（测试：降低阈值）
      exit_zscore: 0.8                  # 出场Z-Score阈值（实盘：更高出场）
      order_size: 2.0                   # 每条腿的下单数量（实盘：2手）
      min_correlation: 0.7              # 最小相关系数（实盘：要求高相关性）
      slippage_ticks: 2                 # 滑点（tick数）
      use_market_price: false           # 使用对手价（实盘建议false，使用限价单）

  # 策略2: 黄金配对套利 (au2604/au2606)
  - id: "live_au_spread"                # 策略唯一标识符（黄金）
    type: "pairwise_arb"                # 策略类型: pairwise_arb
    enabled: true                       # 是否启用此策略
    allocation: 0.5                     # 资金分配比例 (50%)
    symbols:                            # 交易品种（配对交易需要两个）
      - "au2604"                        # 黄金 2026年4月
      - "au2606"                        # 黄金 2026年6月
    exchanges:                          # 交易所
      - "SHFE"                          # 上期所
    max_position_size: 10               # 最大持仓数量（黄金价格高，数量更少）
    max_exposure: 300000.0              # 最大风险敞口（30万）

    # Strategy-specific parameters (策略特定参数)
    parameters:
      spread_type: "difference"         # 价差类型: difference, ratio, log
      lookback_period: 200.0            # 回看周期（实盘：更长周期）
      entry_zscore: 2.8                 # 入场Z-Score阈值（黄金波动小，阈值更高）
      exit_zscore: 0.8                  # 出场Z-Score阈值
      order_size: 1.0                   # 每条腿的下单数量（实盘：1手）
      min_correlation: 0.75             # 最小相关系数（黄金要求更高）
      slippage_ticks: 1                 # 滑点（tick数，黄金tick小）
      use_market_price: false           # 使用对手价

# ═══════════════════════════════════════════════════════════
# Instrument Specifications (品种规格配置)
# ═══════════════════════════════════════════════════════════
instruments:
  ag2603:
    tick_size: 1.0                      # 最小变动价位：1元/千克
    contract_multiplier: 15             # 合约乘数：15千克/手
    exchange: "SHFE"
  ag2605:
    tick_size: 1.0                      # 最小变动价位：1元/千克
    contract_multiplier: 15             # 合约乘数：15千克/手
    exchange: "SHFE"
  au2604:
    tick_size: 0.02                     # 最小变动价位：0.02元/克
    contract_multiplier: 1000           # 合约乘数：1000克/手
    exchange: "SHFE"
  au2606:
    tick_size: 0.02                     # 最小变动价位：0.02元/克
    contract_multiplier: 1000           # 合约乘数：1000克/手
    exchange: "SHFE"

# ═══════════════════════════════════════════════════════════
# Trading Session Configuration (交易时段配置)
# ═══════════════════════════════════════════════════════════
session:
  start_time: "00:00:00"                # 开始时间（全天交易）
  end_time: "23:59:59"                  # 结束时间（全天交易）
  timezone: "Asia/Shanghai"             # 时区
  auto_start: true                      # 自动启动Session Manager
  auto_stop: false                      # 自动停止策略（测试：禁用）
  auto_activate: false                  # 自动激活策略 - false时需要手动激活（推荐）

  # 夜盘配置（可选）
  night_session:
    enabled: true                       # 启用夜盘
    start_time: "20:55:00"              # 夜盘开始
    end_time: "02:35:00"                # 夜盘结束（次日凌晨）

# ═══════════════════════════════════════════════════════════
# Risk Management Configuration (风险管理配置)
# ═══════════════════════════════════════════════════════════
risk:
  max_drawdown: 50000.0                 # 最大回撤限制（5万）
  stop_loss: 80000.0                    # 止损金额（8万）
  max_loss: 150000.0                    # 最大亏损限制（15万）
  daily_loss_limit: 100000.0            # 每日亏损限制（10万）
  max_reject_count: 20                  # 最大拒单次数
  check_interval_ms: 100                # 风险检查间隔（毫秒）

  # 实盘专用风控
  max_position_value: 500000.0          # 最大持仓市值（50万）
  max_single_order_value: 100000.0      # 单笔订单最大市值（10万）
  enable_position_check: true           # 启用持仓检查
  enable_emergency_stop: true           # 启用紧急停止

# ═══════════════════════════════════════════════════════════
# Strategy Engine Configuration (策略引擎配置)
# ═══════════════════════════════════════════════════════════
engine:
  ors_gateway_addr: "localhost:50052"   # 订单路由服务地址
  counter_bridge_addr: "localhost:8080" # Counter Bridge地址（持仓查询）
  nats_addr: "nats://localhost:4222"    # NATS 消息队列地址
  order_queue_size: 100                 # 订单队列大小
  timer_interval: 5s                    # 定时器间隔
  max_concurrent_orders: 10             # 最大并发订单数
  order_timeout_sec: 30                 # 订单超时时间（秒）

  # 实盘专用配置
  enable_position_sync: true            # 启用持仓同步
  position_sync_interval_sec: 60        # 持仓同步间隔（秒）
  enable_order_validation: true         # 启用订单验证

# ═══════════════════════════════════════════════════════════
# Portfolio Management Configuration (组合管理配置)
# ═══════════════════════════════════════════════════════════
portfolio:
  total_capital: 500000.0               # 总资金（50万）
  strategy_allocation:                  # 策略资金分配
    "live_ag_spread": 0.5               # 50% 分配给白银策略
    "live_au_spread": 0.5               # 50% 分配给黄金策略
  rebalance_interval_sec: 7200          # 再平衡间隔（2小时）
  min_allocation: 0.10                  # 最小分配比例（10%）
  max_allocation: 0.60                  # 最大分配比例（60%）
  enable_auto_rebalance: false          # 启用自动再平衡（实盘建议关闭）
  enable_correlation_calc: true         # 启用相关性计算

# ═══════════════════════════════════════════════════════════
# API Configuration (API配置)
# ═══════════════════════════════════════════════════════════
api:
  enabled: true                         # 启用 HTTP REST API
  port: 9201                            # API 端口
  host: "localhost"                     # API 绑定地址（实盘：只监听本地）

  # 实盘专用
  enable_auth: false                    # 启用认证（TODO: 后续实现）
  read_timeout_sec: 30                  # 读取超时
  write_timeout_sec: 30                 # 写入超时

# ═══════════════════════════════════════════════════════════
# Logging Configuration (日志配置)
# ═══════════════════════════════════════════════════════════
logging:
  level: "info"                         # 日志级别: info（实盘不用debug）
  file: "./log/trader.live.log"         # 日志文件路径（实盘专用）
  max_size_mb: 200                      # 日志文件最大大小（实盘：更大）
  max_backups: 30                       # 保留的旧日志文件数量（实盘：更多）
  max_age_days: 90                      # 日志文件保留天数（实盘：90天）
  compress: true                        # 压缩旧日志文件
  console: true                         # 同时输出到控制台
  json_format: false                    # 使用 JSON 格式

  # 实盘专用日志
  trade_log:
    enabled: true                       # 启用交易日志
    file: "./log/trades.live.log"       # 交易日志文件
  position_log:
    enabled: true                       # 启用持仓日志
    file: "./log/positions.live.log"    # 持仓日志文件

# ═══════════════════════════════════════════════════════════
# Model Files (策略参数文件)
# ═══════════════════════════════════════════════════════════
models:
  live_ag_spread: "./golang/models/model.live_ag_spread.txt"
  live_au_spread: "./golang/models/model.live_au_spread.txt"
