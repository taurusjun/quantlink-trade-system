# QuantlinkTrader ç³»ç»Ÿç¼–è¯‘éƒ¨ç½²å¯åŠ¨å®Œæ•´æŒ‡å—

**æ–‡æ¡£æ—¥æœŸ**: 2026-01-24
**ç‰ˆæœ¬**: v1.0
**é€‚ç”¨ç¯å¢ƒ**: macOS / Linux

---

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
2. [âš¡ å¿«é€Ÿéƒ¨ç½²ï¼ˆä¸€é”®ç¼–è¯‘æ‰“åŒ…ï¼‰](#å¿«é€Ÿéƒ¨ç½²ä¸€é”®ç¼–è¯‘æ‰“åŒ…) â­ æ¨è
3. [ä»é›¶å¼€å§‹ç¼–è¯‘](#ä»é›¶å¼€å§‹ç¼–è¯‘)
4. [æœ¬åœ°æµ‹è¯•éªŒè¯](#æœ¬åœ°æµ‹è¯•éªŒè¯)
5. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
6. [ç³»ç»Ÿå¯åŠ¨ä¸ç›‘æ§](#ç³»ç»Ÿå¯åŠ¨ä¸ç›‘æ§)
7. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ç¯å¢ƒå‡†å¤‡

### å‰ç½®ä¾èµ–

#### å¿…éœ€å·¥å…·

| å·¥å…· | æœ€ä½ç‰ˆæœ¬ | ç”¨é€” | å®‰è£…å‘½ä»¤ (macOS) |
|------|---------|------|-----------------|
| **Go** | 1.19+ | Golang ç¼–è¯‘ | `brew install go` |
| **CMake** | 3.15+ | C++ æ„å»ºç³»ç»Ÿ | `brew install cmake` |
| **protoc** | 3.21+ | Protobuf ç¼–è¯‘å™¨ | `brew install protobuf` |
| **gRPC** | latest | RPC æ¡†æ¶ | `brew install grpc` |
| **NATS Server** | latest | æ¶ˆæ¯é˜Ÿåˆ— | `brew install nats-server` |
| **NATS C Client** | latest | C++ NATS å®¢æˆ·ç«¯ | `brew install nats-c` |

#### Golang æ’ä»¶

```bash
# Protobuf Go æ’ä»¶
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest

# éªŒè¯å®‰è£…
which protoc-gen-go
which protoc-gen-go-grpc
```

#### éªŒè¯ç¯å¢ƒ

```bash
# æ£€æŸ¥æ‰€æœ‰ä¾èµ–
go version          # åº”æ˜¾ç¤º go1.19 æˆ–æ›´é«˜
cmake --version     # åº”æ˜¾ç¤º 3.15 æˆ–æ›´é«˜
protoc --version    # åº”æ˜¾ç¤º libprotoc 3.21 æˆ–æ›´é«˜
pkg-config --modversion grpc++  # åº”æ˜¾ç¤º gRPC ç‰ˆæœ¬

# æ£€æŸ¥ NATS
nats-server --version
```

### è·å–æºç 

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå‡è®¾ï¼‰
cd ~/PWorks/RD
git clone <repository-url> quantlink-trade-system
cd quantlink-trade-system

# æŸ¥çœ‹é¡¹ç›®ç»“æ„
tree -L 2 -I 'build|bin|log'
```

---

## âš¡ å¿«é€Ÿéƒ¨ç½²ï¼ˆä¸€é”®ç¼–è¯‘æ‰“åŒ…ï¼‰

> **æ¨èæ–¹å¼** â­ å¦‚æœä½ æƒ³å¿«é€Ÿå®Œæˆç¼–è¯‘ã€æ‰“åŒ…ã€éƒ¨ç½²çš„å…¨æµç¨‹ï¼Œä½¿ç”¨æ­¤æ–¹æ³•ã€‚
>
> å¦‚æœä½ æƒ³äº†è§£æ¯ä¸€æ­¥çš„ç»†èŠ‚æˆ–éœ€è¦è‡ªå®šä¹‰é…ç½®ï¼Œè¯·è·³è½¬åˆ°[ä»é›¶å¼€å§‹ç¼–è¯‘](#ä»é›¶å¼€å§‹ç¼–è¯‘)ç« èŠ‚ã€‚

### ä»€ä¹ˆæ˜¯å¿«é€Ÿéƒ¨ç½²ï¼Ÿ

å¿«é€Ÿéƒ¨ç½²è„šæœ¬ (`scripts/quick_deploy.sh`) æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¯ä»¥ï¼š

âœ… **è‡ªåŠ¨æ£€æŸ¥**æ‰€æœ‰ä¾èµ–ç¯å¢ƒ
âœ… **è‡ªåŠ¨ç”Ÿæˆ** Protobuf ä»£ç 
âœ… **è‡ªåŠ¨ç¼–è¯‘** C++ Gateway å’Œ Golang Trader
âœ… **è‡ªåŠ¨æ‰“åŒ…**ç”Ÿæˆéƒ¨ç½²åŒ…ï¼ˆåŒ…å«æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶ã€é…ç½®ã€å¯åŠ¨è„šæœ¬ï¼‰
âœ… **å¯é€‰ä¸Šä¼ **åˆ°è¿œç¨‹æœåŠ¡å™¨

**é€‚ç”¨åœºæ™¯**ï¼š
- å¿«é€Ÿæ„å»ºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²åŒ…
- CI/CD è‡ªåŠ¨åŒ–æ„å»º
- å¼€å‘ç¯å¢ƒå¿«é€Ÿé‡å»º
- ä¸ç†Ÿæ‚‰æ‰‹åŠ¨ç¼–è¯‘æ­¥éª¤çš„ç”¨æˆ·

### ä½¿ç”¨æ–¹æ³•

#### æ–¹å¼ 1: æœ¬åœ°ç¼–è¯‘å¹¶å‡†å¤‡éƒ¨ç½²åŒ…ï¼ˆæœ€å¸¸ç”¨ï¼‰

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# ä¸€é”®ç¼–è¯‘å¹¶å‡†å¤‡éƒ¨ç½²åŒ…
./scripts/quick_deploy.sh
```

**æ‰§è¡Œæµç¨‹**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     QuantlinkTrader ä¸€é”®ç¼–è¯‘æ‰“åŒ…éƒ¨ç½²å·¥å…·                  â•‘
â•‘     å¿«é€Ÿæ„å»ºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²åŒ…                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[1/6] æ£€æŸ¥ä¾èµ–ç¯å¢ƒ...
  âœ“ Go go1.21.0
  âœ“ CMake 3.27.0
  âœ“ protoc libprotoc 24.3
  âœ“ gRPC 1.56.2
  âœ“ æ‰€æœ‰ä¾èµ–å·²å°±ç»ª

[2/6] ç”Ÿæˆ Protobuf ä»£ç ...
  âœ“ Protobuf ä»£ç ç”ŸæˆæˆåŠŸ

[3/6] ç¼–è¯‘ C++ Gateway ç»„ä»¶...
  è¿è¡Œ CMake é…ç½®...
  ç¼–è¯‘ä¸­ï¼ˆä½¿ç”¨ 8 ä¸ª CPU æ ¸å¿ƒï¼‰...
  âœ“ md_simulator
  âœ“ md_gateway
  âœ“ ors_gateway
  âœ“ counter_gateway

[4/6] ç¼–è¯‘ Golang Trader...
  æ›´æ–° Go æ¨¡å—ä¾èµ–...
  ç¼–è¯‘ Trader...
  âœ“ bin/trader (å¤§å°: 19M)

[5/6] å‡†å¤‡éƒ¨ç½²åŒ…...
  å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶...
    âœ“ trader
    âœ“ md_simulator
    âœ“ md_gateway
    âœ“ ors_gateway
    âœ“ counter_gateway
  å¤åˆ¶é…ç½®æ–‡ä»¶...
    âœ“ é…ç½®æ–‡ä»¶
  åˆ›å»ºå¯åŠ¨è„šæœ¬...
    âœ“ start.sh
    âœ“ stop.sh
    âœ“ README.md
  âœ“ éƒ¨ç½²åŒ…å‡†å¤‡å®Œæˆ: deploy/

[6/6] æ‰“åŒ…éƒ¨ç½²åŒ…...
  å‹ç¼©éƒ¨ç½²åŒ…...
  âœ“ quantlink-trader-20260124-162800.tar.gz (å¤§å°: 8.5M)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               ç¼–è¯‘æ‰“åŒ…å®Œæˆï¼                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**ç”Ÿæˆçš„æ–‡ä»¶**:
```
quantlink-trade-system/
â”œâ”€â”€ deploy/                                   # éƒ¨ç½²ç›®å½•
â”‚   â”œâ”€â”€ bin/                                  # æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ trader
â”‚   â”‚   â”œâ”€â”€ md_simulator
â”‚   â”‚   â”œâ”€â”€ md_gateway
â”‚   â”‚   â”œâ”€â”€ ors_gateway
â”‚   â”‚   â””â”€â”€ counter_gateway
â”‚   â”œâ”€â”€ config/                               # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ trader.yaml
â”‚   â”‚   â””â”€â”€ trader.test.yaml
â”‚   â”œâ”€â”€ log/                                  # æ—¥å¿—ç›®å½•ï¼ˆç©ºï¼‰
â”‚   â”œâ”€â”€ start.sh                              # â­ ä¸€é”®å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ stop.sh                               # â­ ä¸€é”®åœæ­¢è„šæœ¬
â”‚   â””â”€â”€ README.md                             # éƒ¨ç½²è¯´æ˜
â”‚
â””â”€â”€ quantlink-trader-20260124-162800.tar.gz  # å‹ç¼©åŒ…
```

#### æ–¹å¼ 2: ç¼–è¯‘å¹¶ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨

```bash
# ç¼–è¯‘ã€æ‰“åŒ…å¹¶å‡†å¤‡ä¸Šä¼ 
./scripts/quick_deploy.sh remote
```

**æ‰§è¡Œæµç¨‹**:
1. å®Œæˆç¼–è¯‘å’Œæ‰“åŒ…ï¼ˆåŒæ–¹å¼ 1ï¼‰
2. æç¤ºè¾“å…¥è¿œç¨‹æœåŠ¡å™¨åœ°å€
3. è‡ªåŠ¨ä¸Šä¼ å‹ç¼©åŒ…åˆ°æœåŠ¡å™¨
4. æ˜¾ç¤ºæœåŠ¡å™¨ç«¯éƒ¨ç½²å‘½ä»¤

**äº¤äº’ç¤ºä¾‹**:
```bash
ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨...

è¾“å…¥è¿œç¨‹æœåŠ¡å™¨åœ°å€ (ä¾‹å¦‚: user@192.168.1.100): user@prod-server
ä¸Šä¼  quantlink-trader-20260124-162800.tar.gz åˆ° user@prod-server:~/
quantlink-trader-20260124-162800.tar.gz    100%   8.5MB   2.1MB/s   00:04

âœ“ ä¸Šä¼ æˆåŠŸ

åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éƒ¨ç½²:
  ssh user@prod-server
  tar xzf quantlink-trader-20260124-162800.tar.gz
  cd deploy
  ./start.sh
```

#### æ–¹å¼ 3: ä»…æœ¬åœ°ç¼–è¯‘ï¼ˆä¸æ‰“åŒ…ï¼‰

```bash
./scripts/quick_deploy.sh local
```

é€‚ç”¨äºå¼€å‘è°ƒè¯•ï¼Œåªç¼–è¯‘ä¸ç”Ÿæˆå‹ç¼©åŒ…ã€‚

### å¿«é€Ÿæµ‹è¯•éƒ¨ç½²åŒ…

#### 1. æœ¬åœ°æµ‹è¯•

```bash
cd deploy

# å¯åŠ¨ NATSï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
nats-server &

# ä¸€é”®å¯åŠ¨æ‰€æœ‰ç»„ä»¶
./start.sh
```

**å¯åŠ¨è¾“å‡º**:
```
å¯åŠ¨ QuantlinkTrader ç³»ç»Ÿ...

å¯åŠ¨è¡Œæƒ…æ¨¡æ‹Ÿå™¨...
  PID: 12345
å¯åŠ¨è¡Œæƒ…ç½‘å…³...
  PID: 12346
å¯åŠ¨è®¢å•è·¯ç”±æœåŠ¡...
  PID: 12347
å¯åŠ¨æ¨¡æ‹Ÿæˆäº¤ç½‘å…³...
  PID: 12348
å¯åŠ¨äº¤æ˜“ç­–ç•¥å¼•æ“...
  PID: 12349

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ‰€æœ‰ç»„ä»¶å·²å¯åŠ¨ï¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æŸ¥çœ‹æ—¥å¿—:
  tail -f log/trader.log

æ¿€æ´»ç­–ç•¥ (éœ€æ‰‹åŠ¨æ‰§è¡Œ):
  curl -X POST http://localhost:9201/api/v1/strategy/activate \
    -H 'Content-Type: application/json' \
    -d '{"strategy_id": "prod_92201"}'

åœæ­¢ç³»ç»Ÿ:
  ./stop.sh
```

#### 2. æ¿€æ´»ç­–ç•¥

```bash
# æ¿€æ´»ç­–ç•¥å¼€å§‹äº¤æ˜“
curl -X POST http://localhost:9201/api/v1/strategy/activate \
  -H 'Content-Type: application/json' \
  -d '{"strategy_id": "prod_92201"}'
```

#### 3. ç›‘æ§è¿è¡Œ

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f log/trader.log

# æŸ¥çœ‹è®¢å•
grep "Order sent" log/trader.log

# æŸ¥çœ‹ç­–ç•¥ç»Ÿè®¡
grep "Stats:" log/trader.log | tail -10
```

#### 4. åœæ­¢ç³»ç»Ÿ

```bash
# ä¸€é”®åœæ­¢æ‰€æœ‰ç»„ä»¶
./stop.sh
```

**åœæ­¢è¾“å‡º**:
```
åœæ­¢ QuantlinkTrader ç³»ç»Ÿ...
  âœ“ md_simulator å·²åœæ­¢
  âœ“ md_gateway å·²åœæ­¢
  âœ“ ors_gateway å·²åœæ­¢
  âœ“ counter_gateway å·²åœæ­¢
  âœ“ trader å·²åœæ­¢
  âœ“ å…±äº«å†…å­˜å·²æ¸…ç†

æ‰€æœ‰ç»„ä»¶å·²åœæ­¢
```

### éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨

#### 1. ä¸Šä¼ éƒ¨ç½²åŒ…

```bash
# æ–¹å¼ 1: ä½¿ç”¨ scp
scp quantlink-trader-20260124-162800.tar.gz user@prod-server:~/

# æ–¹å¼ 2: ä½¿ç”¨ rsync
rsync -avz --progress deploy/ user@prod-server:~/quantlink-trader/
```

#### 2. æœåŠ¡å™¨ç«¯è§£å‹

```bash
# SSH ç™»å½•åˆ°æœåŠ¡å™¨
ssh user@prod-server

# è§£å‹éƒ¨ç½²åŒ…
tar xzf quantlink-trader-20260124-162800.tar.gz
cd deploy

# æ£€æŸ¥æ–‡ä»¶
ls -lh bin/
```

#### 3. è°ƒæ•´ç”Ÿäº§é…ç½®

```bash
# ç¼–è¾‘ç”Ÿäº§é…ç½®
vim config/trader.yaml
```

**å…³é”®é…ç½®æ£€æŸ¥**:
```yaml
system:
  strategy_id: "prod_92201"    # ç”Ÿäº§ç­–ç•¥ ID
  mode: "live"                 # â— ç¡®ä¿æ˜¯ live æ¨¡å¼

session:
  start_time: "09:00:00"
  end_time: "15:00:00"
  auto_activate: false         # â— æ¨èæ‰‹åŠ¨æ¿€æ´»

strategy:
  parameters:
    entry_zscore: 2.0          # â— ä½¿ç”¨ä¿å®ˆé˜ˆå€¼
    exit_zscore: 0.5
```

#### 4. å¯åŠ¨ç³»ç»Ÿ

```bash
# ç¡®ä¿ NATS å·²å¯åŠ¨
nats-server &

# å¯åŠ¨ç³»ç»Ÿ
./start.sh

# æ¿€æ´»ç­–ç•¥ï¼ˆç¡®è®¤é…ç½®åï¼‰
curl -X POST http://localhost:9201/api/v1/strategy/activate \
  -H 'Content-Type: application/json' \
  -d '{"strategy_id": "prod_92201"}'
```

### ä¸æ‰‹åŠ¨ç¼–è¯‘çš„åŒºåˆ«

| ç‰¹æ€§ | å¿«é€Ÿéƒ¨ç½²è„šæœ¬ | æ‰‹åŠ¨ç¼–è¯‘ |
|------|-------------|----------|
| **æ‰§è¡Œæ—¶é—´** | 5-10 åˆ†é’Ÿï¼ˆå…¨è‡ªåŠ¨ï¼‰ | 20-30 åˆ†é’Ÿï¼ˆéœ€æ‰‹åŠ¨æ“ä½œï¼‰ |
| **ä¾èµ–æ£€æŸ¥** | âœ… è‡ªåŠ¨æ£€æŸ¥å¹¶æç¤º | âŒ éœ€æ‰‹åŠ¨éªŒè¯ |
| **é”™è¯¯å¤„ç†** | âœ… è‡ªåŠ¨åœæ­¢å¹¶æ˜¾ç¤ºé”™è¯¯ | âŒ éœ€è‡ªè¡Œæ’æŸ¥ |
| **éƒ¨ç½²åŒ…** | âœ… è‡ªåŠ¨ç”Ÿæˆï¼ˆå«å¯åŠ¨è„šæœ¬ï¼‰ | âŒ éœ€æ‰‹åŠ¨æ”¶é›†æ–‡ä»¶ |
| **é€‚ç”¨åœºæ™¯** | ç”Ÿäº§éƒ¨ç½²ã€å¿«é€Ÿæ„å»º | å­¦ä¹ ã€è°ƒè¯•ã€è‡ªå®šä¹‰ |
| **çµæ´»æ€§** | âš ï¸ æ ‡å‡†æµç¨‹ | âœ… å¯è‡ªå®šä¹‰æ¯ä¸€æ­¥ |

### å¸¸è§é—®é¢˜

#### Q1: è„šæœ¬æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**æ£€æŸ¥æ—¥å¿—**:
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
cat /tmp/cmake.log
cat /tmp/make.log
cat /tmp/go_build.log
```

**å¸¸è§åŸå› **:
- ä¾èµ–æœªå®‰è£…ï¼šæŒ‰ç…§é”™è¯¯æç¤ºå®‰è£…ç¼ºå¤±çš„ä¾èµ–
- æƒé™é—®é¢˜ï¼šç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ `chmod +x scripts/quick_deploy.sh`
- ç«¯å£å ç”¨ï¼šæ¸…ç†æ—§è¿›ç¨‹åé‡è¯•

#### Q2: å¦‚ä½•è‡ªå®šä¹‰éƒ¨ç½²åŒ…å†…å®¹ï¼Ÿ

ç¼–è¾‘ `scripts/quick_deploy.sh` ä¸­çš„ `prepare_deployment()` å‡½æ•°ï¼š

```bash
# æ·»åŠ é¢å¤–çš„æ–‡ä»¶
cp your_file "$DEPLOY_DIR/"

# ä¿®æ”¹å¯åŠ¨è„šæœ¬å†…å®¹
cat > "$DEPLOY_DIR/start.sh" << 'EOFSTART'
# ä½ çš„è‡ªå®šä¹‰å¯åŠ¨é€»è¾‘
EOFSTART
```

#### Q3: ç”Ÿæˆçš„å‹ç¼©åŒ…å¤ªå¤§ï¼Ÿ

å‹ç¼©åŒ…å¤§å°çº¦ 8-10MBï¼ˆå·²å‹ç¼©ï¼‰ï¼Œä¸»è¦æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ã€‚

**ä¼˜åŒ–æ–¹æ³•**:
```bash
# ä½¿ç”¨ strip å‡å°äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°
strip bin/trader
strip gateway/build/*

# æˆ–åœ¨ç¼–è¯‘æ—¶ä¼˜åŒ–
go build -ldflags="-s -w" -o bin/trader cmd/trader/main.go
```

#### Q4: å¯ä»¥è·³è¿‡æŸäº›æ­¥éª¤å—ï¼Ÿ

å¯ä»¥æ³¨é‡Šæ‰ `main()` å‡½æ•°ä¸­ä¸éœ€è¦çš„æ­¥éª¤ï¼š

```bash
main() {
    # ...
    # check_dependencies    # æ³¨é‡Šæ‰è·³è¿‡ä¾èµ–æ£€æŸ¥
    # generate_proto        # æ³¨é‡Šæ‰è·³è¿‡ protobuf ç”Ÿæˆ
    build_gateway
    build_golang
    # ...
}
```

### ä¸‹ä¸€æ­¥

- âœ… ç¼–è¯‘å®Œæˆï¼Ÿç»§ç»­æŸ¥çœ‹ [æœ¬åœ°æµ‹è¯•éªŒè¯](#æœ¬åœ°æµ‹è¯•éªŒè¯)
- âœ… éœ€è¦è¯¦ç»†äº†è§£ç¼–è¯‘è¿‡ç¨‹ï¼ŸæŸ¥çœ‹ [ä»é›¶å¼€å§‹ç¼–è¯‘](#ä»é›¶å¼€å§‹ç¼–è¯‘)
- âœ… å‡†å¤‡ç”Ÿäº§éƒ¨ç½²ï¼ŸæŸ¥çœ‹ [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)

---

## ä»é›¶å¼€å§‹ç¼–è¯‘

### æ­¥éª¤ 1: ç”Ÿæˆ Protobuf ä»£ç 

Protobuf æ˜¯ C++ å’Œ Golang é€šä¿¡çš„åŸºç¡€ï¼Œå¿…é¡»é¦–å…ˆç”Ÿæˆã€‚

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# è¿è¡Œ protobuf ç”Ÿæˆè„šæœ¬
./scripts/generate_proto.sh
```

**é¢„æœŸè¾“å‡º**:
```
[1/3] Generating C++ protobuf code...
âœ“ common.proto
âœ“ market_data.proto
âœ“ order.proto

[2/3] Generating Golang protobuf code...
âœ“ common.proto
âœ“ market_data.proto
âœ“ order.proto

[3/3] Done!
```

**ç”Ÿæˆçš„æ–‡ä»¶**:
- C++: `gateway/build/generated/*.pb.h`, `*.pb.cc`
- Golang: `golang/pkg/proto/*/*.pb.go`

### æ­¥éª¤ 2: ç¼–è¯‘ C++ Gateway

ç¼–è¯‘æ‰€æœ‰ C++ ç½‘å…³ç»„ä»¶ã€‚

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# è¿è¡Œ C++ æ„å»ºè„šæœ¬
./scripts/build_gateway.sh
```

**æ„å»ºè¿‡ç¨‹**:
```
[1/5] Checking dependencies... âœ“
[2/5] Creating build directory...
[3/5] Running CMake...
[4/5] Building...
  - md_simulator      [====] 100%
  - md_gateway        [====] 100%
  - ors_gateway       [====] 100%
  - counter_gateway   [====] 100%
  - md_benchmark      [====] 100%
[5/5] Done!
```

**ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶**:
```
gateway/build/
â”œâ”€â”€ md_simulator       # è¡Œæƒ…æ•°æ®æ¨¡æ‹Ÿå™¨
â”œâ”€â”€ md_gateway         # è¡Œæƒ…ç½‘å…³
â”œâ”€â”€ ors_gateway        # è®¢å•è·¯ç”±æœåŠ¡
â”œâ”€â”€ counter_gateway    # æ¨¡æ‹Ÿæˆäº¤ç½‘å…³
â””â”€â”€ md_benchmark       # æ€§èƒ½æµ‹è¯•å·¥å…·
```

**éªŒè¯ç¼–è¯‘**:
```bash
ls -lh gateway/build/ | grep "^-rwx"
file gateway/build/md_gateway  # åº”æ˜¾ç¤º Mach-O æˆ– ELF å¯æ‰§è¡Œæ–‡ä»¶
```

### æ­¥éª¤ 3: ç¼–è¯‘ Golang Trader

ç¼–è¯‘ Golang ç­–ç•¥äº¤æ˜“ç¨‹åºã€‚

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system/golang

# æ–¹å¼ 1: è¾“å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½• bin/ (æ¨è)
go build -o ../bin/trader cmd/trader/main.go

# æ–¹å¼ 2: ä»é¡¹ç›®æ ¹ç›®å½•æ„å»º
cd /Users/user/PWorks/RD/quantlink-trade-system
go build -C golang -o bin/trader cmd/trader/main.go
```

**éªŒè¯ç¼–è¯‘**:
```bash
ls -lh bin/trader
./bin/trader -version 2>&1 | head -5  # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
```

**é¢„æœŸè¾“å‡º**:
```
bin/trader: Mach-O 64-bit executable arm64
å¤§å°çº¦ 19MB
```

### æ­¥éª¤ 4: ç¼–è¯‘å¯é€‰å·¥å…· (å¯é€‰)

ç¼–è¯‘ç”¨äºå¼€å‘è°ƒè¯•çš„å·¥å…·ç¨‹åºã€‚

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system/golang

# è¡Œæƒ…å®¢æˆ·ç«¯å·¥å…·
go build -o bin/md_client cmd/md_client/main.go

# ORS å®¢æˆ·ç«¯å·¥å…·
go build -o bin/ors_client cmd/ors_client/main.go
```

### ç¼–è¯‘æ€»ç»“

**å®Œæˆåçš„ç›®å½•ç»“æ„**:
```
quantlink-trade-system/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ trader              (19MB) âœ“
â”œâ”€â”€ gateway/build/
â”‚   â”œâ”€â”€ md_simulator        (56KB) âœ“
â”‚   â”œâ”€â”€ md_gateway          (830KB) âœ“
â”‚   â”œâ”€â”€ ors_gateway         (831KB) âœ“
â”‚   â”œâ”€â”€ counter_gateway     (824KB) âœ“
â”‚   â””â”€â”€ md_benchmark        (74KB) âœ“
â””â”€â”€ golang/bin/
    â”œâ”€â”€ md_client           (17MB) âœ“
    â””â”€â”€ ors_client          (17MB) âœ“
```

---

## æœ¬åœ°æµ‹è¯•éªŒè¯

### å¿«é€Ÿæµ‹è¯•ï¼šç«¯åˆ°ç«¯æµ‹è¯•

ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬éªŒè¯æ•´ä¸ªç³»ç»Ÿã€‚

#### 1. å¯åŠ¨ NATS æœåŠ¡

```bash
# åå°å¯åŠ¨ NATS
nats-server &

# éªŒè¯ NATS è¿è¡Œ
lsof -i :4222
```

**é¢„æœŸè¾“å‡º**:
```
COMMAND   PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
nats-ser 1234 user    6u  IPv4  0x...      0t0  TCP *:4222 (LISTEN)
```

#### 2. è¿è¡Œå®Œæ•´é“¾è·¯æµ‹è¯•

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
./test_full_chain.sh
```

**æµ‹è¯•æµç¨‹**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        å®Œæ•´é“¾è·¯ç«¯åˆ°ç«¯æµ‹è¯•                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æµ‹è¯•é“¾è·¯:
  1. md_simulator â†’ å…±äº«å†…å­˜
  2. å…±äº«å†…å­˜ â†’ md_gateway â†’ NATS
  3. NATS â†’ Golang Trader (æ¥æ”¶è¡Œæƒ…)
  4. Golang Strategy â†’ ORS Client (å‘é€è®¢å•)
  5. ORS Gateway â†’ Counter Gateway
  6. Simulated Counter â†’ è®¢å•å›æŠ¥
  7. NATS â†’ Golang Trader (æ¥æ”¶å›æŠ¥)

Layer 1: æ£€æŸ¥NATSæœåŠ¡ âœ“
Layer 2: å¯åŠ¨è¡Œæƒ…æ¨¡æ‹Ÿå™¨ (md_simulator) âœ“
Layer 3: å¯åŠ¨MD Gateway (è¡Œæƒ…ç½‘å…³) âœ“
Layer 4: å¯åŠ¨ORS Gateway (è®¢å•è·¯ç”±) âœ“
Layer 5: å¯åŠ¨Counter Gateway (æ¨¡æ‹Ÿæˆäº¤) âœ“
Layer 6: å¯åŠ¨Golang Trader (ç­–ç•¥å¼•æ“) âœ“

ç­‰å¾… 30 ç§’æ”¶é›†æ•°æ®...
```

#### 3. æ¿€æ´»ç­–ç•¥

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨æ¿€æ´»ç­–ç•¥ï¼Œæˆ–æ‰‹åŠ¨æ¿€æ´»ï¼š

```bash
# ç­‰å¾…ç³»ç»Ÿå¯åŠ¨ï¼ˆçº¦ 5 ç§’ï¼‰
sleep 5

# æ¿€æ´»ç­–ç•¥
curl -X POST http://localhost:9201/api/v1/strategy/activate \
  -H "Content-Type: application/json" \
  -d '{"strategy_id": "test_92201"}'
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "Strategy activated successfully",
  "data": {
    "strategy_id": "test_92201",
    "status": "active"
  }
}
```

#### 4. ç›‘æ§è®¢å•ç”Ÿæˆ

```bash
# å®æ—¶ç›‘æ§è®¢å•
tail -f log/trader.test.log | grep "Order sent"

# æŸ¥çœ‹ç­–ç•¥ç»Ÿè®¡
tail -f log/trader.test.log | grep "Stats:"
```

**é¢„æœŸè¾“å‡º**:
```
2026/01/24 15:20:16 [StrategyEngine] Order sent: test_92201, OrderID: ORD_1769239216860813000, Status: SUCCESS
2026/01/24 15:20:16 [StrategyEngine] Order sent: test_92201, OrderID: ORD_1769239216860825000, Status: SUCCESS
2026/01/24 15:20:22 [StrategyEngine] Order sent: test_92201, OrderID: ORD_1769239222867263000, Status: SUCCESS
...

[PairwiseArb:test_92201] Stats: zscore=0.82 (need Â±0.50), corr=0.998 (need 0.700), ready=true, condMet=true
```

#### 5. éªŒè¯æµ‹è¯•ç»“æœ

```bash
# æŸ¥çœ‹è®¢å•æ•°é‡
grep "Order sent" log/trader.test.log | wc -l

# æŸ¥çœ‹ç­–ç•¥ç›¸å…³æ€§
grep "corr=" log/trader.test.log | tail -10

# åœæ­¢æ‰€æœ‰æµ‹è¯•è¿›ç¨‹
pkill -f md_simulator
pkill -f md_gateway
pkill -f ors_gateway
pkill -f counter_gateway
pkill -f "trader -config"

# æ¸…ç†å…±äº«å†…å­˜
ipcs -m | grep user | awk '{print $2}' | xargs ipcrm -m
```

**æµ‹è¯•é€šè¿‡æ ‡å‡†**:
- âœ… æ‰€æœ‰ç»„ä»¶æˆåŠŸå¯åŠ¨
- âœ… è®¢å•æ•°é‡ > 0
- âœ… ç›¸å…³ç³»æ•° > 0.7
- âœ… æ— é”™è¯¯æ—¥å¿—

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æ–¹å¼ 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

#### 1. å‡†å¤‡éƒ¨ç½²åŒ…

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# ç”Ÿæˆéƒ¨ç½²åŒ…
./scripts/prepare_deploy.sh

# æˆ–æŒ‡å®šè¾“å‡ºç›®å½•
./scripts/prepare_deploy.sh production_deploy
```

**ç”Ÿæˆçš„éƒ¨ç½²åŒ…ç»“æ„**:
```
deploy/
â”œâ”€â”€ bin/                      # æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ trader
â”‚   â”œâ”€â”€ md_simulator
â”‚   â”œâ”€â”€ md_gateway
â”‚   â”œâ”€â”€ ors_gateway
â”‚   â””â”€â”€ counter_gateway
â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ trader.yaml
â”‚   â””â”€â”€ trader.test.yaml
â”œâ”€â”€ log/                      # æ—¥å¿—ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ start.sh                  # å¯åŠ¨è„šæœ¬
â””â”€â”€ stop.sh                   # åœæ­¢è„šæœ¬
```

#### 2. æ‰“åŒ…éƒ¨ç½²åŒ…

```bash
# å‹ç¼©éƒ¨ç½²åŒ…
tar czf quantlink-trader-$(date +%Y%m%d).tar.gz deploy/

# æŸ¥çœ‹å‹ç¼©åŒ…å¤§å°
ls -lh quantlink-trader-*.tar.gz
```

#### 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# é€šè¿‡ SCP ä¸Šä¼ 
scp quantlink-trader-20260124.tar.gz user@production-server:~/

# æˆ–é€šè¿‡ rsync åŒæ­¥
rsync -avz --progress deploy/ user@production-server:~/quantlink-trader/
```

#### 4. æœåŠ¡å™¨ç«¯éƒ¨ç½²

```bash
# SSH ç™»å½•åˆ°æœåŠ¡å™¨
ssh user@production-server

# è§£å‹éƒ¨ç½²åŒ…
tar xzf quantlink-trader-20260124.tar.gz
cd deploy

# æ£€æŸ¥æ–‡ä»¶æƒé™
chmod +x bin/*
chmod +x *.sh

# éªŒè¯å¯æ‰§è¡Œæ–‡ä»¶
ls -lh bin/
```

### æ–¹å¼ 2: æ‰‹åŠ¨éƒ¨ç½²

#### 1. åˆ›å»ºéƒ¨ç½²ç›®å½•

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
ssh user@production-server "mkdir -p ~/quantlink-trader/{bin,config,log}"
```

#### 2. ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶

```bash
# ä¸Šä¼  Golang ç¨‹åº
scp bin/trader user@production-server:~/quantlink-trader/bin/

# ä¸Šä¼  C++ Gateway
scp gateway/build/md_simulator user@production-server:~/quantlink-trader/bin/
scp gateway/build/md_gateway user@production-server:~/quantlink-trader/bin/
scp gateway/build/ors_gateway user@production-server:~/quantlink-trader/bin/
scp gateway/build/counter_gateway user@production-server:~/quantlink-trader/bin/
```

#### 3. ä¸Šä¼ é…ç½®æ–‡ä»¶

```bash
# ä¸Šä¼ ç”Ÿäº§é…ç½®
scp config/trader.yaml user@production-server:~/quantlink-trader/config/
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 1. è°ƒæ•´é…ç½®å‚æ•°

ç™»å½•æœåŠ¡å™¨ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
ssh user@production-server
cd ~/quantlink-trader
vim config/trader.yaml
```

**å…³é”®é…ç½®é¡¹æ£€æŸ¥**:

```yaml
system:
  strategy_id: "prod_92201"          # ç”Ÿäº§ç­–ç•¥ ID
  mode: "live"                       # ç”Ÿäº§æ¨¡å¼ï¼ˆä¸æ˜¯ simulationï¼‰

session:
  start_time: "09:00:00"             # äº¤æ˜“æ—¶æ®µå¼€å§‹
  end_time: "15:00:00"               # äº¤æ˜“æ—¶æ®µç»“æŸ
  auto_activate: false               # â—æ¨èæ‰‹åŠ¨æ¿€æ´»

strategy:
  parameters:
    entry_zscore: 2.0                # â—ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¿å®ˆé˜ˆå€¼
    exit_zscore: 0.5

risk:
  max_drawdown: 10000.0              # æœ€å¤§å›æ’¤é™åˆ¶
  stop_loss: 50000.0                 # æ­¢æŸé‡‘é¢
  max_loss: 100000.0                 # æœ€å¤§äºæŸé™åˆ¶
  daily_loss_limit: 200000.0         # æ¯æ—¥äºæŸé™åˆ¶

logging:
  level: "info"                      # ç”Ÿäº§æ—¥å¿—çº§åˆ«
  file: "./log/trader.log"
```

#### 2. å®‰è£…ç³»ç»Ÿä¾èµ–

åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… NATS Serverï¼š

```bash
# CentOS/RHEL
sudo yum install -y nats-server

# Ubuntu/Debian
sudo apt-get install -y nats-server

# æˆ–ä½¿ç”¨ Docker
docker run -d -p 4222:4222 --name nats-server nats:latest
```

#### 3. é…ç½®ç³»ç»ŸæœåŠ¡ï¼ˆå¯é€‰ï¼‰

åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo vim /etc/systemd/system/quantlink-trader.service
```

**æœåŠ¡æ–‡ä»¶å†…å®¹**:
```ini
[Unit]
Description=QuantlinkTrader Production Service
After=network.target nats-server.service

[Service]
Type=simple
User=trader
WorkingDirectory=/home/trader/quantlink-trader
ExecStart=/home/trader/quantlink-trader/start.sh
ExecStop=/home/trader/quantlink-trader/stop.sh
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**å¯ç”¨æœåŠ¡**:
```bash
sudo systemctl daemon-reload
sudo systemctl enable quantlink-trader
sudo systemctl start quantlink-trader
sudo systemctl status quantlink-trader
```

---

## ç³»ç»Ÿå¯åŠ¨ä¸ç›‘æ§

### æ‰‹åŠ¨å¯åŠ¨ï¼ˆå¼€å‘/æµ‹è¯•ç¯å¢ƒï¼‰

#### æ–¹å¼ 1: ä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# å¯åŠ¨ NATSï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
nats-server &

# ä½¿ç”¨éƒ¨ç½²åŒ…çš„å¯åŠ¨è„šæœ¬
cd deploy
./start.sh
```

#### æ–¹å¼ 2: é€ä¸ªå¯åŠ¨ç»„ä»¶

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system

# 1. å¯åŠ¨ NATS
nats-server > log/nats.log 2>&1 &

# 2. å¯åŠ¨è¡Œæƒ…æ¨¡æ‹Ÿå™¨
./gateway/build/md_simulator 100 queue > log/md_simulator.log 2>&1 &

# 3. å¯åŠ¨è¡Œæƒ…ç½‘å…³
./gateway/build/md_gateway queue > log/md_gateway.log 2>&1 &

# 4. å¯åŠ¨è®¢å•è·¯ç”±æœåŠ¡
./gateway/build/ors_gateway > log/ors_gateway.log 2>&1 &

# 5. å¯åŠ¨æ¨¡æ‹Ÿæˆäº¤ç½‘å…³
./gateway/build/counter_gateway > log/counter_gateway.log 2>&1 &

# 6. å¯åŠ¨äº¤æ˜“ç­–ç•¥
./bin/trader -config config/trader.yaml > log/trader.log 2>&1 &

# ç­‰å¾…å¯åŠ¨å®Œæˆ
sleep 5
```

#### æ–¹å¼ 3: ä½¿ç”¨æµ‹è¯•è„šæœ¬å¯åŠ¨

```bash
# ä½¿ç”¨æµ‹è¯•é…ç½®å¯åŠ¨ï¼ˆåŒ…å«ç­–ç•¥è‡ªåŠ¨æ¿€æ´»ï¼‰
./test_full_chain.sh
```

### éªŒè¯ç³»ç»Ÿè¿è¡Œ

#### 1. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€

```bash
# æ£€æŸ¥æ‰€æœ‰ç»„ä»¶è¿›ç¨‹
ps aux | grep -E "md_simulator|md_gateway|ors_gateway|counter_gateway|trader" | grep -v grep

# æ£€æŸ¥ç«¯å£ç›‘å¬
lsof -i :4222   # NATS
lsof -i :9201   # Trader API
lsof -i :50052  # ORS Gateway gRPC
```

**é¢„æœŸè¾“å‡º**:
```
user  1234  ... md_simulator 100 queue
user  1235  ... md_gateway queue
user  1236  ... ors_gateway
user  1237  ... counter_gateway
user  1238  ... trader -config config/trader.yaml
```

#### 2. æ£€æŸ¥æ—¥å¿—

```bash
# æŸ¥çœ‹ä¸»æ—¥å¿—
tail -f log/trader.log

# æŸ¥çœ‹å…³é”®å¯åŠ¨ä¿¡æ¯
grep "initialized\|started\|listening" log/trader.log

# æŸ¥çœ‹é”™è¯¯
grep -i "error\|fatal\|panic" log/trader.log
```

**æ­£å¸¸å¯åŠ¨æ—¥å¿—**:
```
2026/01/24 16:00:00 [Main] Loading configuration from: config/trader.yaml
2026/01/24 16:00:00 [Main] âœ“ Configuration loaded successfully
2026/01/24 16:00:01 [ORSClient] Connected to ORS Gateway: localhost:50052
2026/01/24 16:00:01 [StrategyEngine] Subscribed to market data: ag2502
2026/01/24 16:00:01 [StrategyEngine] Subscribed to market data: ag2504
2026/01/24 16:00:02 [API] HTTP server listening on: localhost:9201
2026/01/24 16:00:02 [Trader] âœ“ System ready
```

#### 3. æ¿€æ´»ç­–ç•¥

```bash
# é€šè¿‡ HTTP API æ¿€æ´»ç­–ç•¥
curl -X POST http://localhost:9201/api/v1/strategy/activate \
  -H "Content-Type: application/json" \
  -d '{"strategy_id": "prod_92201"}'

# æŸ¥çœ‹ç­–ç•¥çŠ¶æ€
curl http://localhost:9201/api/v1/strategy/status
```

### å®æ—¶ç›‘æ§

#### 1. ç›‘æ§è®¢å•ç”Ÿæˆ

```bash
# å®æ—¶æŸ¥çœ‹è®¢å•
tail -f log/trader.log | grep "Order sent"

# ç»Ÿè®¡è®¢å•æ•°é‡
watch -n 5 'grep "Order sent" log/trader.log | wc -l'
```

#### 2. ç›‘æ§ç­–ç•¥æŒ‡æ ‡

```bash
# å®æ—¶æŸ¥çœ‹ç­–ç•¥ç»Ÿè®¡
tail -f log/trader.log | grep "Stats:"

# æŸ¥çœ‹æœ€è¿‘çš„ç»Ÿè®¡
grep "Stats:" log/trader.log | tail -20
```

**å…³é”®æŒ‡æ ‡**:
```
[PairwiseArb:prod_92201] Stats:
  zscore=1.23        # Z-Score å€¼
  corr=0.987         # ç›¸å…³ç³»æ•°
  ready=true         # ç­–ç•¥å°±ç»ª
  condMet=true       # æ¡ä»¶æ»¡è¶³ï¼ˆäº§ç”Ÿä¿¡å·ï¼‰
```

#### 3. ç›‘æ§ç³»ç»Ÿèµ„æº

```bash
# CPU å’Œå†…å­˜ä½¿ç”¨
top -p $(pgrep -d',' -f "trader|md_gateway|ors_gateway")

# æˆ–ä½¿ç”¨ htop
htop -p $(pgrep -d',' -f "trader|md_gateway|ors_gateway")

# ç½‘ç»œè¿æ¥
netstat -an | grep -E "4222|9201|50052"
```

#### 4. ç›‘æ§ NATS æ¶ˆæ¯

```bash
# è®¢é˜…æ‰€æœ‰è¡Œæƒ…ä¸»é¢˜
nats sub "md.>" &

# æŸ¥çœ‹ç‰¹å®šå“ç§
nats sub "md.SHFE.ag2502"
```

### ç³»ç»Ÿåœæ­¢

#### æ–¹å¼ 1: ä½¿ç”¨åœæ­¢è„šæœ¬

```bash
cd /Users/user/PWorks/RD/quantlink-trade-system/deploy
./stop.sh
```

#### æ–¹å¼ 2: æ‰‹åŠ¨åœæ­¢

```bash
# åœæ­¢æ‰€æœ‰ç»„ä»¶
pkill -f md_simulator
pkill -f md_gateway
pkill -f ors_gateway
pkill -f counter_gateway
pkill -f "trader -config"

# å¯é€‰ï¼šåœæ­¢ NATS
pkill nats-server

# æ¸…ç†å…±äº«å†…å­˜
ipcs -m | grep user | awk '{print $2}' | xargs ipcrm -m

# éªŒè¯å·²åœæ­¢
ps aux | grep -E "md_simulator|md_gateway|ors_gateway|counter_gateway|trader" | grep -v grep
```

#### æ–¹å¼ 3: ä¼˜é›…åœæ­¢

```bash
# å…ˆåœæ­¢ç­–ç•¥ï¼ˆé€šè¿‡ APIï¼‰
curl -X POST http://localhost:9201/api/v1/strategy/deactivate \
  -H "Content-Type: application/json" \
  -d '{"strategy_id": "prod_92201"}'

# ç­‰å¾…ç­–ç•¥å¹³ä»“å®Œæˆ
sleep 10

# ç„¶ååœæ­¢ Trader
pkill -SIGTERM -f "trader -config"

# ç­‰å¾…é€€å‡º
sleep 5

# åœæ­¢å…¶ä»–ç»„ä»¶
pkill -SIGTERM -f md_gateway
pkill -SIGTERM -f ors_gateway
pkill -SIGTERM -f counter_gateway
pkill -SIGTERM -f md_simulator
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ç¼–è¯‘å¤±è´¥

#### ç—‡çŠ¶
```
CMake Error: Could not find gRPC
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# macOS
brew install grpc protobuf cmake

# éªŒè¯å®‰è£…
pkg-config --modversion grpc++

# æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf gateway/build
./scripts/build_gateway.sh
```

### é—®é¢˜ 2: Golang ç¼–è¯‘å¤±è´¥

#### ç—‡çŠ¶
```
package xxx is not in GOROOT
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# æ›´æ–°ä¾èµ–
cd golang
go mod tidy
go mod download

# æ¸…ç†ç¼“å­˜
go clean -modcache

# é‡æ–°ç¼–è¯‘
go build -o ../bin/trader cmd/trader/main.go
```

### é—®é¢˜ 3: NATS è¿æ¥å¤±è´¥

#### ç—‡çŠ¶
```
[StrategyEngine] Failed to connect to NATS: dial tcp :4222: connection refused
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# æ£€æŸ¥ NATS æ˜¯å¦è¿è¡Œ
lsof -i :4222

# å¯åŠ¨ NATS
nats-server &

# æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ NATS åœ°å€
grep nats_addr config/trader.yaml
# åº”ä¸º: nats_addr: "nats://localhost:4222"
```

### é—®é¢˜ 4: å…±äº«å†…å­˜é”™è¯¯

#### ç—‡çŠ¶
```
shm_open: No such file or directory
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# æ¸…ç†æ‰€æœ‰å…±äº«å†…å­˜
ipcs -m | grep user | awk '{print $2}' | xargs ipcrm -m

# é‡æ–°å¯åŠ¨ md_simulator å’Œ md_gateway
./gateway/build/md_simulator 100 queue &
sleep 1
./gateway/build/md_gateway queue &
```

### é—®é¢˜ 5: æ— è®¢å•ç”Ÿæˆ

#### ç—‡çŠ¶
ç­–ç•¥è¿è¡Œä½†æ²¡æœ‰è®¢å•äº§ç”Ÿ

#### æ’æŸ¥æ­¥éª¤

**1. æ£€æŸ¥ç­–ç•¥æ˜¯å¦æ¿€æ´»**:
```bash
curl http://localhost:9201/api/v1/strategy/status
```

**2. æ£€æŸ¥å¸‚åœºæ•°æ®æ¥æ”¶**:
```bash
grep "Received market data" log/trader.log | tail -10
```

**3. æ£€æŸ¥ç­–ç•¥ç»Ÿè®¡**:
```bash
grep "Stats:" log/trader.log | tail -10
```

**4. æ£€æŸ¥é˜ˆå€¼é…ç½®**:
```bash
# æŸ¥çœ‹é…ç½®çš„é˜ˆå€¼
grep -A5 "parameters:" config/trader.yaml

# æµ‹è¯•ç¯å¢ƒå»ºè®®ä½¿ç”¨è¾ƒä½é˜ˆå€¼
entry_zscore: 0.5    # æµ‹è¯•
exit_zscore: 0.2     # æµ‹è¯•

# ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¿å®ˆé˜ˆå€¼
entry_zscore: 2.0    # ç”Ÿäº§
exit_zscore: 0.5     # ç”Ÿäº§
```

**5. æ£€æŸ¥ç›¸å…³æ€§**:
```bash
# æŸ¥çœ‹ç›¸å…³ç³»æ•°
grep "corr=" log/trader.log | tail -10

# åº” > 0.7ï¼Œå¦‚æœå¤ªä½è¯´æ˜å“ç§é€‰æ‹©æˆ–æ•°æ®è´¨é‡æœ‰é—®é¢˜
```

### é—®é¢˜ 6: gRPC è¿æ¥å¤±è´¥

#### ç—‡çŠ¶
```
[ORSClient] Failed to connect to ORS Gateway: context deadline exceeded
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# æ£€æŸ¥ ORS Gateway æ˜¯å¦è¿è¡Œ
ps aux | grep ors_gateway

# æ£€æŸ¥ç«¯å£
lsof -i :50052

# é‡å¯ ORS Gateway
pkill ors_gateway
./gateway/build/ors_gateway > log/ors_gateway.log 2>&1 &
```

### é—®é¢˜ 7: ç³»ç»Ÿèµ„æºä¸è¶³

#### ç—‡çŠ¶
```
cannot allocate memory
too many open files
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
ulimit -n 65536

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ¸…ç†æ—§æ—¥å¿—
find log/ -name "*.log" -mtime +7 -delete
```

### è°ƒè¯•æŠ€å·§

#### 1. å¢åŠ æ—¥å¿—çº§åˆ«

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```yaml
logging:
  level: "debug"    # ä» info æ”¹ä¸º debug
```

#### 2. ä½¿ç”¨ä¸“ç”¨æµ‹è¯•é…ç½®

```bash
# ä½¿ç”¨æµ‹è¯•é…ç½®è¿è¡Œ
./bin/trader -config config/trader.test.yaml
```

æµ‹è¯•é…ç½®ç‰¹ç‚¹ï¼š
- å…¨å¤©è¿è¡Œï¼ˆ00:00:00 - 23:59:59ï¼‰
- è¾ƒä½çš„å…¥åœºé˜ˆå€¼ï¼ˆä¾¿äºè§¦å‘è®¢å•ï¼‰
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

#### 3. å•ç‹¬æµ‹è¯•å„ç»„ä»¶

```bash
# æµ‹è¯•è¡Œæƒ…ç½‘å…³
./gateway/build/md_simulator 10 queue &
./gateway/build/md_gateway queue

# æµ‹è¯• ORS ç½‘å…³
./gateway/build/ors_gateway

# æµ‹è¯• Traderï¼ˆä¸å¯åŠ¨ç­–ç•¥ï¼‰
./bin/trader -config config/trader.yaml
```

---

## é™„å½•

### A. å¿«é€Ÿå‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å¿«é€Ÿéƒ¨ç½²ï¼ˆä¸€é”®æ“ä½œï¼‰â­ æ¨è
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
./scripts/quick_deploy.sh              # ä¸€é”®ç¼–è¯‘å¹¶å‡†å¤‡éƒ¨ç½²åŒ…
./scripts/quick_deploy.sh remote       # ç¼–è¯‘ã€æ‰“åŒ…å¹¶ä¸Šä¼ åˆ°è¿œç¨‹
./scripts/quick_deploy.sh local        # ä»…æœ¬åœ°ç¼–è¯‘ï¼ˆä¸æ‰“åŒ…ï¼‰

cd deploy && ./start.sh                # ä¸€é”®å¯åŠ¨æ‰€æœ‰ç»„ä»¶
cd deploy && ./stop.sh                 # ä¸€é”®åœæ­¢æ‰€æœ‰ç»„ä»¶

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ‰‹åŠ¨ç¼–è¯‘ï¼ˆåˆ†æ­¥æ“ä½œï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
./scripts/generate_proto.sh            # ç”Ÿæˆ protobuf ä»£ç 
./scripts/build_gateway.sh             # ç¼–è¯‘ C++ Gateway
cd golang && go build -o ../bin/trader cmd/trader/main.go  # ç¼–è¯‘ Trader

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æµ‹è¯•ç›¸å…³
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
nats-server &                          # å¯åŠ¨ NATS
./test_full_chain.sh                   # å®Œæ•´é“¾è·¯æµ‹è¯•
curl -X POST http://localhost:9201/api/v1/strategy/activate \
  -d '{"strategy_id": "test_92201"}'   # æ¿€æ´»ç­–ç•¥

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# éƒ¨ç½²ç›¸å…³
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
./scripts/prepare_deploy.sh            # å‡†å¤‡éƒ¨ç½²åŒ…
tar czf deploy.tar.gz deploy/          # æ‰“åŒ…
scp deploy.tar.gz user@server:~/       # ä¸Šä¼ 

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç›‘æ§ç›¸å…³
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
tail -f log/trader.log                 # æŸ¥çœ‹ä¸»æ—¥å¿—
grep "Order sent" log/trader.log       # æŸ¥çœ‹è®¢å•
grep "Stats:" log/trader.log           # æŸ¥çœ‹ç­–ç•¥ç»Ÿè®¡
curl http://localhost:9201/api/v1/strategy/status  # æŸ¥çœ‹çŠ¶æ€

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# åœæ­¢æ¸…ç†
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
pkill -f "md_simulator|md_gateway|ors_gateway|counter_gateway|trader"  # åœæ­¢æ‰€æœ‰
ipcs -m | grep user | awk '{print $2}' | xargs ipcrm -m  # æ¸…ç†å…±äº«å†…å­˜
```

### B. ç›®å½•ç»“æ„å‚è€ƒ

```
quantlink-trade-system/
â”œâ”€â”€ bin/                       # Golang å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â””â”€â”€ trader
â”œâ”€â”€ gateway/
â”‚   â”œâ”€â”€ build/                 # C++ å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ md_simulator
â”‚   â”‚   â”œâ”€â”€ md_gateway
â”‚   â”‚   â”œâ”€â”€ ors_gateway
â”‚   â”‚   â””â”€â”€ counter_gateway
â”‚   â”œâ”€â”€ src/                   # C++ æºç 
â”‚   â””â”€â”€ proto/                 # Protobuf å®šä¹‰
â”œâ”€â”€ golang/
â”‚   â”œâ”€â”€ cmd/                   # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ pkg/                   # ä¸šåŠ¡é€»è¾‘åŒ…
â”‚   â””â”€â”€ bin/                   # å·¥å…·ç¨‹åº
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ trader.yaml            # ç”Ÿäº§é…ç½®
â”‚   â””â”€â”€ trader.test.yaml       # æµ‹è¯•é…ç½®
â”œâ”€â”€ log/                       # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”œâ”€â”€ scripts/                   # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ generate_proto.sh
â”‚   â”œâ”€â”€ build_gateway.sh
â”‚   â””â”€â”€ prepare_deploy.sh
â””â”€â”€ test_full_chain.sh         # ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
```

### C. é…ç½®æ–‡ä»¶æ¨¡æ¿

#### ç”Ÿäº§é…ç½® (config/trader.yaml)

```yaml
system:
  strategy_id: "prod_92201"
  mode: "live"

strategy:
  type: "pairwise_arb"
  symbols: ["ag2502", "ag2504"]
  parameters:
    entry_zscore: 2.0          # ä¿å®ˆé˜ˆå€¼
    exit_zscore: 0.5

session:
  start_time: "09:00:00"
  end_time: "15:00:00"
  auto_activate: false         # æ‰‹åŠ¨æ¿€æ´»

risk:
  stop_loss: 50000.0
  max_loss: 100000.0
  daily_loss_limit: 200000.0

engine:
  ors_gateway_addr: "localhost:50052"
  nats_addr: "nats://localhost:4222"

logging:
  level: "info"
  file: "./log/trader.log"
```

#### æµ‹è¯•é…ç½® (config/trader.test.yaml)

```yaml
system:
  strategy_id: "test_92201"
  mode: "simulation"

strategy:
  type: "pairwise_arb"
  symbols: ["ag2502", "ag2504"]
  parameters:
    entry_zscore: 0.5          # ä½é˜ˆå€¼ä¾¿äºæµ‹è¯•
    exit_zscore: 0.2

session:
  start_time: "00:00:00"       # å…¨å¤©è¿è¡Œ
  end_time: "23:59:59"
  auto_activate: false

engine:
  ors_gateway_addr: "localhost:50052"
  nats_addr: "nats://localhost:4222"

logging:
  level: "debug"               # è¯¦ç»†æ—¥å¿—
  file: "./log/trader.test.log"
```

### D. ç›¸å…³æ–‡æ¡£é“¾æ¥

- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](CURRENT_ARCHITECTURE_FLOW.md)
- [æ„å»ºæŒ‡å—](BUILD_GUIDE.md)
- [ä½¿ç”¨è¯´æ˜](USAGE.md)
- [ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š](QuantlinkTrader_ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š_2026-01-24-15_32.md)
- [API ä½¿ç”¨æŒ‡å—](golang/golang_APIä½¿ç”¨æŒ‡å—_2026-01-22-19_56.md)

---

**æœ€åæ›´æ–°**: 2026-01-24 16:15
**ç»´æŠ¤è€…**: QuantlinkTrader Team
