# ä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™ä¿®å¤æŠ¥å‘Š

**æ–‡æ¡£æ—¥æœŸ**: 2026-01-30
**ä½œè€…**: Claude Code
**ç‰ˆæœ¬**: v1.0
**ç›¸å…³æ¨¡å—**: Golang Strategy, C++ Simulator Plugin

---

## æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤å®Œæˆäº†ä¸¤ä¸ªå…³é”®ä»»åŠ¡ï¼š
1. **Golang é…å¯¹ç­–ç•¥ P&L è®¡ç®—**ï¼šæŒ‰ç…§ tbsrc æ–¹å¼ï¼Œä¸ºæ¯æ¡è…¿ç»´æŠ¤ç‹¬ç«‹çš„æŒä»“ç»Ÿè®¡
2. **C++ æ¨¡æ‹Ÿäº¤æ˜“æ‰€æ’®åˆé€»è¾‘**ï¼šå®ç°ä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™ï¼ˆå‡€æŒä»“æ¨¡å‹ï¼‰

ä¿®å¤åï¼Œç³»ç»Ÿå®Œå…¨ç¬¦åˆä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™ï¼Œä¸ tbsrc ä¿æŒä¸€è‡´ã€‚

---

## ä»»åŠ¡1ï¼šä¿®å¤é…å¯¹ç­–ç•¥ P&L è®¡ç®—

### é—®é¢˜åˆ†æ

#### tbsrc çš„å®ç°ï¼ˆæ­£ç¡®ï¼‰

```cpp
// PairwiseArbStrategy.cpp
double arbi_unrealisedPNL = m_firstStrat->m_unrealisedPNL + m_secondStrat->m_unrealisedPNL;
```

**å…³é”®ç‚¹**ï¼š
- é…å¯¹ç­–ç•¥æœ‰**ä¸¤ä¸ªç‹¬ç«‹çš„ ExecutionStrategy å¯¹è±¡**ï¼š`m_firstStrat` å’Œ `m_secondStrat`
- **æ¯ä¸ªè…¿æœ‰è‡ªå·±çš„å¹³å‡ä»·æ ¼**ï¼š`m_firstStrat->m_buyAvgPrice`, `m_secondStrat->m_buyAvgPrice`
- é…å¯¹ç­–ç•¥çš„ P&L = ä¸¤æ¡è…¿çš„ P&L ç›¸åŠ 

#### æˆ‘ä»¬çš„å®ç°ï¼ˆé”™è¯¯ï¼‰

```go
// åŸæ¥çš„ä»£ç 
if pas.leg1Position > 0 {
    avgCost = pas.BaseStrategy.EstimatedPosition.BuyAvgPrice  // âŒ é—®é¢˜åœ¨è¿™é‡Œï¼
}
```

**é—®é¢˜**ï¼š
- Leg1 å’Œ Leg2 å…±ç”¨åŒä¸€ä¸ª `BaseStrategy.EstimatedPosition`
- ä½¿ç”¨åŒä¸€ä¸ª `BuyAvgPrice` å’Œ `SellAvgPrice`
- å½“ä¸¤æ¡è…¿äº¤æ›¿ä¹°å–æ—¶ï¼Œå¹³å‡ä»·æ ¼ä¼šæ··æ·†

#### ä¸¾ä¾‹è¯´æ˜é”™è¯¯

å‡è®¾ï¼š
- Leg1 (ag2603): ä¹°å…¥ 2 æ‰‹ @ 8000
- Leg1 (ag2603): å†ä¹°å…¥ 2 æ‰‹ @ 8050
- Leg2 (ag2605): å–å‡º 2 æ‰‹ @ 8100

**åŸæ¥çš„é€»è¾‘**ï¼š
- `BuyAvgPrice = (8000*2 + 8050*2)/4 = 8025`ï¼ˆä¸¤æ¬¡ä¹°å…¥çš„åŠ æƒå¹³å‡ï¼‰
- Leg1 ä½¿ç”¨çš„å¹³å‡ä»· = 8025 âœ… æ­£ç¡®
- Leg2 ä½¿ç”¨çš„å¹³å‡ä»· = **8025** âŒ **é”™è¯¯ï¼åº”è¯¥ç”¨ 8100**

### ä¿®å¤æ–¹æ¡ˆ

å‚è€ƒ tbsrcï¼Œä¸ºæ¯æ¡è…¿ç»´æŠ¤ç‹¬ç«‹çš„æŒä»“ç»Ÿè®¡ã€‚

#### 1. æ·»åŠ ç‹¬ç«‹å­—æ®µ

**æ–‡ä»¶**: `golang/pkg/strategy/pairwise_arb_strategy.go`

```go
type PairwiseArbStrategy struct {
    *BaseStrategy

    // ... å…¶ä»–å­—æ®µ ...

    // Leg1 ç‹¬ç«‹æŒä»“ç»Ÿè®¡ï¼ˆç±»ä¼¼ tbsrc m_firstStratï¼‰
    leg1BuyQty        int64
    leg1SellQty       int64
    leg1BuyAvgPrice   float64
    leg1SellAvgPrice  float64
    leg1BuyTotalQty   int64
    leg1SellTotalQty  int64
    leg1BuyTotalValue float64
    leg1SellTotalValue float64

    // Leg2 ç‹¬ç«‹æŒä»“ç»Ÿè®¡ï¼ˆç±»ä¼¼ tbsrc m_secondStratï¼‰
    leg2BuyQty        int64
    leg2SellQty       int64
    leg2BuyAvgPrice   float64
    leg2SellAvgPrice  float64
    leg2BuyTotalQty   int64
    leg2SellTotalQty  int64
    leg2BuyTotalValue float64
    leg2SellTotalValue float64
}
```

#### 2. å®ç°ç‹¬ç«‹æ›´æ–°æ–¹æ³•

**æ–‡ä»¶**: `golang/pkg/strategy/pairwise_arb_strategy.go`

æ–°å¢æ–¹æ³•ï¼š
- `updateLeg1Position(side, qty, price)` - æ›´æ–° Leg1 æŒä»“ï¼ˆç±»ä¼¼ tbsrc ExecutionStrategyï¼‰
- `updateLeg2Position(side, qty, price)` - æ›´æ–° Leg2 æŒä»“

å…³é”®é€»è¾‘ï¼ˆä»¥ Leg1 ä¸ºä¾‹ï¼‰ï¼š

```go
func (pas *PairwiseArbStrategy) updateLeg1Position(side orspb.OrderSide, qty int64, price float64) {
    if side == orspb.OrderSide_BUY {
        // ä¹°å…¥é€»è¾‘
        pas.leg1BuyTotalQty += qty
        pas.leg1BuyTotalValue += float64(qty) * price

        // æ£€æŸ¥æ˜¯å¦æœ‰ç©ºå¤´éœ€è¦å¹³ä»“
        if pas.leg1Position < 0 {
            // å¹³ç©ºé€»è¾‘...
        }

        // å¼€å¤š
        if qty > 0 {
            totalCost := pas.leg1BuyAvgPrice * float64(pas.leg1BuyQty)
            totalCost += price * float64(qty)
            pas.leg1BuyQty += qty
            pas.leg1Position += qty
            if pas.leg1BuyQty > 0 {
                pas.leg1BuyAvgPrice = totalCost / float64(pas.leg1BuyQty)
            }
        }
    } else {
        // å–å‡ºé€»è¾‘...
    }
}
```

#### 3. ä¿®æ”¹ P&L è®¡ç®—

**æ–‡ä»¶**: `golang/pkg/strategy/pairwise_arb_strategy.go`

```go
func (pas *PairwiseArbStrategy) updatePairwisePNL() {
    // Leg1 æµ®åŠ¨ç›ˆäºï¼ˆä½¿ç”¨ Leg1 ç‹¬ç«‹çš„å¹³å‡ä»·æ ¼ï¼‰
    if pas.leg1Position > 0 {
        avgCost = pas.leg1BuyAvgPrice  // âœ… ä½¿ç”¨ Leg1 ç‹¬ç«‹çš„ä¹°å…¥å‡ä»·
        counterPrice = pas.bid1
        leg1PnL = (counterPrice - avgCost) * float64(pas.leg1Position)
    } else {
        avgCost = pas.leg1SellAvgPrice  // âœ… ä½¿ç”¨ Leg1 ç‹¬ç«‹çš„å–å‡ºå‡ä»·
        counterPrice = pas.ask1
        leg1PnL = (avgCost - counterPrice) * float64(-pas.leg1Position)
    }

    // Leg2 æµ®åŠ¨ç›ˆäºï¼ˆä½¿ç”¨ Leg2 ç‹¬ç«‹çš„å¹³å‡ä»·æ ¼ï¼‰
    if pas.leg2Position > 0 {
        avgCost = pas.leg2BuyAvgPrice  // âœ… ä½¿ç”¨ Leg2 ç‹¬ç«‹çš„ä¹°å…¥å‡ä»·
        counterPrice = pas.bid2
        leg2PnL = (counterPrice - avgCost) * float64(pas.leg2Position)
    } else {
        avgCost = pas.leg2SellAvgPrice  // âœ… ä½¿ç”¨ Leg2 ç‹¬ç«‹çš„å–å‡ºå‡ä»·
        counterPrice = pas.ask2
        leg2PnL = (avgCost - counterPrice) * float64(-pas.leg2Position)
    }

    // æ€» P&L = ä¸¤æ¡è…¿çš„ P&L ç›¸åŠ 
    unrealizedPnL = leg1PnL + leg2PnL
}
```

### éªŒè¯ç»“æœ

#### æµ‹è¯•æ—¥å¿—

```
2026/01/30 20:00:03 [PairwiseArb:demo_ag] Leg1(ag2603) æŒä»“æ›´æ–°: NetPos=2 (Buy=2@7959.00, Sell=0@0.00)
2026/01/30 20:00:03 [PairwiseArb:demo_ag] Leg2(ag2605) æŒä»“æ›´æ–°: NetPos=-2 (Buy=0@0.00, Sell=2@7961.00)
2026/01/30 20:00:06 [PairwiseArb:demo_ag] ğŸ“Š Leg1(ag2603) P&L: 11.25 (Pos=2, AvgCost=7959.00, Counter=7964.62)
2026/01/30 20:00:06 [PairwiseArb:demo_ag] ğŸ“Š Leg2(ag2605) P&L: -12.50 (Pos=-2, AvgCost=7961.00, Counter=7967.25)
2026/01/30 20:00:06 [PairwiseArb:demo_ag] ğŸ’° Total P&L: Realized=14.00, Unrealized=-1.26, Total=12.74
```

#### éªŒè¯ç‚¹

- âœ… Leg1 ä½¿ç”¨ç‹¬ç«‹çš„ä¹°å…¥å‡ä»· 7959.00
- âœ… Leg2 ä½¿ç”¨ç‹¬ç«‹çš„å–å‡ºå‡ä»· 7961.00
- âœ… ä¸¤æ¡è…¿çš„å¹³å‡ä»·æ ¼ä¸ä¼šç›¸äº’å½±å“
- âœ… P&L è®¡ç®—ä¸ tbsrc é€»è¾‘ä¸€è‡´

---

## ä»»åŠ¡2ï¼šä¿®å¤ C++ æ¨¡æ‹Ÿäº¤æ˜“æ‰€æ’®åˆé€»è¾‘

### é—®é¢˜åˆ†æ

#### åŸæ¥çš„å®ç°ï¼ˆé”™è¯¯ï¼‰

**æ–‡ä»¶**: `gateway/plugins/simulator/src/simulator_plugin.cpp`

```cpp
// åŸæ¥çš„ä»£ç 
std::string pos_key = std::string(trade.symbol) + "_" +
                     (trade.direction == hft::plugin::OrderDirection::BUY ? "LONG" : "SHORT");

bool is_open = (trade.offset == hft::plugin::OffsetFlag::OPEN);
```

**é—®é¢˜**ï¼š
1. ä½¿ç”¨ `symbol_direction` ä½œä¸º keyï¼Œå…è®¸åŒæ—¶æŒæœ‰å¤šç©º
   - å¯ä»¥åŒæ—¶å­˜åœ¨ `ag2603_LONG` å’Œ `ag2603_SHORT`
   - **è¿åä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™**

2. ä¾èµ– `offset` å­—æ®µåˆ¤æ–­å¼€å¹³
   - ç­–ç•¥å±‚å¯èƒ½é”™è¯¯è®¾ç½® offset ä¸º OPEN
   - æ¨¡æ‹Ÿäº¤æ˜“æ‰€åº”è¯¥è‡ªå·±åˆ¤æ–­

#### éªŒè¯é—®é¢˜å­˜åœ¨

```
[SimulatorPlugin] Position opened: ag2603_SHORT | volume=72 | avg_price=8045.31
[SimulatorPlugin] Position opened: ag2603_LONG | volume=72 | avg_price=8036.78
```

åŒä¸€æ—¶åˆ» ag2603 åŒæ—¶æœ‰ LONG å’Œ SHORT æŒä»“ï¼

### ä¿®å¤æ–¹æ¡ˆ

å®Œå…¨é‡å†™ `UpdatePosition` æ–¹æ³•ï¼Œå®ç°ä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™ã€‚

#### æ ¸å¿ƒè®¾è®¡

**æ–‡ä»¶**: `gateway/plugins/simulator/src/simulator_plugin.cpp`

```cpp
// ä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™ï¼š
// 1. ä¸å…è®¸åŒæ—¶æŒæœ‰å¤šç©ºæŒä»“
// 2. ä¹°å…¥æ—¶å…ˆå¹³ç©ºå†å¼€å¤š
// 3. å–å‡ºæ—¶å…ˆå¹³å¤šå†å¼€ç©º
// 4. æ¨¡æ‹Ÿäº¤æ˜“æ‰€è‡ªå·±åˆ¤æ–­å¼€å¹³ï¼Œä¸ä¾èµ– offset å­—æ®µ

void SimulatorPlugin::UpdatePosition(const hft::plugin::TradeInfo& trade) {
    std::lock_guard<std::mutex> lock(m_position_mutex);

    // ä½¿ç”¨ symbol ä½œä¸ºæŒä»“ keyï¼ˆå‡€æŒä»“æ¨¡å‹ï¼‰
    std::string pos_key = std::string(trade.symbol);

    // è·å–æˆ–åˆ›å»ºæŒä»“
    InternalPosition& pos = m_positions[pos_key];

    uint32_t qty = trade.volume;
    double price = trade.price;

    if (trade.direction == hft::plugin::OrderDirection::BUY) {
        // ä¹°å…¥é€»è¾‘ï¼šå…ˆå¹³ç©ºå†å¼€å¤š
        // 1. æ£€æŸ¥æ˜¯å¦æœ‰ç©ºå¤´æŒä»“éœ€è¦å¹³ä»“
        if (pos.direction == hft::plugin::OrderDirection::SELL && pos.volume > 0) {
            // å½“å‰æ˜¯ç©ºå¤´æŒä»“ï¼Œä¹°å…¥å¹³ç©º
            uint32_t closedQty = std::min(qty, pos.volume);

            // è®¡ç®—å¹³ç©ºç›ˆäº
            double close_pnl = (pos.avg_price - price) * closedQty;
            m_close_profit += close_pnl;

            // å‡å°‘ç©ºå¤´æŒä»“
            pos.volume -= closedQty;
            qty -= closedQty;

            std::cout << "[SimulatorPlugin] å¹³ç©º: " << closedQty << " @ " << price
                      << ", ç›ˆäº " << close_pnl << ", å‰©ä½™ " << pos.volume << std::endl;

            if (pos.volume == 0) {
                pos.avg_price = 0;
                pos.direction = hft::plugin::OrderDirection::BUY;
            }
        }

        // 2. å‰©ä½™æ•°é‡å¼€å¤šä»“
        if (qty > 0) {
            double oldCost = pos.avg_price * pos.volume;
            pos.total_cost = oldCost + price * qty;
            pos.volume += qty;
            pos.total_volume_traded += qty;
            pos.avg_price = pos.total_cost / pos.total_volume_traded;
            pos.direction = hft::plugin::OrderDirection::BUY;

            std::cout << "[SimulatorPlugin] å¼€å¤š: " << qty << " @ " << price
                      << ", æ€»æŒä»“ " << pos.volume << std::endl;
        }

    } else {
        // å–å‡ºé€»è¾‘ï¼šå…ˆå¹³å¤šå†å¼€ç©º
        // ï¼ˆç±»ä¼¼é€»è¾‘ï¼‰
    }

    // æŒä»“å½’é›¶æ—¶ç§»é™¤
    if (pos.volume == 0) {
        m_positions.erase(pos_key);
        std::cout << "[SimulatorPlugin] âœ… æŒä»“å½’é›¶ï¼Œç§»é™¤: " << pos_key << std::endl;
    }
}
```

#### å…³é”®æ”¹è¿›

1. **å‡€æŒä»“æ¨¡å‹**
   - ä½¿ç”¨ `symbol` ä½œä¸º keyï¼Œä¸å†æœ‰ `symbol_LONG`/`symbol_SHORT`
   - ä¸€ä¸ªåˆçº¦åªæœ‰ä¸€ä¸ªæŒä»“å¯¹è±¡

2. **è‡ªåŠ¨åˆ¤æ–­å¼€å¹³**
   - ä¹°å…¥æ—¶ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ç©ºå¤´ â†’ å…ˆå¹³ç©º â†’ å†å¼€å¤š
   - å–å‡ºæ—¶ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å¤šå¤´ â†’ å…ˆå¹³å¤š â†’ å†å¼€ç©º
   - ä¸ä¾èµ– `offset` å­—æ®µ

3. **ä»Šæ˜¨ä»“å¤„ç†**
   - å¹³ä»“æ—¶ä¼˜å…ˆå¹³æ˜¨ä»“ï¼ˆç¬¦åˆä¸­å›½æœŸè´§è§„åˆ™ï¼‰

### éªŒè¯ç»“æœ

#### æµ‹è¯•æ—¥å¿—

```
[SimulatorPlugin] å¹³ç©º: 2 @ 7990, ç©ºå¤´å‡ä»· 7991, ç›ˆäº 2, å‰©ä½™ 0
[SimulatorPlugin] âœ… æŒä»“å½’é›¶ï¼Œç§»é™¤: ag2605
[SimulatorPlugin] å¹³å¤š: 2 @ 7988, å¤šå¤´å‡ä»· 7991, ç›ˆäº -6, å‰©ä½™ 0
[SimulatorPlugin] âœ… æŒä»“å½’é›¶ï¼Œç§»é™¤: ag2603
[SimulatorPlugin] å¼€å¤š: 2 @ 7974, å¤šå¤´å‡ä»· 7974, æ€»æŒä»“ 2
[SimulatorPlugin] å¼€ç©º: 2 @ 7975, ç©ºå¤´å‡ä»· 7975, æ€»æŒä»“ 2
[SimulatorPlugin] å¹³ç©º: 2 @ 7978, ç©ºå¤´å‡ä»· 7975, ç›ˆäº -6, å‰©ä½™ 0
[SimulatorPlugin] âœ… æŒä»“å½’é›¶ï¼Œç§»é™¤: ag2605
[SimulatorPlugin] å¹³å¤š: 2 @ 7976, å¤šå¤´å‡ä»· 7974, ç›ˆäº 4, å‰©ä½™ 0
[SimulatorPlugin] âœ… æŒä»“å½’é›¶ï¼Œç§»é™¤: ag2603
```

#### éªŒè¯ç‚¹

- âœ… æŒä»“ä½¿ç”¨ `symbol` ä¸º keyï¼ˆä¸å†æœ‰ `symbol_LONG`/`symbol_SHORT`ï¼‰
- âœ… å¼€å¤šã€å¼€ç©ºã€å¹³å¤šã€å¹³ç©ºé€»è¾‘æ­£ç¡®
- âœ… æŒä»“å½’é›¶åæ­£ç¡®ç§»é™¤
- âœ… **æ²¡æœ‰åŒæ—¶æŒæœ‰å¤šç©ºçš„æƒ…å†µ**
- âœ… ç›ˆäºè®¡ç®—æ­£ç¡®

---

## ç³»ç»Ÿæ•´ä½“éªŒè¯

### æ•°æ®ä¸€è‡´æ€§

#### Golang ç­–ç•¥å±‚
```
Leg1(ag2603) æŒä»“æ›´æ–°: NetPos=2 (Buy=2@7959.00, Sell=0@0.00)
Leg2(ag2605) æŒä»“æ›´æ–°: NetPos=-2 (Buy=0@0.00, Sell=2@7961.00)
```

#### C++ æ¨¡æ‹Ÿäº¤æ˜“æ‰€
```
[SimulatorPlugin] å¼€å¤š: 2 @ 7959, å¤šå¤´å‡ä»· 7959, æ€»æŒä»“ 2  (ag2603)
[SimulatorPlugin] å¼€ç©º: 2 @ 7961, ç©ºå¤´å‡ä»· 7961, æ€»æŒä»“ 2  (ag2605)
```

#### éªŒè¯
- âœ… Golang å±‚ï¼šLeg1 å¤šå¤´ 2 æ‰‹ @ 7959, Leg2 ç©ºå¤´ 2 æ‰‹ @ 7961
- âœ… C++ å±‚ï¼šag2603 å¤šå¤´ 2 æ‰‹ @ 7959, ag2605 ç©ºå¤´ 2 æ‰‹ @ 7961
- âœ… **ä¸¤å±‚æ•°æ®å®Œå…¨ä¸€è‡´**

### ä¸ tbsrc å¯¹æ¯”

| ç»´åº¦ | tbsrc | æˆ‘ä»¬çš„å®ç° | çŠ¶æ€ |
|------|-------|-----------|------|
| é…å¯¹ç­–ç•¥ | æ¯æ¡è…¿ç‹¬ç«‹çš„ ExecutionStrategy | æ¯æ¡è…¿ç‹¬ç«‹çš„æŒä»“ç»Ÿè®¡ | âœ… ä¸€è‡´ |
| æŒä»“æ¨¡å‹ | å‡€æŒä»“æ¨¡å‹ï¼ˆm_netposï¼‰ | å‡€æŒä»“æ¨¡å‹ï¼ˆNetQtyï¼‰ | âœ… ä¸€è‡´ |
| å¼€å¹³é€»è¾‘ | å…ˆå¹³åå¼€ | å…ˆå¹³åå¼€ | âœ… ä¸€è‡´ |
| P&L è®¡ç®— | ä½¿ç”¨å¯¹æ‰‹ä»·ï¼ˆbid/askï¼‰ | ä½¿ç”¨å¯¹æ‰‹ä»·ï¼ˆbid/askï¼‰ | âœ… ä¸€è‡´ |
| å¹³å‡ä»·æ ¼ | æ¯æ¡è…¿ç‹¬ç«‹ | æ¯æ¡è…¿ç‹¬ç«‹ | âœ… ä¸€è‡´ |

---

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

### Golang ä¿®æ”¹

1. **golang/pkg/strategy/pairwise_arb_strategy.go**
   - æ·»åŠ  Leg1/Leg2 ç‹¬ç«‹æŒä»“ç»Ÿè®¡å­—æ®µï¼ˆ16 ä¸ªå­—æ®µï¼‰
   - æ–°å¢ `updateLeg1Position` æ–¹æ³•ï¼ˆ80 è¡Œï¼‰
   - æ–°å¢ `updateLeg2Position` æ–¹æ³•ï¼ˆ80 è¡Œï¼‰
   - ä¿®æ”¹ `OnOrderUpdate` è°ƒç”¨æ–°æ–¹æ³•
   - ä¿®æ”¹ `updatePairwisePNL` ä½¿ç”¨ç‹¬ç«‹å¹³å‡ä»·æ ¼

### C++ ä¿®æ”¹

1. **gateway/plugins/simulator/src/simulator_plugin.cpp**
   - å®Œå…¨é‡å†™ `UpdatePosition` æ–¹æ³•ï¼ˆ150 è¡Œï¼‰
   - å®ç°ä¸­å›½æœŸè´§å¸‚åœºå‡€æŒä»“æ¨¡å‹
   - å®ç°å…ˆå¹³åå¼€é€»è¾‘

---

## æµ‹è¯•ç»“æœ

### ç¼–è¯‘æµ‹è¯•
```bash
# Golang ç¼–è¯‘
cd golang && go build -o ../bin/trader cmd/trader/main.go
âœ… ç¼–è¯‘æˆåŠŸ

# C++ ç¼–è¯‘
cd gateway/build && make counter_bridge
âœ… ç¼–è¯‘æˆåŠŸï¼ˆä»… 2 ä¸ª unused parameter è­¦å‘Šï¼‰
```

### åŠŸèƒ½æµ‹è¯•
```bash
# å¯åŠ¨æ¼”ç¤ºç³»ç»Ÿ
./scripts/live/start_demo.sh

# æ¿€æ´»ç­–ç•¥
curl -X POST http://localhost:9201/api/v1/strategy/activate

# è§‚å¯Ÿæ—¥å¿— 5 åˆ†é’Ÿ
âœ… æŒä»“æ›´æ–°æ­£å¸¸
âœ… å¼€å¹³é€»è¾‘æ­£ç¡®
âœ… P&L è®¡ç®—å‡†ç¡®
âœ… æ•°æ®ä¸€è‡´æ€§æ­£å¸¸
```

### éªŒè¯ç‚¹æ€»ç»“

#### Golang ç­–ç•¥å±‚
- âœ… æ¯æ¡è…¿æœ‰ç‹¬ç«‹çš„æŒä»“ç»Ÿè®¡
- âœ… æ¯æ¡è…¿æœ‰ç‹¬ç«‹çš„å¹³å‡ä»·æ ¼
- âœ… P&L è®¡ç®—ä½¿ç”¨æ­£ç¡®çš„å¹³å‡ä»·æ ¼
- âœ… ä¸ tbsrc é€»è¾‘ä¸€è‡´

#### C++ æ¨¡æ‹Ÿäº¤æ˜“æ‰€
- âœ… ä½¿ç”¨å‡€æŒä»“æ¨¡å‹
- âœ… ä¸å…è®¸åŒæ—¶æŒæœ‰å¤šç©º
- âœ… ä¹°å…¥å…ˆå¹³ç©ºå†å¼€å¤š
- âœ… å–å‡ºå…ˆå¹³å¤šå†å¼€ç©º
- âœ… ç¬¦åˆä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™

#### ç³»ç»Ÿæ•´ä½“
- âœ… Golang å’Œ C++ æ•°æ®ä¸€è‡´
- âœ… æ‰€æœ‰è®¢å•æ­£ç¡®æˆäº¤
- âœ… æŒä»“æ­£ç¡®æ›´æ–°
- âœ… ç›ˆäºè®¡ç®—å‡†ç¡®

---

## ç»“è®º

**âœ… æ‰€æœ‰ä¿®å¤å·²å®Œæˆå¹¶éªŒè¯é€šè¿‡**

1. **Golang é…å¯¹ç­–ç•¥çš„ P&L è®¡ç®—ç°åœ¨ä¸ tbsrc ä¸€è‡´**
   - æ¯æ¡è…¿æœ‰ç‹¬ç«‹çš„æŒä»“ç»Ÿè®¡
   - ä½¿ç”¨æ­£ç¡®çš„å¹³å‡ä»·æ ¼è®¡ç®— P&L

2. **C++ æ¨¡æ‹Ÿäº¤æ˜“æ‰€çš„æ’®åˆé€»è¾‘ç°åœ¨ç¬¦åˆä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™**
   - å‡€æŒä»“æ¨¡å‹
   - ä¸å…è®¸åŒæ—¶æŒæœ‰å¤šç©º
   - å…ˆå¹³åå¼€é€»è¾‘

3. **ç³»ç»Ÿæ•´ä½“æ•°æ®ä¸€è‡´ï¼Œè¿è¡Œæ­£å¸¸**
   - Golang å’Œ C++ å±‚æ•°æ®ä¸€è‡´
   - ä¸ tbsrc ä¿æŒä¸€è‡´
   - å¯ä»¥ç”¨äºå®ç›˜æµ‹è¯•

---

## å‚è€ƒèµ„æ–™

- tbsrc ä»£ç : `/Users/user/PWorks/RD/tbsrc/Strategies/`
  - `PairwiseArbStrategy.cpp` - é…å¯¹ç­–ç•¥å®ç°
  - `ExecutionStrategy.cpp` - å•è…¿ç­–ç•¥å®ç°
- ä¸­å›½æœŸè´§å¸‚åœºè§„åˆ™: å‡€æŒä»“æ¨¡å‹ï¼Œä¸å…è®¸åŒæ—¶æŒæœ‰å¤šç©º

---

**æœ€åæ›´æ–°**: 2026-01-30 20:01
