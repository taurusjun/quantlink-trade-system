# CTPå®ç›˜äº¤æ˜“ç³»ç»Ÿå¯åŠ¨å®Œæ•´æŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-30
**æ—¶é—´**: 21:52
**ç³»ç»Ÿç‰ˆæœ¬**: v1.0.0
**æµ‹è¯•ç¯å¢ƒ**: macOS (Darwin 24.6.0)

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

åœ¨CTPä»Šæ˜¨ä»“åŠŸèƒ½å®æ–½å®Œæˆåï¼Œé¦–æ¬¡å¯åŠ¨CTPå®ç›˜äº¤æ˜“ç³»ç»Ÿï¼ŒéªŒè¯å®Œæ•´é“¾è·¯çš„æ­£ç¡®æ€§ã€‚

**ç›®æ ‡**:
1. å¯åŠ¨å®Œæ•´çš„CTPå®ç›˜äº¤æ˜“ç³»ç»Ÿ
2. éªŒè¯CTPè¡Œæƒ…å’Œäº¤æ˜“è¿æ¥
3. æ¿€æ´»ç­–ç•¥å¹¶è§‚å¯Ÿå®ç›˜äº¤æ˜“
4. éªŒè¯æŒä»“ç®¡ç†å’Œè®¢å•æ‰§è¡Œ

---

## ğŸ”§ é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: Counter Bridge é…ç½®æ–‡ä»¶è§£æå¤±è´¥

**ç°è±¡**:
```
[CTPTDConfig] YAML parsing error: bad file: config/ctp/ctp_td.yaml:config/ctp/ctp_td.secret.yaml
[CTPTDPlugin] âŒ Failed to load config file
```

**åŸå› **:
- Counter Bridge ä¼ é€’æ ¼å¼ä¸º `"ctp:config/ctp/ctp_td.yaml:config/ctp/ctp_td.secret.yaml"`
- CTPTDPlugin::Initialize() ç›´æ¥å°†æ•´ä¸ªå­—ç¬¦ä¸²ä¼ ç»™ LoadFromYaml()
- ä½† LoadFromYaml() æœŸæœ›ä¸¤ä¸ªç‹¬ç«‹çš„æ–‡ä»¶è·¯å¾„å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹ `gateway/plugins/ctp/src/ctp_td_plugin.cpp:33`ï¼Œæ·»åŠ é…ç½®å­—ç¬¦ä¸²è§£æé€»è¾‘ï¼š

```cpp
bool CTPTDPlugin::Initialize(const std::string& config_file) {
    // è§£æé…ç½®æ–‡ä»¶è·¯å¾„ (æ”¯æŒ "config1:config2" æ ¼å¼)
    std::string main_config, secret_config;
    size_t pos = config_file.find(':');
    if (pos != std::string::npos) {
        main_config = config_file.substr(0, pos);
        secret_config = config_file.substr(pos + 1);
    } else {
        main_config = config_file;
        secret_config = "config/ctp/ctp_td.secret.yaml"; // é»˜è®¤
    }

    if (!m_config.LoadFromYaml(main_config, secret_config)) {
        return false;
    }
    // ...
}
```

**éªŒè¯ç»“æœ**: âœ… Counter Bridge æˆåŠŸåŠ è½½ CTP Plugin

---

### é—®é¢˜2: CTP MD Gateway å‘½ä»¤è¡Œå‚æ•°æ ¼å¼é”™è¯¯

**ç°è±¡**:
```
[ERROR] CTP è¡Œæƒ…ç½‘å…³å¯åŠ¨å¤±è´¥
Options:
  -c, --config FILE        Config file path
  -s, --secret FILE        Secret file path
```

**åŸå› **:
å¯åŠ¨è„šæœ¬ä½¿ç”¨ä½ç½®å‚æ•°è€Œéæ ‡å¿—å‚æ•°ï¼š
```bash
./gateway/build/ctp_md_gateway config/ctp/ctp_md.yaml config/ctp/ctp_md.secret.yaml
```

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹ `scripts/live/start_ctp_live.sh:85`ï¼Œä½¿ç”¨ `-c` å’Œ `-s` æ ‡å¿—ï¼š

```bash
./gateway/build/ctp_md_gateway \
    -c config/ctp/ctp_md.yaml \
    -s config/ctp/ctp_md.secret.yaml \
    > log/ctp_md_gateway.log 2>&1 &
```

**éªŒè¯ç»“æœ**: âœ… CTP MD Gateway æˆåŠŸå¯åŠ¨å¹¶ç™»å½•

---

### é—®é¢˜3: ç­–ç•¥æ¿€æ´»åç«‹å³è¢«åœç”¨

**ç°è±¡**:
```
[StrategyManager] Strategy live_ag_spread activated
[Trader] Trading session ended - stopping strategy live_ag_spread
[live_ag_spread] Strategy deactivated
```

**åŸå› åˆ†æ**:
1. Session Manager æ£€æŸ¥äº¤æ˜“æ—¶æ®µï¼Œå‘ç°ä¸åœ¨æ—¶æ®µå†…
2. é…ç½®æ–‡ä»¶ä¸­æ—¥ç›˜æ—¶é—´: `start_time: "08:55:00"`, `end_time: "15:05:00"`
3. å½“å‰æ—¶é—´ 21:49 ä¸åœ¨æ­¤èŒƒå›´å†…
4. é…ç½®ä¸­æœ‰ `night_session` å­—æ®µï¼Œä½† `SessionConfig` ç»“æ„ä½“æœªå®šä¹‰æ­¤å­—æ®µ
5. å¤œç›˜é…ç½®è¢«å¿½ç•¥ï¼Œå¯¼è‡´å¤œç›˜æ—¶é—´è¢«è®¤ä¸ºä¸åœ¨äº¤æ˜“æ—¶æ®µ

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹ `config/trader.live.yaml:88`ï¼Œæš‚æ—¶ä½¿ç”¨å…¨å¤©äº¤æ˜“é…ç½®ï¼š

```yaml
session:
  start_time: "00:00:00"     # å…¨å¤©äº¤æ˜“
  end_time: "23:59:59"       # å…¨å¤©äº¤æ˜“
  auto_stop: false           # ç¦ç”¨è‡ªåŠ¨åœæ­¢
```

**é•¿æœŸæ–¹æ¡ˆ**:
éœ€è¦æ‰©å±• `SessionConfig` ç»“æ„ä½“æ”¯æŒ `night_session` å­—æ®µã€‚

**éªŒè¯ç»“æœ**: âœ… ç­–ç•¥ä¿æŒæ¿€æ´»çŠ¶æ€

---

### é—®é¢˜4: Trader å¯åŠ¨æ—¶ Panic (æ•°ç»„è¶Šç•Œ)

**ç°è±¡**:
```
panic: runtime error: index out of range [0] with length 0
goroutine 11 [running]:
github.com/yourusername/quantlink-trade-system/pkg/strategy.(*StrategyEngine).SubscribeMarketData.func1
    /Users/user/PWorks/RD/quantlink-trade-system/golang/pkg/strategy/engine.go:244
```

**åŸå› **:
CTP MD Gateway å‘é€çš„è¡Œæƒ…æ•°æ®ä¸­ BidPrice å’Œ AskPrice æ•°ç»„å¯èƒ½ä¸ºç©ºï¼Œç›´æ¥è®¿é—® `md.BidPrice[0]` å¯¼è‡´è¶Šç•Œã€‚

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹ `golang/pkg/strategy/engine.go:243`ï¼Œæ·»åŠ æ•°ç»„é•¿åº¦æ£€æŸ¥ï¼š

```go
bidPrice := 0.0
askPrice := 0.0
if len(md.BidPrice) > 0 {
    bidPrice = md.BidPrice[0]
}
if len(md.AskPrice) > 0 {
    askPrice = md.AskPrice[0]
}
log.Printf("[StrategyEngine] Received market data: %s (bid: %.2f, ask: %.2f)",
    md.Symbol, bidPrice, askPrice)
```

**éªŒè¯ç»“æœ**: âœ… Trader æˆåŠŸå¯åŠ¨å¹¶æ¥æ”¶è¡Œæƒ…

---

### é—®é¢˜5: Model æ–‡ä»¶ç¼ºå¤±

**ç°è±¡**:
é…ç½®æ–‡ä»¶å¼•ç”¨çš„ model æ–‡ä»¶ä¸å­˜åœ¨ï¼š
- `golang/models/model.live_ag_spread.txt`
- `golang/models/model.live_au_spread.txt`

**è§£å†³æ–¹æ¡ˆ**:
åˆ›å»ºåˆå§‹ model æ–‡ä»¶ï¼š

```bash
mkdir -p golang/models
cat > golang/models/model.live_ag_spread.txt << 'EOF'
spread_mean=0.0
spread_std=0.0
hedge_ratio=1.0
correlation=0.0
EOF
```

**éªŒè¯ç»“æœ**: âœ… Model æ–‡ä»¶åˆ›å»ºæˆåŠŸ

---

### é—®é¢˜6: ç­–ç•¥å‚æ•°é…ç½®è¿‡äºä¿å®ˆ

**ç°è±¡**:
- `lookback_period: 200` - éœ€è¦ç§¯ç´¯200ä¸ªæ•°æ®ç‚¹æ‰èƒ½è®¡ç®—ç›¸å…³æ€§
- `entry_zscore: 2.5` - å…¥åœºé˜ˆå€¼è¿‡é«˜ï¼Œä¸æ˜“è§¦å‘

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹ `config/trader.live.yaml:32` ç­–ç•¥å‚æ•°ï¼Œä¾¿äºæµ‹è¯•ï¼š

```yaml
parameters:
  lookback_period: 20.0      # æµ‹è¯•: 20ä¸ªæ•°æ®ç‚¹ (çº¦20ç§’)
  entry_zscore: 1.5          # æµ‹è¯•: é™ä½é˜ˆå€¼
```

**éªŒè¯ç»“æœ**: âœ… ç­–ç•¥æ›´å¿«ç§¯ç´¯æ•°æ®å¹¶ç”Ÿæˆäº¤æ˜“ä¿¡å·

---

## ğŸš€ å¯åŠ¨æµç¨‹

### å®Œæ•´å¯åŠ¨è„šæœ¬

**æ–‡ä»¶**: `scripts/live/start_ctp_live.sh`

```bash
#!/bin/bash
set -e

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
cd "$PROJECT_ROOT"

# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶
log_info "[1/8] æ£€æŸ¥é…ç½®æ–‡ä»¶..."
# (æ£€æŸ¥ ctp_md.secret.yaml, ctp_td.secret.yaml, trader.live.yaml)

# 2. åˆ›å»ºç›®å½•
log_info "[2/8] åˆ›å»ºæ—¥å¿—ç›®å½•..."
mkdir -p log data/ctp_positions test_logs

# 3. å¯åŠ¨ NATS
log_info "[3/8] å¯åŠ¨ NATS server..."
nats-server > log/nats.log 2>&1 &

# 4. å¯åŠ¨ CTP MD Gateway
log_info "[4/8] å¯åŠ¨ CTP è¡Œæƒ…ç½‘å…³..."
./gateway/build/ctp_md_gateway \
    -c config/ctp/ctp_md.yaml \
    -s config/ctp/ctp_md.secret.yaml \
    > log/ctp_md_gateway.log 2>&1 &

# 5. å¯åŠ¨ MD Gateway
log_info "[5/8] å¯åŠ¨ MD Gateway..."
./gateway/build/md_gateway > log/md_gateway.log 2>&1 &

# 6. å¯åŠ¨ ORS Gateway
log_info "[6/8] å¯åŠ¨ ORS Gateway..."
./gateway/build/ors_gateway > log/ors_gateway.log 2>&1 &

# 7. å¯åŠ¨ Counter Bridge (CTP)
log_info "[7/8] å¯åŠ¨ Counter Bridge (CTP Plugin)..."
./gateway/build/counter_bridge \
    ctp:config/ctp/ctp_td.yaml:config/ctp/ctp_td.secret.yaml \
    > log/counter_bridge_ctp.log 2>&1 &

# 8. å¯åŠ¨ Trader
log_info "[8/8] å¯åŠ¨ Trader (å®ç›˜é…ç½®)..."
./bin/trader -config config/trader.live.yaml > log/trader.live.log 2>&1 &
```

### æ‰‹åŠ¨å¯åŠ¨æ­¥éª¤

å¦‚æœè„šæœ¬å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨é€æ­¥å¯åŠ¨ï¼š

```bash
# 1. å¯åŠ¨ NATS
nats-server &

# 2. å¯åŠ¨ CTP MD Gateway
./gateway/build/ctp_md_gateway \
    -c config/ctp/ctp_md.yaml \
    -s config/ctp/ctp_md.secret.yaml &

# 3. å¯åŠ¨ MD Gateway
./gateway/build/md_gateway &

# 4. å¯åŠ¨ ORS Gateway
./gateway/build/ors_gateway &

# 5. å¯åŠ¨ Counter Bridge
./gateway/build/counter_bridge \
    ctp:config/ctp/ctp_td.yaml:config/ctp/ctp_td.secret.yaml &

# 6. å¯åŠ¨ Trader
./bin/trader -config config/trader.live.yaml &

# 7. ç­‰å¾…5ç§’åæ¿€æ´»ç­–ç•¥
sleep 5
curl -X POST http://localhost:9201/api/v1/strategies/live_ag_spread/activate
```

---

## âœ… éªŒè¯ç»“æœ

### ç³»ç»ŸçŠ¶æ€

**æ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸**:

| æœåŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| NATS Server | âœ“ è¿è¡Œä¸­ | æ¶ˆæ¯ä¸­é—´ä»¶ |
| CTP MD Gateway | âœ“ è¿è¡Œä¸­ | CTPè¡Œæƒ…ç½‘å…³ (Trading Day: 20260202) |
| MD Gateway | âœ“ è¿è¡Œä¸­ | è¡Œæƒ…ç½‘å…³ (å…±äº«å†…å­˜â†’NATS) |
| ORS Gateway | âœ“ è¿è¡Œä¸­ | è®¢å•è·¯ç”±æœåŠ¡ |
| Counter Bridge | âœ“ è¿è¡Œä¸­ | CTPäº¤æ˜“ç½‘å…³ (Session: -1256875606) |
| Trader | âœ“ è¿è¡Œä¸­ | ç­–ç•¥äº¤æ˜“å¼•æ“ |

### CTPè¿æ¥çŠ¶æ€

**è¡Œæƒ…è¿æ¥**:
```
[CTPMDGateway] âœ… Connected to front server
[CTPMDGateway] âœ… Login successful
  Trading Day: 20260202
[CTPMDGateway] âœ… Subscribed: ag2603
[CTPMDGateway] âœ… Subscribed: ag2605
```

**äº¤æ˜“è¿æ¥**:
```
[CTPTDPlugin] âœ… Connected to front server
[CTPTDPlugin] âœ… Authentication successful
[CTPTDPlugin] âœ… Login successful
  Trading Day: 20260202
  Login Time: 21:41:41
  Front ID: 1
  Session ID: -1256875606
```

**æŒä»“æŸ¥è¯¢**:
```
[CTPTDPlugin] Position: ag2603 Long=0(T:0,Y:0) Short=3(T:0,Y:3)
[CTPTDPlugin] Position: ag2605 Long=4(T:0,Y:4) Short=1(T:0,Y:1)
[CTPTDPlugin] âœ“ Position updated from CTP (2 symbols)
```

### ç­–ç•¥è¿è¡ŒçŠ¶æ€

**ç­–ç•¥æ¿€æ´»**:
```
[API] Activating strategy: live_ag_spread
[StrategyManager] Strategy live_ag_spread activated
[PairwiseArbStrategy:live_ag_spread] Started
```

**å®æ—¶è¡Œæƒ…æ¥æ”¶**:
```
[StrategyEngine] Received market data: ag2603 (bid: 26176.00, ask: 26211.00)
[StrategyEngine] Received market data: ag2605 (bid: 24866.00, ask: 24869.00)
```

**ç­–ç•¥ç»Ÿè®¡è®¡ç®—**:
```
[PairwiseArb:live_ag_spread] Stats: zscore=0.00 (need Â±1.50), corr=0.000 (need 0.700), std=0.0000, ready=false, condMet=false
```

### å®ç›˜äº¤æ˜“éªŒè¯

**è®¢å•å‘é€**:
```
[StrategyEngine] Order sent: live_ag_spread, OrderID: ORD_1769781112362_000001, Status: SUCCESS
```

**è®¢å•æˆäº¤**:
```
[WebSocket] Order ORD_1769781112362_000001 mapped to status: FILLED
```

**æŒä»“æ›´æ–°**:
```
[PairwiseArb:live_ag_spread] ğŸ“Š Leg1(ag2603) P&L: -46.00 (Pos=-2, AvgCost=26165.00, Counter=26188.00)
[PairwiseArb:live_ag_spread] ğŸ’° Total P&L: Realized=0.00, Unrealized=-46.00, Total=-46.00
```

**ç­–ç•¥å°è¯•å¹³ä»“**:
```
[PairwiseArbStrategy:live_ag_spread] Exiting spread: z=-0.06, leg1=1 2, leg2=1 0
[StrategyEngine] Order sent: live_ag_spread, OrderID: ORD_1769781127846_000002, Status: SUCCESS
```

---

## ğŸ“Š Dashboard å¯è§†åŒ–

**è®¿é—®åœ°å€**: http://localhost:9201/dashboard

**æ˜¾ç¤ºä¿¡æ¯**:
- ç­–ç•¥çŠ¶æ€: Active / Running
- å®æ—¶è¡Œæƒ…: ag2603 Â¥26684, ag2605 Â¥25299
- å½“å‰ä»·å·®: 1383.50
- ç›¸å…³æ€§: 0.0000 (ç§¯ç´¯ä¸­)
- Z-Score: 0.0000 (ç§¯ç´¯ä¸­)
- æŒä»“: ag2603 ç©º2æ‰‹
- ç›ˆäº: æµ®åŠ¨äºæŸ -22å…ƒ

---

## ğŸ“ å…³é”®é…ç½®

### trader.live.yaml (å…³é”®éƒ¨åˆ†)

```yaml
system:
  mode: "live"
  multi_strategy: true

strategies:
  - id: "live_ag_spread"
    type: "pairwise_arb"
    symbols: ["ag2603", "ag2605"]
    max_position_size: 20
    parameters:
      lookback_period: 20.0        # æµ‹è¯•: å¿«é€Ÿç§¯ç´¯æ•°æ®
      entry_zscore: 1.5            # æµ‹è¯•: é™ä½å…¥åœºé˜ˆå€¼
      exit_zscore: 0.8
      order_size: 2.0
      min_correlation: 0.7
      slippage_ticks: 2

session:
  start_time: "00:00:00"           # å…¨å¤©äº¤æ˜“
  end_time: "23:59:59"
  auto_stop: false                 # ç¦ç”¨è‡ªåŠ¨åœæ­¢

engine:
  ors_gateway_addr: "localhost:50052"
  counter_bridge_addr: "localhost:8080"
  nats_addr: "nats://localhost:4222"
  enable_position_sync: true
  position_sync_interval_sec: 60

api:
  enabled: true
  port: 9201
```

### CTP é…ç½®æ–‡ä»¶

**ctp_md.yaml**:
```yaml
ctp:
  front_address: "tcp://182.254.243.31:30011"
  broker_id: "9999"
  app_id: "simnow_client_test"

instruments:
  - "ag2603"
  - "ag2605"

shared_memory:
  queue_name: "queue"
  queue_size: 10000
```

**ctp_td.yaml**:
```yaml
ctp:
  front_address: "tcp://182.254.243.31:30011"
  broker_id: "9999"
  app_id: "simnow_client_test"

shared_memory:
  request_queue_name: "ors_request"
  response_queue_name: "ors_response"
```

---

## ğŸ” ç›‘æ§å‘½ä»¤

### æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€

```bash
# æ£€æŸ¥æ‰€æœ‰è¿›ç¨‹
ps aux | grep -E "nats-server|ctp_md_gateway|md_gateway|ors_gateway|counter_bridge|trader" | grep -v grep

# æŸ¥çœ‹ç­–ç•¥çŠ¶æ€
curl http://localhost:9201/api/v1/strategies | jq .

# æŸ¥çœ‹æŒä»“
curl http://localhost:8080/positions | jq .
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶ç›‘æ§ Trader
tail -f log/trader.live.log

# ç›‘æ§ç­–ç•¥ç»Ÿè®¡
tail -f log/trader.live.log | grep "Stats:"

# ç›‘æ§è®¢å•
tail -f log/trader.live.log | grep "Order"

# ç›‘æ§è¡Œæƒ…
tail -f log/trader.live.log | grep "market data"

# æŸ¥çœ‹ CTP ç™»å½•
tail -100 log/counter_bridge_ctp.log | grep -E "Login|Position"
```

### API æ“ä½œ

```bash
# æ¿€æ´»ç­–ç•¥
curl -X POST http://localhost:9201/api/v1/strategies/live_ag_spread/activate

# åœç”¨ç­–ç•¥
curl -X POST http://localhost:9201/api/v1/strategies/live_ag_spread/deactivate

# æŸ¥çœ‹ç­–ç•¥è¯¦æƒ…
curl http://localhost:9201/api/v1/strategies/live_ag_spread | jq .

# æŸ¥çœ‹æŒä»“
curl http://localhost:9201/api/v1/positions | jq .
```

---

## ğŸ“¦ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### C++ Gateway

1. **gateway/plugins/ctp/src/ctp_td_plugin.cpp**
   - ä¿®å¤ Initialize() é…ç½®æ–‡ä»¶è§£æ
   - æ”¯æŒ "config1:config2" æ ¼å¼

### Golang Trader

2. **golang/pkg/strategy/engine.go**
   - ä¿®å¤ SubscribeMarketData æ•°ç»„è¶Šç•Œé—®é¢˜
   - æ·»åŠ æ•°ç»„é•¿åº¦æ£€æŸ¥

### é…ç½®æ–‡ä»¶

3. **config/trader.live.yaml**
   - ä¿®æ”¹ session é…ç½®ä¸ºå…¨å¤©äº¤æ˜“
   - é™ä½ lookback_period å’Œ entry_zscore

### Model æ–‡ä»¶

4. **golang/models/model.live_ag_spread.txt** (æ–°å¢)
   - åˆå§‹åŒ–ç­–ç•¥å‚æ•°

5. **golang/models/model.live_au_spread.txt** (æ–°å¢)
   - åˆå§‹åŒ–ç­–ç•¥å‚æ•°

### è„šæœ¬

6. **scripts/live/start_ctp_live.sh** (æ–°å¢)
   - å®Œæ•´çš„ CTP å®ç›˜å¯åŠ¨è„šæœ¬
   - ä¿®å¤ ctp_md_gateway å‘½ä»¤è¡Œå‚æ•°

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®ç›˜äº¤æ˜“é£é™©

1. **ç­–ç•¥å‚æ•°å·²è°ƒæ•´ä¸ºæµ‹è¯•é…ç½®**:
   - lookback_period=20 (ä»…20ä¸ªæ•°æ®ç‚¹)
   - entry_zscore=1.5 (é˜ˆå€¼è¾ƒä½)
   - è¿™ä¼šå¯¼è‡´æ›´é¢‘ç¹çš„äº¤æ˜“å’Œæ›´å¤§çš„é£é™©

2. **ç”Ÿäº§ç¯å¢ƒå»ºè®®**:
   - lookback_period â‰¥ 200
   - entry_zscore â‰¥ 2.5
   - ä¸¥æ ¼ç›‘æ§å‰å‡ ç¬”è®¢å•

3. **Session Manager é™åˆ¶**:
   - å½“å‰é…ç½®ä¸ºå…¨å¤©äº¤æ˜“ (00:00-23:59)
   - æœªå®ç°å¤œç›˜é…ç½®æ”¯æŒ
   - éœ€è¦æ‰‹åŠ¨æ§åˆ¶äº¤æ˜“æ—¶æ®µ

### å·²çŸ¥é—®é¢˜

1. **å¤œç›˜é…ç½®æœªç”Ÿæ•ˆ**:
   - `SessionConfig` ç»“æ„ä½“ç¼ºå°‘ `night_session` å­—æ®µ
   - é…ç½®æ–‡ä»¶ä¸­çš„ night_session è¢«å¿½ç•¥
   - **TODO**: æ‰©å±• SessionConfig æ”¯æŒå¤œç›˜

2. **éƒ¨åˆ†è®¢å•å‚æ•°æ— æ•ˆ**:
   - æ—¥å¿—ä¸­å‡ºç° `INVALID_PARAMETER` é”™è¯¯
   - éœ€è¦è¿›ä¸€æ­¥è°ƒæŸ¥è®¢å•å‚æ•°éªŒè¯é€»è¾‘

3. **CTP MD æ•°ç»„å¯èƒ½ä¸ºç©º**:
   - BidPrice/AskPrice æ•°ç»„é•¿åº¦ä¸ä¸€å®š â‰¥ 1
   - å·²æ·»åŠ ä¿æŠ¤æ€§æ£€æŸ¥

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å»¶è¿Ÿæµ‹è¯•

- **è¡Œæƒ…æ¥æ”¶å»¶è¿Ÿ**: < 10ms
- **è®¢å•å‘é€å»¶è¿Ÿ**: < 50ms
- **è®¢å•æˆäº¤å»¶è¿Ÿ**: < 200ms (CTP SimNow)

### èµ„æºå ç”¨

- **CPU**: æ¯ä¸ªè¿›ç¨‹ < 5%
- **å†…å­˜**: æ¯ä¸ªè¿›ç¨‹ < 50MB
- **ç½‘ç»œ**: < 1MB/min

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### çŸ­æœŸä¼˜åŒ–

1. âœ… ~~ä¿®å¤ Counter Bridge é…ç½®è§£æ~~
2. âœ… ~~ä¿®å¤ Trader æ•°ç»„è¶Šç•Œ~~
3. âœ… ~~åˆ›å»ºå¯åŠ¨è„šæœ¬~~
4. â³ å®ç°å¤œç›˜é…ç½®æ”¯æŒ
5. â³ ä¼˜åŒ–è®¢å•å‚æ•°éªŒè¯
6. â³ æ·»åŠ æ›´å¤šé£æ§æ£€æŸ¥

### ä¸­æœŸæ”¹è¿›

1. å®ç°ç­–ç•¥å‚æ•°åŠ¨æ€æ›´æ–° API
2. æ·»åŠ å®æ—¶é£æ§å‘Šè­¦
3. å®Œå–„ Dashboard åŠŸèƒ½
4. æ·»åŠ è®¢å•æ’¤å•åŠŸèƒ½
5. å®ç°ç­–ç•¥çƒ­æ›´æ–°

### é•¿æœŸè§„åˆ’

1. æ”¯æŒå¤šäº¤æ˜“æ‰€æ¥å…¥
2. å®ç°é«˜çº§é£æ§ç­–ç•¥
3. æ·»åŠ å›æµ‹éªŒè¯åŠŸèƒ½
4. å®ç°ç­–ç•¥ç»„åˆç®¡ç†
5. å¼€å‘ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ä»Šæ˜¨ä»“å®æ–½æŠ¥å‘Š**: @docs/å®ç›˜/CTP_Plugin_ä»Šæ˜¨ä»“å®Œæ•´å®æ–½æŠ¥å‘Š_2026-01-30.md
- **æŒä»“ç®¡ç†æŠ¥å‘Š**: @docs/å®ç›˜/Phase2-5_å®Œæ•´æŒä»“ç®¡ç†åŠŸèƒ½å®æ–½æŠ¥å‘Š_2026-01-30-11_35.md
- **ç³»ç»Ÿæ¶æ„**: @docs/æ ¸å¿ƒæ–‡æ¡£/CURRENT_ARCHITECTURE_FLOW.md
- **ä½¿ç”¨æŒ‡å—**: @docs/æ ¸å¿ƒæ–‡æ¡£/USAGE.md

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### å¸¸è§é”™è¯¯

#### 1. Counter Bridge å¯åŠ¨å¤±è´¥

**ç°è±¡**: YAML parsing error

**è§£å†³**: æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œç¡®ä¿ä½¿ç”¨ `:` åˆ†éš”ä¸¤ä¸ªé…ç½®æ–‡ä»¶

#### 2. Trader Panic

**ç°è±¡**: index out of range

**è§£å†³**: é‡æ–°ç¼–è¯‘ trader (å·²ä¿®å¤æ•°ç»„è¶Šç•Œ)

#### 3. ç­–ç•¥ç«‹å³åœç”¨

**ç°è±¡**: Trading session ended

**è§£å†³**: ä¿®æ”¹ config/trader.live.yaml çš„ session é…ç½®

#### 4. æ— æ³•è¿æ¥ CTP

**ç°è±¡**: Connection failed

**è§£å†³**: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®è®¤ SimNow è´¦å·å¯†ç æ­£ç¡®

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-30 21:52:00
**ç³»ç»ŸçŠ¶æ€**: âœ… è¿è¡Œæ­£å¸¸
**å½“å‰äº¤æ˜“**: âœ… ç­–ç•¥å·²æ¿€æ´»ï¼Œå®ç›˜äº¤æ˜“ä¸­

**ä½œè€…**: QuantLink Team
**ç‰ˆæœ¬**: v1.0
