# HFTç³»ç»Ÿå½“å‰æ¶æ„å’Œè°ƒç”¨æµç¨‹

## æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Application Layer (Golang)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Strategy Engine (æœªå®ç°)                     â”‚   â”‚
â”‚  â”‚  - PassiveStrategy                                                â”‚   â”‚
â”‚  â”‚  - AggressiveStrategy                                             â”‚   â”‚
â”‚  â”‚  - HedgingStrategy                                                â”‚   â”‚
â”‚  â”‚  - PairwiseArbStrategy                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â†“ â†‘                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Indicator Library (âœ… å·²å®ç°)                       â”‚    â”‚
â”‚  â”‚  - EWMA, OrderImbalance, VWAP, Spread, Volatility               â”‚    â”‚
â”‚  â”‚  - 7ä¸ªæ ¸å¿ƒæŒ‡æ ‡ + æ‰©å±•æ¥å£                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â†“ â†‘                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  ORS Client (âœ… å·²å®ç°)                           â”‚   â”‚
â”‚  â”‚  - gRPCè®¢å•å‘é€                                                   â”‚   â”‚
â”‚  â”‚  - NATSè®¢å•å›æŠ¥è®¢é˜…                                               â”‚   â”‚
â”‚  â”‚  - æµ‹è¯•æ¨¡å¼: single/batch/monitor                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“ â†‘
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   NATS Message Bus  â”‚
                          â”‚  (Pub/Subé€šä¿¡)      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Gateway Layer (C++)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   MD Gateway (æœªå®Œæ•´)     â”‚          â”‚  ORS Gateway (âœ… å·²å®ç°)  â”‚   â”‚
â”‚  â”‚  - gRPCæœåŠ¡               â”‚          â”‚  - gRPCæœåŠ¡               â”‚   â”‚
â”‚  â”‚  - NATSå‘å¸ƒè¡Œæƒ…           â”‚          â”‚  - NATSå‘å¸ƒè®¢å•å›æŠ¥       â”‚   â”‚
â”‚  â”‚  - å…±äº«å†…å­˜è¯»å–           â”‚          â”‚  - å…±äº«å†…å­˜è¯»å†™           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â†“                                      â†“ â†‘                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  MD Shared Memory  â”‚              â”‚  ORS Shared Memory     â”‚         â”‚
â”‚  â”‚  (SPSC Queue)      â”‚              â”‚  Request/Response      â”‚         â”‚
â”‚  â”‚  [æœªä½¿ç”¨]          â”‚              â”‚  (SPSC Queues)         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                â†“ â†‘                       â”‚
â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                      â”‚ Counter Bridge (âœ… å·²å®ç°)   â”‚   â”‚
â”‚                                      â”‚  - è¯»å–Requesté˜Ÿåˆ—            â”‚   â”‚
â”‚                                      â”‚  - å†™å…¥Responseé˜Ÿåˆ—           â”‚   â”‚
â”‚                                      â”‚  - è°ƒç”¨Counter API            â”‚   â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                â†“ â†‘                       â”‚
â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                      â”‚  Counter API (âœ… å·²å®ç°)      â”‚   â”‚
â”‚                                      â”‚  - ICounterAPIæ¥å£            â”‚   â”‚
â”‚                                      â”‚  - SimulatedCounterå®ç°       â”‚   â”‚
â”‚                                      â”‚  - æœªæ¥: EES/CTPæŸœå°          â”‚   â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â†“ â†‘
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  æ¨¡æ‹Ÿäº¤æ˜“æ‰€          â”‚
                                    â”‚  - è®¢å•æ¥å— (10ms)   â”‚
                                    â”‚  - è®¢å•æˆäº¤ (50ms)   â”‚
                                    â”‚  - æˆäº¤æ¦‚ç‡ 95%      â”‚
                                    â”‚  - æ‹’ç»æ¦‚ç‡ 2%       â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å½“å‰å·²å®ç°çš„è°ƒç”¨æµç¨‹

### æµç¨‹1: è®¢å•å‘é€æµç¨‹ (å®Œæ•´å¯ç”¨ âœ…)

```
[Golang ORS Client]
    â”‚
    â”‚ 1. æ„é€ OrderRequest protobuf
    â”‚    - strategy_id: "test_strategy_1"
    â”‚    - symbol: "ag2412"
    â”‚    - side: BUY/SELL
    â”‚    - price: 7950.0
    â”‚    - quantity: 10
    â”‚
    â†“ gRPCè°ƒç”¨ (localhost:50052)
    â”‚
[ORS Gateway - gRPC Service]
    â”‚
    â”‚ 2. æ¥æ”¶gRPCè¯·æ±‚
    â”‚    - ORSGatewayImpl::SendOrder()
    â”‚    - ç”Ÿæˆorder_id: ORD_{timestamp}_{counter}
    â”‚    - è½¬æ¢ä¸ºOrderRequestRawç»“æ„
    â”‚
    â”‚ 3. åŠ å…¥å†…éƒ¨é˜Ÿåˆ—
    â”‚    - m_pending_requests.push(raw_req)
    â”‚    - è¿”å›gRPCå“åº” (å»¶è¿Ÿ: ~6Î¼s)
    â”‚
    â†“
    â”‚
[ORS Gateway - Request Writer Thread]
    â”‚
    â”‚ 4. ä»å†…éƒ¨é˜Ÿåˆ—è¯»å–
    â”‚    - gateway->GetOrderRequest(&raw_req)
    â”‚    - å†™å…¥å…±äº«å†…å­˜Requesté˜Ÿåˆ—
    â”‚    - req_queue->Push(raw_req)
    â”‚
    â†“ å…±äº«å†…å­˜ (POSIX shm, lock-free SPSC)
    â”‚
[Counter Bridge - Request Reader Thread]
    â”‚
    â”‚ 5. ä»å…±äº«å†…å­˜è¯»å–
    â”‚    - req_queue->Pop(raw_req)
    â”‚    - è¯»å–å»¶è¿Ÿ: ~1-2Î¼s
    â”‚
    â”‚ 6. å‘é€åˆ°Counter API
    â”‚    - counter->SendOrder(raw_req, order_id)
    â”‚    - ç”Ÿæˆexchange_order_id: EX_{timestamp}_{counter}
    â”‚
    â†“
    â”‚
[Simulated Counter - Process Thread]
    â”‚
    â”‚ 7. å¤„ç†è®¢å•
    â”‚    - åŠ å…¥pending_ordersé˜Ÿåˆ—
    â”‚    - éšæœºå†³å®šæ¥å—/æ‹’ç» (2%æ‹’ç»æ¦‚ç‡)
    â”‚
    â”‚ 8a. è®¢å•æ¥å—
    â”‚    - å»¶è¿Ÿ10ms
    â”‚    - å›è°ƒ: OnOrderAccept()
    â”‚    - status: ACCEPTED
    â”‚
    â”‚ 8b. è®¢å•æˆäº¤
    â”‚    - å»¶è¿Ÿ50ms
    â”‚    - å›è°ƒ: OnOrderFilled()
    â”‚    - status: FILLED
    â”‚    - æˆäº¤æ¦‚ç‡: 95%
    â”‚
    â†“
    â”‚
[Counter Bridge - Callback]
    â”‚
    â”‚ 9. å¡«å……å“åº”æ•°æ®
    â”‚    - OrderResponseRawç»“æ„
    â”‚    - å¡«å……order_id, status, price, quantity
    â”‚
    â”‚ 10. å†™å…¥Responseé˜Ÿåˆ—
    â”‚    - resp_queue->Push(resp)
    â”‚
    â†“ å…±äº«å†…å­˜
    â”‚
[ORS Gateway - Response Reader Thread]
    â”‚
    â”‚ 11. ä»å…±äº«å†…å­˜è¯»å–å“åº”
    â”‚    - resp_queue->Pop(raw_resp)
    â”‚    - è½¬æ¢ä¸ºOrderUpdate protobuf
    â”‚
    â”‚ 12. æ›´æ–°è®¢å•ç°¿
    â”‚    - gateway->OnOrderResponse(update)
    â”‚    - æ›´æ–°å†…éƒ¨è®¢å•çŠ¶æ€
    â”‚
    â”‚ 13. å‘å¸ƒNATSæ¶ˆæ¯
    â”‚    - ä¸»é¢˜: "order.{strategy_id}.{symbol}"
    â”‚    - ä¾‹å¦‚: "order.test_strategy_1.ag2412"
    â”‚
    â†“ NATSæ¶ˆæ¯æ€»çº¿
    â”‚
[Golang ORS Client - NATS Subscriber]
    â”‚
    â”‚ 14. æ¥æ”¶è®¢å•æ›´æ–°
    â”‚    - è®¢é˜…é€šé…ç¬¦: "order.test_strategy_1.>"
    â”‚    - å›è°ƒ: onOrderUpdate()
    â”‚    - æ‰“å°è®¢å•çŠ¶æ€å˜åŒ–
    â”‚
    â””â”€â†’ è®¢å•æµç¨‹å®Œæˆ
```

### æµç¨‹2: è¡Œæƒ…æ•°æ®æµ (éƒ¨åˆ†å®ç° ğŸš§)

```
[è¡Œæƒ…æº] (æœªå®ç°)
    â”‚
    â†“ (æœªæ¥: TCP/UDPæ¥æ”¶è¡Œæƒ…)
    â”‚
[MD Gateway] (æ¡†æ¶å­˜åœ¨ï¼Œä½†æœªè¿æ¥)
    â”‚
    â”‚ - è§£æåŸå§‹è¡Œæƒ…æ•°æ®
    â”‚ - å†™å…¥MD Shared Memory
    â”‚ - å‘å¸ƒåˆ°NATS
    â”‚
    â†“ å…±äº«å†…å­˜ + NATS
    â”‚
[Golang Strategy Engine] (æœªå®ç°)
    â”‚
    â”‚ - è®¢é˜…è¡Œæƒ…: "md.{symbol}"
    â”‚ - æ›´æ–°Indicator Library
    â”‚ - ç”Ÿæˆäº¤æ˜“ä¿¡å·
    â”‚
    â””â”€â†’ è°ƒç”¨ORS Clientå‘é€è®¢å•
```

### æµç¨‹3: æŒ‡æ ‡è®¡ç®—æµç¨‹ (å·²å®ç°ä½†æœªé›†æˆ âœ…)

```
[è¡Œæƒ…æ•°æ® MarketDataUpdate]
    â”‚
    â”‚ protobufç»“æ„:
    â”‚ - symbol: "ag2412"
    â”‚ - exchange: "SHFE"
    â”‚ - bid_price[]: [7949, 7947, ...]
    â”‚ - bid_qty[]: [100, 80, ...]
    â”‚ - ask_price[]: [7951, 7953, ...]
    â”‚ - ask_qty[]: [95, 75, ...]
    â”‚ - last_price: 7950.0
    â”‚
    â†“
    â”‚
[IndicatorLibrary]
    â”‚
    â”‚ UpdateAll(md):
    â”‚ â”œâ”€â†’ EWMA.Update(md)
    â”‚ â”‚   â””â”€â†’ è®¡ç®—æŒ‡æ•°ç§»åŠ¨å¹³å‡: 7950.5529
    â”‚ â”‚
    â”‚ â”œâ”€â†’ OrderImbalance.Update(md)
    â”‚ â”‚   â””â”€â†’ è®¡ç®—ä¹°å–ä¸å¹³è¡¡: 0.0323 (ä¹°ç›˜ç•¥å¼º)
    â”‚ â”‚
    â”‚ â”œâ”€â†’ VWAP.Update(md)
    â”‚ â”‚   â””â”€â†’ è®¡ç®—æˆäº¤é‡åŠ æƒå‡ä»·: 7949.1325
    â”‚ â”‚
    â”‚ â”œâ”€â†’ Spread.Update(md)
    â”‚ â”‚   â””â”€â†’ è®¡ç®—ä¹°å–ä»·å·®: 2.0
    â”‚ â”‚
    â”‚ â””â”€â†’ Volatility.Update(md)
    â”‚     â””â”€â†’ è®¡ç®—æ³¢åŠ¨ç‡: 0.000755
    â”‚
    â†“
    â”‚
[Strategy Engine] (æœªå®ç°)
    â”‚
    â”‚ ä½¿ç”¨æŒ‡æ ‡å€¼ç”Ÿæˆä¿¡å·:
    â”‚ - if (order_imbalance > 0.05 && price < vwap):
    â”‚     signal = BUY
    â”‚ - if (volatility > threshold):
    â”‚     reduce_position_size()
    â”‚
    â””â”€â†’ ç”ŸæˆTradingSignal
```

## å½“å‰æµ‹è¯•çš„å®Œæ•´é“¾è·¯

### æµ‹è¯•åœºæ™¯: å‘é€å•ç¬”è®¢å•

```bash
# ç»ˆç«¯1: å¯åŠ¨NATS
$ nats-server

# ç»ˆç«¯2: å¯åŠ¨ORS Gateway
$ cd /Users/user/PWorks/RD/quantlink-trade-system/gateway/build
$ ./ors_gateway
[ORSGateway] Connected to NATS: nats://localhost:4222
[ORSGateway] gRPC Server: 0.0.0.0:50052

# ç»ˆç«¯3: å¯åŠ¨Counter Bridge
$ ./counter_bridge
[SimCounter] Connected successfully
[Counter Bridge started successfully]

# ç»ˆç«¯4: å‘é€æµ‹è¯•è®¢å•
$ cd /Users/user/PWorks/RD/quantlink-trade-system/golang
$ ./bin/ors_client -mode single -symbol ag2412

Order Response:
  Order ID:    ORD_1768909036580_000000
  Status:      SUCCESS
  Latency:     105.860583ms

# æ—¥å¿—è¾“å‡º - ORS Gateway:
[ORSGateway] SendOrder: ORD_1768909036580_000000 symbol=ag2412 side=BUY price=7950 qty=10
[ReqWriter] Written: 1
[RespReader] Read: 1

# æ—¥å¿—è¾“å‡º - Counter Bridge:
[SimCounter] Order received: EX_1768909036580_000000 symbol=ag2412 side=BUY price=7950 qty=10
[SimCounter] Order accepted: EX_1768909036580_000000
[Callback] Order accepted: EX_1768909036580_000000 (total: 1)
[SimCounter] Order filled: EX_1768909036580_000000 price=7950 qty=10
[Callback] Order filled: EX_1768909036580_000000 (total: 1)

# å®¢æˆ·ç«¯æ”¶åˆ°NATSæ›´æ–°:
[ORSClient] Order Update: ORD_1768909036580_000000 ACCEPTED
[ORSClient] Order Update: ORD_1768909036580_000000 FILLED
```

## å»¶è¿Ÿåˆ†è§£

### è®¢å•å¾€è¿”å»¶è¿Ÿ (~105ms)

```
å®¢æˆ·ç«¯ â†’ ORS Gateway (gRPC):           ~0.1ms
ORS Gateway å†…éƒ¨å¤„ç†:                  ~0.006ms
ORS Gateway â†’ å…±äº«å†…å­˜:                ~0.001ms
Counter Bridge è¯»å–:                  ~0.001ms
Counter Bridge â†’ SimulatedCounter:    ~0.001ms
SimulatedCounter æ¥å—å»¶è¿Ÿ:             10ms      â† æ¨¡æ‹Ÿå»¶è¿Ÿ
SimulatedCounter æˆäº¤å»¶è¿Ÿ:             50ms      â† æ¨¡æ‹Ÿå»¶è¿Ÿ
Counter Bridge å›è°ƒ:                  ~0.001ms
å…±äº«å†…å­˜ â†’ ORS Gateway:                ~0.001ms
ORS Gateway NATSå‘å¸ƒ:                  ~0.1ms
NATS â†’ å®¢æˆ·ç«¯:                         ~0.1ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: ~60.4ms (å®é™…æµ‹è¯•: ~105msï¼ŒåŒ…æ‹¬å…¶ä»–å¼€é”€)
```

### å…³é”®è·¯å¾„å»¶è¿Ÿ (å»é™¤æ¨¡æ‹Ÿå»¶è¿Ÿ)

```
ä¸åŒ…å«SimulatedCounterçš„æ¨¡æ‹Ÿå»¶è¿Ÿ:
å®¢æˆ·ç«¯ â†’ ORS Gateway â†’ å…±äº«å†…å­˜ â†’ Counter Bridge â†’
Counter API â†’ å›è°ƒ â†’ å…±äº«å†…å­˜ â†’ ORS Gateway â†’ å®¢æˆ·ç«¯

ä¼°ç®—: ~0.5-1ms
å®é™…å¯è¾¾åˆ°: <1ms (æ»¡è¶³ä½å»¶è¿Ÿè¦æ±‚)
```

## æœªæ¥é›†æˆç‚¹

### 1. Strategy Engineé›†æˆ (Week 13-14)

```go
type StrategyEngine struct {
    indicators  *indicators.IndicatorLibrary
    orsClient   *client.ORSClient
    strategies  []Strategy
}

func (se *StrategyEngine) OnMarketData(md *mdpb.MarketDataUpdate) {
    // 1. æ›´æ–°æ‰€æœ‰æŒ‡æ ‡
    se.indicators.UpdateAll(md)

    // 2. å„ç­–ç•¥ç”Ÿæˆä¿¡å·
    for _, strategy := range se.strategies {
        signals := strategy.OnMarketData(md, se.indicators)

        // 3. å‘é€è®¢å•
        for _, signal := range signals {
            se.orsClient.SendOrder(ctx, signal.ToOrderRequest())
        }
    }
}
```

### 2. MD Gatewayé›†æˆ (æœªæ¥)

```cpp
// MD Gatewayè¯»å–è¡Œæƒ…æº
void MDGateway::OnMarketDataFromExchange(const char* raw_data) {
    // 1. è§£æåŸå§‹æ•°æ®
    MarketDataRaw md_raw;
    ParseRawData(raw_data, &md_raw);

    // 2. å†™å…¥å…±äº«å†…å­˜
    m_mdQueue->Push(md_raw);

    // 3. è½¬æ¢ä¸ºprotobuf
    MarketDataUpdate md_update;
    ConvertToProtobuf(md_raw, &md_update);

    // 4. å‘å¸ƒåˆ°NATS
    PublishToNATS("md." + md_update.symbol(), md_update);
}
```

## æ•°æ®ç»“æ„å¯¹æ¯”

### OrderRequestRaw (C++ å…±äº«å†…å­˜)
```cpp
struct OrderRequestRaw {
    char order_id[64];           // è®¢å•ID
    char symbol[32];             // åˆçº¦ä»£ç 
    uint8_t side;                // ä¹°å–æ–¹å‘
    double price;                // ä»·æ ¼
    int64_t quantity;            // æ•°é‡
    uint8_t order_type;          // è®¢å•ç±»å‹
    uint64_t timestamp;          // æ—¶é—´æˆ³
};
```

### OrderRequest (protobuf, gRPC/NATS)
```protobuf
message OrderRequest {
    string strategy_id = 1;
    string symbol = 2;
    OrderSide side = 3;
    double price = 4;
    int64 quantity = 5;
    OrderType order_type = 6;
    Exchange exchange = 7;
}
```

## æœåŠ¡å¯åŠ¨é¡ºåº

```
æ­£ç¡®çš„å¯åŠ¨é¡ºåº:

1. NATS Server
   â””â”€â†’ nats-server

2. ORS Gateway (åˆ›å»ºRequestå’ŒResponseå…±äº«å†…å­˜)
   â””â”€â†’ ./ors_gateway

3. Counter Bridge (è¿æ¥å…±äº«å†…å­˜)
   â””â”€â†’ ./counter_bridge

4. Golangå®¢æˆ·ç«¯/ç­–ç•¥å¼•æ“
   â””â”€â†’ ./bin/ors_client
```

## æ€»ç»“

### âœ… å·²å®Œæˆä¸”å¯ç”¨
1. **å®Œæ•´è®¢å•æµ**: Golang Client â†’ ORS Gateway â†’ Counter Bridge â†’ SimulatedCounter â†’ å›æŠ¥
2. **å…±äº«å†…å­˜IPC**: SPSCæ— é”é˜Ÿåˆ—ï¼Œå»¶è¿Ÿ<2Î¼s
3. **NATSæ¶ˆæ¯æ€»çº¿**: Pub/Subé€šä¿¡ï¼Œå»¶è¿Ÿ<100Î¼s
4. **æŒ‡æ ‡åº“**: 7ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼Œå¯ç‹¬ç«‹ä½¿ç”¨

### ğŸš§ éƒ¨åˆ†å®ç°
1. **MD Gateway**: æ¡†æ¶å­˜åœ¨ä½†æœªè¿æ¥è¡Œæƒ…æº
2. **è¡Œæƒ…æ•°æ®æµ**: æœªå®ç°ç«¯åˆ°ç«¯

### â³ å¾…å®ç°
1. **Strategy Engine**: æ ¸å¿ƒç­–ç•¥å¼•æ“
2. **æŒ‡æ ‡åº“é›†æˆ**: è¿æ¥è¡Œæƒ…æµå’Œç­–ç•¥
3. **Portfolio Manager**: ç»„åˆç®¡ç†
4. **Risk Manager**: é£æ§ç®¡ç†

### ğŸ¯ ä¸‹ä¸€æ­¥
Week 13-14: å®ç°æ ¸å¿ƒç­–ç•¥ï¼Œå°†æŒ‡æ ‡åº“é›†æˆåˆ°å®Œæ•´äº¤æ˜“æµç¨‹ä¸­ã€‚
