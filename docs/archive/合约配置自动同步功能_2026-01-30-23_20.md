# åˆçº¦é…ç½®è‡ªåŠ¨åŒæ­¥åŠŸèƒ½

**æ—¥æœŸ**: 2026-01-30
**æ—¶é—´**: 23:20
**çŠ¶æ€**: âœ… å·²å®ç°

---

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

### åŸæœ‰é—®é¢˜

åˆçº¦è®¢é˜…é…ç½®åˆ†æ•£åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œéœ€è¦æ‰‹åŠ¨ä¿æŒåŒæ­¥ï¼š

1. **CTP MD Gateway é…ç½®** (`config/ctp/ctp_md.yaml`)
   - å®šä¹‰ä» CTP æŸœå°è®¢é˜…å“ªäº›åˆçº¦

2. **Trader é…ç½®** (`config/trader.live.yaml`)
   - å®šä¹‰ç­–ç•¥ä½¿ç”¨å“ªäº›åˆçº¦

**é—®é¢˜è¡¨ç°**:
- ç­–ç•¥é…ç½®äº† `au2604` å’Œ `au2606` é»„é‡‘åˆçº¦
- CTP MD é…ç½®åªè®¢é˜…äº† `ag2603` å’Œ `ag2605` ç™½é“¶åˆçº¦
- å¯¼è‡´é»„é‡‘ç­–ç•¥æ— æ³•æ”¶åˆ°è¡Œæƒ…æ•°æ®ï¼ŒæŒ‡æ ‡å…¨ä¸º0

---

## âœ… è§£å†³æ–¹æ¡ˆ

### å¯åŠ¨è„šæœ¬è‡ªåŠ¨åŒæ­¥

ä¿®æ”¹ `scripts/live/start_ctp_live.sh`ï¼Œåœ¨å¯åŠ¨å‰è‡ªåŠ¨ï¼š
1. ä» `trader.live.yaml` æå–æ‰€æœ‰ç­–ç•¥ä½¿ç”¨çš„ symbols
2. æ£€æŸ¥ `ctp_md.yaml` æ˜¯å¦å·²åŒ…å«è¿™äº›åˆçº¦
3. å¦‚æœ‰ç¼ºå¤±ï¼Œè‡ªåŠ¨æ›´æ–° `ctp_md.yaml`

### å®ç°ä»£ç 

```bash
# è‡ªåŠ¨åŒæ­¥åˆçº¦é…ç½®ï¼šä» trader.live.yaml æå– symbols æ›´æ–°åˆ° ctp_md.yaml
sync_instruments() {
    local TRADER_CONFIG="config/trader.live.yaml"
    local CTP_MD_CONFIG="config/ctp/ctp_md.yaml"

    # ä» trader é…ç½®æå–æ‰€æœ‰ç­–ç•¥ä½¿ç”¨çš„ symbols
    local symbols=$(grep -A 100 "strategies:" "$TRADER_CONFIG" | \
        grep -E '^\s+- "' | \
        sed 's/.*- "\([^"]*\)".*/\1/' | \
        sort -u)

    if [ -z "$symbols" ]; then
        log_warn "æœªä» trader é…ç½®ä¸­æå–åˆ°åˆçº¦ï¼Œè·³è¿‡åŒæ­¥"
        return
    fi

    # æ£€æŸ¥ç¼ºå¤±çš„åˆçº¦
    local missing=""
    for sym in $symbols; do
        if ! grep -q "\"$sym\"" "$CTP_MD_CONFIG"; then
            missing="${missing} $sym"
        fi
    done

    if [ -n "$missing" ]; then
        log_info "å‘ç°ç¼ºå¤±çš„åˆçº¦è®¢é˜…:$missing"
        # å¤‡ä»½å¹¶æ›´æ–°é…ç½®...
    fi
}
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### è‡ªåŠ¨åŒæ­¥ï¼ˆæ¨èï¼‰

åªéœ€ç»´æŠ¤ `trader.live.yaml` ä¸­çš„ç­–ç•¥é…ç½®ï¼Œå¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨åŒæ­¥åˆ° CTP MDï¼š

```bash
./scripts/live/start_ctp_live.sh
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[INFO] [1/10] æ£€æŸ¥é…ç½®æ–‡ä»¶...
[INFO] âœ“ é…ç½®æ–‡ä»¶æ£€æŸ¥é€šè¿‡
[INFO] [2/10] åŒæ­¥åˆçº¦é…ç½®...
[INFO] å‘ç°ç¼ºå¤±çš„åˆçº¦è®¢é˜…: au2604 au2606
[INFO] âœ“ å·²æ›´æ–° CTP MD é…ç½®ï¼Œæ·»åŠ åˆçº¦: au2604 au2606
[INFO] [3/10] åˆ›å»ºæ—¥å¿—ç›®å½•...
...
```

### æ‰‹åŠ¨åŒæ­¥

å¦‚æœéœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼Œç¡®ä¿ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„åˆçº¦åˆ—è¡¨ä¸€è‡´ï¼š

**trader.live.yaml**:
```yaml
strategies:
  - id: "live_ag_spread"
    symbols:
      - "ag2603"
      - "ag2605"
  - id: "live_au_spread"
    symbols:
      - "au2604"
      - "au2606"
```

**ctp_md.yaml**:
```yaml
ctp:
  instruments:
    - "ag2603"
    - "ag2605"
    - "au2604"  # å¿…é¡»æ‰‹åŠ¨æ·»åŠ 
    - "au2606"  # å¿…é¡»æ‰‹åŠ¨æ·»åŠ 
```

---

## ğŸ“Š å¯åŠ¨æµç¨‹æ›´æ–°

å¯åŠ¨æ­¥éª¤ä» 9 æ­¥å¢åŠ åˆ° 10 æ­¥ï¼š

| æ­¥éª¤ | è¯´æ˜ |
|-----|------|
| 1/10 | æ£€æŸ¥é…ç½®æ–‡ä»¶ |
| **2/10** | **åŒæ­¥åˆçº¦é…ç½®ï¼ˆæ–°å¢ï¼‰** |
| 3/10 | åˆ›å»ºæ—¥å¿—ç›®å½• |
| 4/10 | å¯åŠ¨ NATS server |
| 5/10 | å¯åŠ¨ CTP è¡Œæƒ…ç½‘å…³ |
| 6/10 | å¯åŠ¨ MD Gateway |
| 7/10 | å¯åŠ¨ ORS Gateway |
| 8/10 | å¯åŠ¨ Counter Bridge |
| 9/10 | å¯åŠ¨ Trader |
| 10/10 | éªŒè¯ç³»ç»ŸçŠ¶æ€ |

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### é…ç½®æå–é€»è¾‘

ä» trader.live.yaml æå– symbols çš„ awk è„šæœ¬ï¼š
```bash
awk '
    /^    symbols:/ { in_symbols = 1; next }
    /^    exchanges:/ { in_symbols = 0; next }
    /^    [a-z_]+:/ { in_symbols = 0; next }
    /^  - / { in_symbols = 0; next }
    in_symbols && /^      - "/ {
        gsub(/.*- "/, "")
        gsub(/".*/, "")
        print
    }
' config/trader.live.yaml | sort -u
```

è¿™ä¼šåªæå– `symbols:` éƒ¨åˆ†ä¸‹çš„åˆçº¦ä»£ç ï¼Œæ’é™¤ `exchanges:` ç­‰å…¶ä»–åˆ—è¡¨ã€‚

### é…ç½®æ›´æ–°é€»è¾‘

ä½¿ç”¨ `awk` æ›¿æ¢ `instruments:` éƒ¨åˆ†ï¼š
```bash
awk -v new_inst="$new_instruments" '
/^  instruments:/ {
    print "  # è®¢é˜…åˆçº¦åˆ—è¡¨ï¼ˆè‡ªåŠ¨ä» trader.live.yaml åŒæ­¥ï¼‰"
    print "  instruments:"
    printf "%s", new_inst
    in_instruments = 1
    next
}
in_instruments && /^    - "/ { next }
in_instruments && /^[^ ]/ { in_instruments = 0 }
!in_instruments { print }
' "$CTP_MD_CONFIG"
```

### å¤‡ä»½æœºåˆ¶

æ›´æ–°å‰ä¼šè‡ªåŠ¨å¤‡ä»½åŸé…ç½®ï¼š
```bash
cp "$CTP_MD_CONFIG" "${CTP_MD_CONFIG}.bak"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åªåœ¨å¯åŠ¨æ—¶åŒæ­¥**ï¼šè„šæœ¬åªåœ¨å¯åŠ¨æ—¶æ£€æŸ¥å’ŒåŒæ­¥é…ç½®ï¼Œè¿è¡Œä¸­ä¿®æ”¹ trader é…ç½®ä¸ä¼šè‡ªåŠ¨æ›´æ–° CTP MD

2. **å•å‘åŒæ­¥**ï¼šåªä» trader.live.yaml â†’ ctp_md.yamlï¼Œä¸ä¼šåå‘åŒæ­¥

3. **å¤‡ä»½ä¿ç•™**ï¼šæ¯æ¬¡æ›´æ–°éƒ½ä¼šè¦†ç›– .bak æ–‡ä»¶ï¼Œåªä¿ç•™æœ€è¿‘ä¸€æ¬¡å¤‡ä»½

4. **æ ¼å¼è¦æ±‚**ï¼štrader.live.yaml ä¸­çš„ symbols å¿…é¡»ä½¿ç”¨ `- "xxx"` æ ¼å¼

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- **å¯åŠ¨è„šæœ¬**: `scripts/live/start_ctp_live.sh`
- **Traderé…ç½®**: `config/trader.live.yaml`
- **CTP MDé…ç½®**: `config/ctp/ctp_md.yaml`
- **å¯åŠ¨æŠ¥å‘Š**: `docs/å®ç›˜/CTPå®ç›˜äº¤æ˜“ç³»ç»Ÿå¯åŠ¨å®Œæ•´æŠ¥å‘Š_2026-01-30-21_52.md`

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-30 23:20:00
**ä½œè€…**: QuantLink Team
**ç‰ˆæœ¬**: v1.0
