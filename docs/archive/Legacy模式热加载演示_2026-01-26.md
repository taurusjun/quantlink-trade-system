# Legacyæ¨¡å¼çƒ­åŠ è½½åŠŸèƒ½æ¼”ç¤º

**æµ‹è¯•æ—¥æœŸ**: 2026-01-26
**åŠŸèƒ½**: å…¼å®¹æ¨¡å¼ï¼ˆLegacy Modeï¼‰æ”¯æŒModelçƒ­åŠ è½½
**ç»“è®º**: âœ… å®Œå…¨æ”¯æŒ

---

## ä¸€ã€åŠŸèƒ½è¯´æ˜

Legacyæ¨¡å¼**å®Œå…¨æ”¯æŒ**Modelæ–‡ä»¶çƒ­åŠ è½½åŠŸèƒ½ï¼

å½“æ‚¨ä½¿ç”¨æ—§ç³»ç»Ÿçš„å¯åŠ¨æ–¹å¼æ—¶ï¼š
```bash
./bin/trader --Live --controlFile control.txt --strategyID 92201
```

ç³»ç»Ÿä¼šï¼š
1. âœ… è‡ªåŠ¨æ£€æµ‹å¹¶å¯ç”¨legacyå…¼å®¹æ¨¡å¼
2. âœ… è§£æcontrolæ–‡ä»¶è·å–modelæ–‡ä»¶è·¯å¾„
3. âœ… **è‡ªåŠ¨å¯ç”¨Modelçƒ­åŠ è½½åŠŸèƒ½**ï¼ˆ`HotReload.Enabled: true`ï¼‰
4. âœ… å¯åŠ¨HTTP APIæœåŠ¡å™¨ï¼ˆç«¯å£ï¼š9200 + strategyIDåä¸¤ä½ï¼‰
5. âœ… åˆå§‹åŒ–ModelWatcherï¼ˆæ‰‹åŠ¨é‡è½½æ¨¡å¼ï¼‰

---

## äºŒã€å®Œæ•´æ¼”ç¤º

### æ­¥éª¤1: å¯åŠ¨Legacyæ¨¡å¼

**å¯åŠ¨å‘½ä»¤**:
```bash
./bin/trader --Live --controlFile control.test.txt --strategyID 92201
```

**å¯åŠ¨æ—¥å¿—**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  QuantlinkTrader v1.0.0                                   â•‘
â•‘  Production Trading System                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Main] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[Main] Running in LEGACY COMPATIBILITY MODE
[Main] Converting old system config to new format...
[Main] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[Main] âœ“ Control file parsed: ag2502/ag2504, model=./models/model.test.par.txt
[Main] âœ“ Legacy configuration converted successfully
[Main]   Model File: ./models/model.test.par.txt  <-- çƒ­åŠ è½½å·²å¯ç”¨
```

**APIç«¯å£**: `http://localhost:9201` (9200 + 01)

### æ­¥éª¤2: æŸ¥çœ‹å½“å‰å‚æ•°

**è¯·æ±‚**:
```bash
curl http://localhost:9201/api/v1/model/status
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "model_file": "./models/model.test.par.txt",
    "enabled": true,
    "mode": "manual",
    "current_parameters": {
      "entry_zscore": 2.0,      <-- å½“å‰å‚æ•°
      "exit_zscore": 0.5,       <-- å½“å‰å‚æ•°
      "order_size": 10,         <-- å½“å‰å‚æ•°
      "max_position_size": 50,
      "lookback_period": 100
    }
  }
}
```

### æ­¥éª¤3: ä¿®æ”¹Modelæ–‡ä»¶

**åŸå§‹å†…å®¹** (`./models/model.test.par.txt`):
```
BEGIN_PLACE 2.0
BEGIN_REMOVE 0.5
SIZE 10
MAX_SIZE 50
STOP_LOSS 50000
MAX_LOSS 100000
```

**ä¿®æ”¹ä¸º**:
```
BEGIN_PLACE 1.5        <-- ä»2.0æ”¹ä¸º1.5
BEGIN_REMOVE 0.3       <-- ä»0.5æ”¹ä¸º0.3
SIZE 15                <-- ä»10æ”¹ä¸º15
MAX_SIZE 50
STOP_LOSS 50000
MAX_LOSS 100000
```

### æ­¥éª¤4: è§¦å‘çƒ­åŠ è½½

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:9201/api/v1/model/reload
```

**å“åº”**:
```json
{
  "success": true,
  "message": "Model reloaded successfully",
  "data": {
    "timestamp": "2026-01-26T13:47:34+08:00"
  }
}
```

### æ­¥éª¤5: éªŒè¯å‚æ•°æ›´æ–°

**è¯·æ±‚**:
```bash
curl http://localhost:9201/api/v1/model/status
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "current_parameters": {
      "entry_zscore": 1.5,      <-- âœ… å·²æ›´æ–°
      "exit_zscore": 0.3,       <-- âœ… å·²æ›´æ–°
      "order_size": 15,         <-- âœ… å·²æ›´æ–°
      "max_position_size": 50,
      "lookback_period": 100
    },
    "last_mod_time": "2026-01-26 13:47:30"  <-- æ›´æ–°æ—¶é—´
  }
}
```

### æ­¥éª¤6: æŸ¥çœ‹çƒ­åŠ è½½å†å²

**è¯·æ±‚**:
```bash
curl http://localhost:9201/api/v1/model/history
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "count": 1,
    "history": [
      {
        "timestamp": "2026-01-26T13:47:34.344329+08:00",
        "file_path": "./models/model.test.par.txt",
        "new_params": {
          "entry_zscore": 1.5,
          "exit_zscore": 0.3,
          "order_size": 15,
          "max_position_size": 50,
          "stop_loss": 50000,
          "max_loss": 100000
        },
        "success": true
      }
    ]
  }
}
```

---

## ä¸‰ã€å®æµ‹ç»“æœ

| é¡¹ç›® | æµ‹è¯•ç»“æœ | è¯´æ˜ |
|------|---------|------|
| Legacyæ¨¡å¼å¯åŠ¨ | âœ… æˆåŠŸ | è‡ªåŠ¨æ£€æµ‹å…¼å®¹æ¨¡å¼ |
| Modelæ–‡ä»¶è·¯å¾„è¯†åˆ« | âœ… æˆåŠŸ | ä»controlæ–‡ä»¶ä¸­è¯»å– |
| çƒ­åŠ è½½åŠŸèƒ½å¯ç”¨ | âœ… è‡ªåŠ¨å¯ç”¨ | `HotReload.Enabled: true` |
| APIæœåŠ¡å™¨å¯åŠ¨ | âœ… ç«¯å£9201 | 9200 + strategyIDåä¸¤ä½ |
| å‚æ•°æŸ¥è¯¢ | âœ… æ­£å¸¸ | GET /api/v1/model/status |
| çƒ­åŠ è½½è§¦å‘ | âœ… æ­£å¸¸ | POST /api/v1/model/reload |
| å‚æ•°å®æ—¶æ›´æ–° | âœ… æˆåŠŸ | entry_zscore: 2.0 â†’ 1.5 |
| å†å²è®°å½• | âœ… æ­£å¸¸ | GET /api/v1/model/history |

---

## å››ã€APIç«¯å£è®¡ç®—è§„åˆ™

Legacyæ¨¡å¼çš„APIç«¯å£å·æ ¹æ®strategyIDè‡ªåŠ¨è®¡ç®—ï¼š

**å…¬å¼**: `ç«¯å£ = 9200 + strategyIDçš„åä¸¤ä½æ•°å­—`

**ç¤ºä¾‹**:
- strategyID = **92201** â†’ ç«¯å£ = 9200 + **01** = **9201**
- strategyID = **92202** â†’ ç«¯å£ = 9200 + **02** = **9202**
- strategyID = **92210** â†’ ç«¯å£ = 9200 + **10** = **9210**
- strategyID = **92299** â†’ ç«¯å£ = 9200 + **99** = **9299**

**è®¿é—®ç¤ºä¾‹**:
```bash
# strategyID = 92201
curl http://localhost:9201/api/v1/model/status

# strategyID = 92202
curl http://localhost:9202/api/v1/model/status
```

---

## äº”ã€è‡ªåŠ¨å¯ç”¨çš„åŸå› 

åœ¨`legacy_converter.go`ä¸­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯ç”¨çƒ­åŠ è½½ï¼š

```go
cfg := &TraderConfig{
    Strategy: StrategyConfig{
        ModelFile: controlFile.ModelFilePath,  // ä»controlæ–‡ä»¶è·å–
        HotReload: HotReloadConfig{
            Enabled: true,  // è‡ªåŠ¨å¯ç”¨çƒ­åŠ è½½
        },
    },
}
```

**è®¾è®¡ç†ç”±**:
1. **ç”Ÿäº§éœ€æ±‚**: Legacyæ¨¡å¼é€šå¸¸ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå‚æ•°è°ƒä¼˜æ˜¯å¸¸è§æ“ä½œ
2. **å®‰å…¨æ€§**: æ‰‹åŠ¨è§¦å‘æ–¹å¼æœ¬èº«å·²ç»å¾ˆå®‰å…¨
3. **å…¼å®¹æ€§**: æ—§ç³»ç»Ÿæœ‰å‚æ•°è°ƒæ•´éœ€æ±‚ï¼Œæ–°ç³»ç»Ÿåº”ä¿æŒèƒ½åŠ›
4. **ä¾¿åˆ©æ€§**: ä¸éœ€è¦é‡å¯è¿›ç¨‹å³å¯è°ƒæ•´ç­–ç•¥å‚æ•°

---

## å…­ã€ä¸æ–°ç³»ç»ŸYAMLæ¨¡å¼çš„å¯¹æ¯”

| ç‰¹æ€§ | Legacyæ¨¡å¼ | YAMLæ¨¡å¼ | è¯´æ˜ |
|------|-----------|---------|------|
| å¯åŠ¨æ–¹å¼ | `--controlFile` | `--config` | ä¸¤ç§æ¨¡å¼äº’æ–¥ |
| Modelæ–‡ä»¶è·¯å¾„ | controlæ–‡ä»¶æŒ‡å®š | YAMLé…ç½®æŒ‡å®š | éƒ½æ”¯æŒ |
| çƒ­åŠ è½½å¯ç”¨ | **è‡ªåŠ¨å¯ç”¨** | éœ€é…ç½® | Legacyé»˜è®¤å¼€å¯ |
| APIç«¯å£ | è‡ªåŠ¨è®¡ç®— | YAMLé…ç½® | Legacy: 9200+ID |
| å‚æ•°æ ¼å¼ | KEY VALUE | YAML | æ ¼å¼ä¸åŒ |
| çƒ­åŠ è½½API | âœ… ç›¸åŒ | âœ… ç›¸åŒ | å®Œå…¨ä¸€è‡´ |

---

## ä¸ƒã€ä½¿ç”¨å»ºè®®

### 7.1 ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

```bash
# 1. å¯åŠ¨legacyæ¨¡å¼ï¼ˆè‡ªåŠ¨å¯ç”¨çƒ­åŠ è½½ï¼‰
nohup ./bin/trader --Live --controlFile control.prod.txt \
  --strategyID 92201 \
  --logFile ./log/trader.92201.log &

# 2. è¿è¡Œä¸­è°ƒæ•´å‚æ•°
vim ./models/model.prod.par.txt  # ä¿®æ”¹å‚æ•°

# 3. çƒ­åŠ è½½ç”Ÿæ•ˆ
curl -X POST http://localhost:9201/api/v1/model/reload

# 4. éªŒè¯æ›´æ–°
curl http://localhost:9201/api/v1/model/status
```

### 7.2 ç›‘æ§çƒ­åŠ è½½

```bash
# å®šæœŸæ£€æŸ¥çƒ­åŠ è½½å†å²
curl -s http://localhost:9201/api/v1/model/history | \
  python3 -m json.tool | \
  tee reload_history.json

# æ£€æŸ¥æœ€è¿‘ä¸€æ¬¡çƒ­åŠ è½½æ—¶é—´
curl -s http://localhost:9201/api/v1/model/status | \
  grep "last_mod_time"
```

### 7.3 å‚æ•°å¤‡ä»½

```bash
# çƒ­åŠ è½½å‰å¤‡ä»½å½“å‰modelæ–‡ä»¶
cp ./models/model.prod.par.txt \
   ./models/model.prod.par.txt.backup.$(date +%Y%m%d_%H%M%S)

# ä¿®æ”¹å‚æ•°
vim ./models/model.prod.par.txt

# è§¦å‘çƒ­åŠ è½½
curl -X POST http://localhost:9201/api/v1/model/reload

# å¦‚æœæœ‰é—®é¢˜ï¼Œæ¢å¤å¤‡ä»½
cp ./models/model.prod.par.txt.backup.20260126_134700 \
   ./models/model.prod.par.txt
curl -X POST http://localhost:9201/api/v1/model/reload
```

---

## å…«ã€æ³¨æ„äº‹é¡¹

1. **ç«¯å£å†²çª**:
   - ç¡®ä¿strategyIDåä¸¤ä½ä¸é‡å¤ï¼ˆåŒä¸€å°æœºå™¨ä¸Šï¼‰
   - ä¾‹å¦‚ï¼š92201ã€92202ã€92203å¯ä»¥å¹¶è¡Œè¿è¡Œ

2. **å‚æ•°éªŒè¯**:
   - çƒ­åŠ è½½å‰ä¼šéªŒè¯å‚æ•°æœ‰æ•ˆæ€§
   - éªŒè¯å¤±è´¥ä¼šè‡ªåŠ¨å›æ»šï¼Œä¸å½±å“å½“å‰è¿è¡Œ

3. **æ— éœ€é‡å¯**:
   - å‚æ•°ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ
   - ä¸ä¼šä¸­æ–­äº¤æ˜“è¿æ¥

4. **å†å²è®°å½•**:
   - ç³»ç»Ÿä¿ç•™æœ€è¿‘10æ¬¡çƒ­åŠ è½½è®°å½•
   - å¯ç”¨äºå®¡è®¡å’Œé—®é¢˜æ’æŸ¥

---

## ä¹ã€æ€»ç»“

âœ… **Legacyæ¨¡å¼å®Œå…¨æ”¯æŒModelçƒ­åŠ è½½åŠŸèƒ½**

**æ ¸å¿ƒä¼˜åŠ¿**:
- ğŸ”„ æ— éœ€é‡å¯è¿›ç¨‹
- ğŸ›¡ï¸ å‚æ•°è‡ªåŠ¨éªŒè¯å’Œå›æ»š
- ğŸ“ å®Œæ•´çš„æ“ä½œå†å²è®°å½•
- ğŸ”Œ é€šè¿‡HTTP APIæ“ä½œï¼Œç®€å•æ˜“ç”¨
- âš¡ å®æ—¶ç”Ÿæ•ˆï¼Œä¸å½±å“äº¤æ˜“è¿æ¥
- ğŸ¯ è‡ªåŠ¨å¯ç”¨ï¼Œå¼€ç®±å³ç”¨

**é€‚ç”¨åœºæ™¯**:
- ç”Ÿäº§ç¯å¢ƒå‚æ•°è°ƒä¼˜
- å®æ—¶ç­–ç•¥å‚æ•°è°ƒæ•´
- å¸‚åœºæ¡ä»¶å˜åŒ–æ—¶çš„å¿«é€Ÿå“åº”
- ä¿æŒæ—§ç³»ç»Ÿä½¿ç”¨ä¹ æƒ¯çš„åŒæ—¶è·å¾—æ–°åŠŸèƒ½

---

**æµ‹è¯•äººå‘˜**: Claude Code
**æµ‹è¯•æ—¶é—´**: 2026-01-26 13:47
**æµ‹è¯•ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡

*Legacyæ¨¡å¼ç”¨æˆ·å¯ä»¥æ”¾å¿ƒä½¿ç”¨çƒ­åŠ è½½åŠŸèƒ½ï¼Œäº«å—ä¸æ–°ç³»ç»Ÿç›¸åŒçš„å‚æ•°ç®¡ç†ä½“éªŒã€‚*
