# golang_UIä¸¤æ¡è…¿å±•ç¤ºåŠŸèƒ½_2026-01-23-17_30

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-01-23 17:30
**åŠŸèƒ½ç±»å‹**: UI å¢å¼º - é…å¯¹ç­–ç•¥ä¸¤æ¡è…¿å±•ç¤º
**å½±å“èŒƒå›´**: PairwiseArbStrategy + Web UI

---

## 1. åŠŸèƒ½èƒŒæ™¯

### 1.1 ç”¨æˆ·éœ€æ±‚

ç”¨æˆ·ï¼ˆäº¤æ˜“å‘˜ï¼‰å¸Œæœ›åœ¨ Web UI ä¸Šæ¸…æ™°åœ°çœ‹åˆ° PairwiseArbStrategy ä¸¤æ¡è…¿çš„è¯¦ç»†ä¿¡æ¯ï¼š
- æ¯æ¡è…¿çš„å“ç§ç¬¦å·
- æ¯æ¡è…¿çš„å½“å‰ä»·æ ¼
- æ¯æ¡è…¿çš„æŒä»“æ•°é‡
- æ¯æ¡è…¿çš„æ–¹å‘ï¼ˆlong/short/flatï¼‰

**ç›®æ ‡**: æ–¹ä¾¿äº¤æ˜“å‘˜å®æ—¶ç›‘æ§é…å¯¹äº¤æ˜“çš„ä¸¤æ¡è…¿çŠ¶æ€ã€‚

### 1.2 åŸæœ‰é—®é¢˜

åœ¨åŸæœ‰è®¾è®¡ä¸­ï¼š
- legs ä¿¡æ¯æ··åœ¨ indicators ä¸­ï¼ˆprice1, price2, leg1_position, leg2_positionï¼‰
- æ²¡æœ‰ç‹¬ç«‹çš„è§†è§‰åŒºåŸŸå±•ç¤º
- ç¼ºå°‘æ–¹å‘æ ‡è¯†ï¼ˆlong/short/flatï¼‰
- ç¼ºå°‘å“ç§ç¬¦å·æ˜ å°„

---

## 2. å®ç°æ–¹æ¡ˆ

### 2.1 æ¶æ„è®¾è®¡

```
PairwiseArbStrategy (Golang)
    â†“
GetLegsInfo() â†’ []LegInfo
    â†“
API: StrategyStatusResponse.Legs
    â†“
Web UI: Legs Card
    â†“
ç”¨æˆ·çœ‹åˆ°æ¸…æ™°çš„ä¸¤æ¡è…¿å±•ç¤º
```

### 2.2 æ•°æ®æµ

```
OnMarketData()
    â†“
æ›´æ–° price1, price2, leg1Position, leg2Position
    â†“
UpdateConditions() æ·»åŠ åˆ° indicators
    â†“
GetLegsInfo() ç”Ÿæˆè…¿ä¿¡æ¯
    â†“
API handleStatus() è°ƒç”¨ GetLegsInfo()
    â†“
è¿”å› JSON: { legs: [{symbol, price, position, side}, ...] }
    â†“
UI updateLegsDisplay() æ¸²æŸ“
```

---

## 3. ä»£ç ä¿®æ”¹è¯¦æƒ…

### 3.1 ç­–ç•¥å±‚ï¼šPairwiseArbStrategy

**æ–‡ä»¶**: `pkg/strategy/pairwise_arb_strategy.go`

#### ä¿®æ”¹ 1: å¢å¼º indicatorsï¼ˆç”¨äºå†…éƒ¨å’Œ APIï¼‰

**ä½ç½®**: Lines 176-193

```go
// Update condition state for UI display
indicators := map[string]float64{
    "z_score":         spreadStats.ZScore,
    "entry_threshold": pas.entryZScore,
    "exit_threshold":  pas.exitZScore,
    "spread":          spreadStats.CurrentSpread,
    "spread_mean":     spreadStats.Mean,
    "spread_std":      spreadStats.Std,
    "correlation":     spreadStats.Correlation,
    "min_correlation": pas.minCorrelation,
    "hedge_ratio":     spreadStats.HedgeRatio,
    // Leg 1 details
    "leg1_price":    pas.price1,
    "leg1_position": float64(pas.leg1Position),
    // Leg 2 details
    "leg2_price":    pas.price2,
    "leg2_position": float64(pas.leg2Position),
}
```

**ä½œç”¨**: å°†è…¿ä¿¡æ¯æ·»åŠ åˆ° indicators ä¸­ï¼Œä¾› ControlState ä½¿ç”¨ã€‚

#### ä¿®æ”¹ 2: æ–°å¢ GetLegsInfo() æ–¹æ³•

**ä½ç½®**: Lines 475-509

```go
// GetLegsInfo returns detailed information for each leg (for UI display)
func (pas *PairwiseArbStrategy) GetLegsInfo() []map[string]interface{} {
    pas.mu.RLock()
    defer pas.mu.RUnlock()

    // Determine side for each leg
    leg1Side := "flat"
    if pas.leg1Position > 0 {
        leg1Side = "long"
    } else if pas.leg1Position < 0 {
        leg1Side = "short"
    }

    leg2Side := "flat"
    if pas.leg2Position > 0 {
        leg2Side = "long"
    } else if pas.leg2Position < 0 {
        leg2Side = "short"
    }

    return []map[string]interface{}{
        {
            "symbol":   pas.symbol1,
            "price":    pas.price1,
            "position": pas.leg1Position,
            "side":     leg1Side,
        },
        {
            "symbol":   pas.symbol2,
            "price":    pas.price2,
            "position": pas.leg2Position,
            "side":     leg2Side,
        },
    }
}
```

**ç‰¹æ€§**:
- è¿”å›ä¸¤æ¡è…¿çš„å®Œæ•´ä¿¡æ¯
- è‡ªåŠ¨è®¡ç®— sideï¼ˆlong/short/flatï¼‰
- çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ RLockï¼‰

---

### 3.2 API å±‚ï¼šStrategyStatusResponse

**æ–‡ä»¶**: `pkg/trader/api.go`

#### ä¿®æ”¹ 1: æ·»åŠ  LegInfo ç±»å‹

**ä½ç½®**: Lines 58-64

```go
// LegInfo contains information for one leg of a pair trading strategy
type LegInfo struct {
    Symbol   string  `json:"symbol"`    // Symbol name (e.g., "ag2502")
    Price    float64 `json:"price"`     // Current price
    Position int64   `json:"position"`  // Current position
    Side     string  `json:"side"`      // "long" or "short" or "flat"
}
```

#### ä¿®æ”¹ 2: StrategyStatusResponse æ·»åŠ  Legs å­—æ®µ

**ä½ç½®**: Lines 55

```go
type StrategyStatusResponse struct {
    // ... ç°æœ‰å­—æ®µ ...

    // Legs information for pair trading strategies (optional)
    Legs []LegInfo `json:"legs,omitempty"` // Detailed info for each leg
}
```

**ç‰¹æ€§**:
- ä½¿ç”¨ `omitempty` - éé…å¯¹ç­–ç•¥ä¸ä¼šè¿”å›æ­¤å­—æ®µ
- å¯æ‰©å±•åˆ°å…¶ä»–å¤šè…¿ç­–ç•¥

#### ä¿®æ”¹ 3: handleStatus è·å– legs ä¿¡æ¯

**ä½ç½®**: Lines 288-311

```go
// Get legs info for pair trading strategies
if legsProvider, ok := a.trader.Strategy.(interface {
    GetLegsInfo() []map[string]interface{}
}); ok {
    legsData := legsProvider.GetLegsInfo()
    legs := make([]LegInfo, 0, len(legsData))
    for _, legData := range legsData {
        leg := LegInfo{}
        if sym, ok := legData["symbol"].(string); ok {
            leg.Symbol = sym
        }
        if price, ok := legData["price"].(float64); ok {
            leg.Price = price
        }
        if pos, ok := legData["position"].(int64); ok {
            leg.Position = pos
        }
        if side, ok := legData["side"].(string); ok {
            leg.Side = side
        }
        legs = append(legs, leg)
    }
    status.Legs = legs
}
```

**ç‰¹æ€§**:
- ä½¿ç”¨ç±»å‹æ–­è¨€ï¼ˆduck typingï¼‰- åªæœ‰å®ç°äº† GetLegsInfo() çš„ç­–ç•¥æ‰ä¼šæä¾› legs
- ç±»å‹å®‰å…¨çš„è½¬æ¢

---

### 3.3 UI å±‚ï¼šWeb Control Panel

**æ–‡ä»¶**: `web/control.html`

#### ä¿®æ”¹ 1: CSS æ ·å¼ - Legs Card

**ä½ç½®**: Lines 297-398

æ–°å¢ CSS ç±»ï¼š
- `.legs-card` - å¡ç‰‡å®¹å™¨
- `.legs-grid` - 2åˆ—ç½‘æ ¼å¸ƒå±€
- `.leg-item` - å•æ¡è…¿çš„å¡ç‰‡
- `.leg-item.long` - å¤šå¤´æ ·å¼ï¼ˆç»¿è‰²è¾¹æ¡†+æ¸å˜èƒŒæ™¯ï¼‰
- `.leg-item.short` - ç©ºå¤´æ ·å¼ï¼ˆçº¢è‰²è¾¹æ¡†+æ¸å˜èƒŒæ™¯ï¼‰
- `.leg-item.flat` - å¹³ä»“æ ·å¼ï¼ˆç°è‰²è¾¹æ¡†ï¼‰
- `.leg-side-badge` - æ–¹å‘æ ‡ç­¾ï¼ˆLONG/SHORT/FLATï¼‰
- `.leg-detail` - è¯¦ç»†ä¿¡æ¯ï¼ˆä»·æ ¼ã€æŒä»“ï¼‰

**è§†è§‰æ•ˆæœ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ ä¸¤æ¡è…¿çŠ¶æ€                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ag2502 LONG â”‚ â”‚ â”‚ ag2504   SHORT  â”‚  â”‚
â”‚ â”‚             â”‚ â”‚ â”‚                 â”‚  â”‚
â”‚ â”‚ ä»·æ ¼: 5050  â”‚ â”‚ â”‚ ä»·æ ¼: 5100      â”‚  â”‚
â”‚ â”‚ æŒä»“: +10   â”‚ â”‚ â”‚ æŒä»“: -10       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¿®æ”¹ 2: HTML - Legs Card å®¹å™¨

**ä½ç½®**: Lines 541-547

```html
<!-- æ–°å¢ï¼šä¸¤æ¡è…¿å¡ç‰‡ -->
<div class="legs-card" id="legsCard" style="display: none;">
    <h3>ğŸ¯ ä¸¤æ¡è…¿çŠ¶æ€</h3>
    <div class="legs-grid" id="legsGrid">
        <!-- è…¿ä¿¡æ¯å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>
```

**ä½ç½®**: åœ¨äº¤æ˜“æ¡ä»¶å¡ç‰‡ä¹‹å‰ï¼Œæ›´çªå‡ºæ˜¾ç¤ºã€‚

#### ä¿®æ”¹ 3: JavaScript - updateLegsDisplay()

**ä½ç½®**: Lines 692-729

```javascript
// æ›´æ–°ä¸¤æ¡è…¿æ˜¾ç¤º
function updateLegsDisplay(status) {
    const legsCard = document.getElementById('legsCard');
    const legsGrid = document.getElementById('legsGrid');

    // å¦‚æœæœ‰legsæ•°æ®ï¼Œæ˜¾ç¤ºlegså¡ç‰‡
    if (status.legs && status.legs.length > 0) {
        legsCard.style.display = 'block';
        legsGrid.innerHTML = '';

        status.legs.forEach(leg => {
            const legItem = document.createElement('div');
            legItem.className = `leg-item ${leg.side}`;

            legItem.innerHTML = `
                <div class="leg-header">
                    <div class="leg-symbol">${leg.symbol}</div>
                    <div class="leg-side-badge ${leg.side}">${leg.side}</div>
                </div>
                <div class="leg-details">
                    <div class="leg-detail">
                        <div class="leg-detail-label">ä»·æ ¼</div>
                        <div class="leg-detail-value">${leg.price.toFixed(2)}</div>
                    </div>
                    <div class="leg-detail">
                        <div class="leg-detail-label">æŒä»“</div>
                        <div class="leg-detail-value">${leg.position}</div>
                    </div>
                </div>
            `;

            legsGrid.appendChild(legItem);
        });
    } else {
        // æ²¡æœ‰legsæ•°æ®ï¼Œéšè—å¡ç‰‡
        legsCard.style.display = 'none';
    }
}
```

**ç‰¹æ€§**:
- åŠ¨æ€ç”Ÿæˆè…¿å¡ç‰‡
- æ ¹æ® side è‡ªåŠ¨åº”ç”¨æ ·å¼ï¼ˆlong=ç»¿è‰²ï¼Œshort=çº¢è‰²ï¼‰
- ä»·æ ¼ä¿ç•™2ä½å°æ•°

#### ä¿®æ”¹ 4: è¿‡æ»¤ indicators ä¸­çš„ legs æ•°æ®

**ä½ç½®**: Lines 780-787

```javascript
// è¿‡æ»¤æ‰legsç›¸å…³çš„æŒ‡æ ‡ï¼ˆå®ƒä»¬ä¼šåœ¨legså¡ç‰‡ä¸­å•ç‹¬æ˜¾ç¤ºï¼‰
const legsKeys = ['leg1_price', 'leg2_price', 'leg1_position', 'leg2_position'];

// ç”ŸæˆæŒ‡æ ‡å¡ç‰‡
Object.keys(status.indicators).sort().forEach(key => {
    // è·³è¿‡legsç›¸å…³çš„æŒ‡æ ‡ï¼ˆå®ƒä»¬ä¼šåœ¨legså¡ç‰‡ä¸­æ˜¾ç¤ºï¼‰
    if (legsKeys.includes(key)) {
        return;
    }
    // ...
});
```

**ä½œç”¨**: é¿å… legs ä¿¡æ¯é‡å¤æ˜¾ç¤ºï¼ˆåŒæ—¶åœ¨ legs å¡ç‰‡å’Œ indicators ä¸­ï¼‰ã€‚

#### ä¿®æ”¹ 5: loadStatus è°ƒç”¨ updateLegsDisplay

**ä½ç½®**: Lines 875-879

```javascript
// æ›´æ–°ä¸¤æ¡è…¿çŠ¶æ€ï¼ˆæ–°å¢ï¼‰
updateLegsDisplay(status);

// æ›´æ–°äº¤æ˜“æ¡ä»¶çŠ¶æ€ï¼ˆæ–°å¢ï¼‰
updateConditionsDisplay(status);
```

---

## 4. API å“åº”ç¤ºä¾‹

### 4.1 å®Œæ•´ JSON å“åº”

```json
{
  "success": true,
  "message": "Strategy status retrieved",
  "data": {
    "strategy_id": "pairwise_arb_001",
    "running": true,
    "active": true,
    "mode": "simulation",
    "symbols": ["ag2502", "ag2504"],
    "position": { "net_qty": 0 },
    "pnl": { "realized_pnl": 0, "unrealized_pnl": 0 },
    "conditions_met": true,
    "eligible": false,
    "signal_strength": 2.35,
    "indicators": {
      "z_score": 2.35,
      "entry_threshold": 2.0,
      "spread": 50.5,
      "correlation": 0.92,
      "hedge_ratio": 1.01,
      "leg1_price": 5050.0,
      "leg2_price": 5100.0,
      "leg1_position": 10,
      "leg2_position": -10
    },
    "legs": [
      {
        "symbol": "ag2502",
        "price": 5050.0,
        "position": 10,
        "side": "long"
      },
      {
        "symbol": "ag2504",
        "price": 5100.0,
        "position": -10,
        "side": "short"
      }
    ]
  }
}
```

### 4.2 å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `legs` | Array | è…¿ä¿¡æ¯æ•°ç»„ï¼ˆå¯é€‰ï¼Œä»…é…å¯¹ç­–ç•¥ï¼‰ |
| `legs[].symbol` | String | å“ç§ä»£ç ï¼ˆå¦‚ "ag2502"ï¼‰ |
| `legs[].price` | Float | å½“å‰ä»·æ ¼ |
| `legs[].position` | Int | æŒä»“æ•°é‡ï¼ˆæ­£=å¤šå¤´ï¼Œè´Ÿ=ç©ºå¤´ï¼Œ0=å¹³ä»“ï¼‰ |
| `legs[].side` | String | æ–¹å‘ï¼š"long" / "short" / "flat" |

---

## 5. UI å±•ç¤ºæ•ˆæœ

### 5.1 å¹³ä»“çŠ¶æ€ï¼ˆåˆå§‹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ ä¸¤æ¡è…¿çŠ¶æ€                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ag2502   FLAT  â”‚ â”‚ â”‚ ag2504   FLAT   â”‚ â”‚
â”‚ â”‚                â”‚ â”‚ â”‚                 â”‚ â”‚
â”‚ â”‚ ä»·æ ¼: 5000.00  â”‚ â”‚ â”‚ ä»·æ ¼: 5050.00   â”‚ â”‚
â”‚ â”‚ æŒä»“: 0        â”‚ â”‚ â”‚ æŒä»“: 0         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æŒä»“çŠ¶æ€ï¼ˆå¤šç©ºé…å¯¹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ ä¸¤æ¡è…¿çŠ¶æ€                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ag2502   LONG  â”‚ â”‚ â”‚ ag2504   SHORT  â”‚ â”‚
â”‚ â”‚ (ç»¿è‰²èƒŒæ™¯)      â”‚ â”‚ â”‚ (çº¢è‰²èƒŒæ™¯)       â”‚ â”‚
â”‚ â”‚ ä»·æ ¼: 5050.00  â”‚ â”‚ â”‚ ä»·æ ¼: 5100.00   â”‚ â”‚
â”‚ â”‚ æŒä»“: +10      â”‚ â”‚ â”‚ æŒä»“: -10       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è§†è§‰ç‰¹æ€§

| æ–¹å‘ | è¾¹æ¡†é¢œè‰² | èƒŒæ™¯æ•ˆæœ | Badge é¢œè‰² |
|------|---------|---------|-----------|
| **LONG** | ç»¿è‰²ï¼ˆ#28a745ï¼‰ | ç»¿è‰²æ¸å˜ï¼ˆå·¦â†’é€æ˜ï¼‰ | ç»¿åº•ç™½å­— |
| **SHORT** | çº¢è‰²ï¼ˆ#dc3545ï¼‰ | çº¢è‰²æ¸å˜ï¼ˆå·¦â†’é€æ˜ï¼‰ | çº¢åº•ç™½å­— |
| **FLAT** | ç°è‰²ï¼ˆ#6c757dï¼‰ | çº¯ç™½èƒŒæ™¯ | ç°åº•ç™½å­— |

---

## 6. åŠŸèƒ½æµ‹è¯•

### 6.1 æµ‹è¯•åœºæ™¯

#### åœºæ™¯ 1: åˆå§‹çŠ¶æ€ï¼ˆæ— æŒä»“ï¼‰
```bash
# å¯åŠ¨ç­–ç•¥
./trader -config config/trader.yaml

# è®¿é—® UI
open web/control.html

# é¢„æœŸï¼šLegs Card æ˜¾ç¤ºä¸¤æ¡è…¿ï¼Œéƒ½æ˜¯ FLATï¼ŒæŒä»“=0
```

#### åœºæ™¯ 2: å¼€ä»“åï¼ˆæœ‰æŒä»“ï¼‰
```bash
# å‘é€æµ‹è¯•æ•°æ®è§¦å‘äº¤æ˜“ä¿¡å·
./continuous_market_sim.sh

# é¢„æœŸï¼š
# - Leg1 æ˜¾ç¤º LONGï¼ŒæŒä»“ +10ï¼ˆç»¿è‰²ï¼‰
# - Leg2 æ˜¾ç¤º SHORTï¼ŒæŒä»“ -10ï¼ˆçº¢è‰²ï¼‰
```

#### åœºæ™¯ 3: å¹³ä»“åï¼ˆå›åˆ°å¹³ä»“ï¼‰
```bash
# ç»§ç»­å‘é€æ•°æ®ç›´åˆ°è§¦å‘å‡ºåœºä¿¡å·

# é¢„æœŸï¼š
# - ä¸¤æ¡è…¿æ¢å¤ FLAT çŠ¶æ€
# - æŒä»“å½’é›¶
```

### 6.2 éªŒè¯æ£€æŸ¥ç‚¹

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|-------|---------|---------|
| **Legs æ˜¾ç¤º** | åˆ·æ–°é¡µé¢ | æ˜¾ç¤º"ğŸ¯ ä¸¤æ¡è…¿çŠ¶æ€"å¡ç‰‡ |
| **å“ç§ç¬¦å·** | æŸ¥çœ‹ symbol | æ˜¾ç¤º "ag2502", "ag2504" |
| **ä»·æ ¼æ˜¾ç¤º** | æŸ¥çœ‹ä»·æ ¼ | æ˜¾ç¤º2ä½å°æ•°ï¼Œå¦‚ "5050.00" |
| **æŒä»“æ•°é‡** | æŸ¥çœ‹æŒä»“ | æ­£æ•°=å¤šå¤´ï¼Œè´Ÿæ•°=ç©ºå¤´ |
| **æ–¹å‘æ ‡ç­¾** | æŸ¥çœ‹ badge | LONG=ç»¿è‰²ï¼ŒSHORT=çº¢è‰² |
| **èƒŒæ™¯é¢œè‰²** | è§†è§‰æ£€æŸ¥ | å¤šå¤´=ç»¿è‰²æ¸å˜ï¼Œç©ºå¤´=çº¢è‰²æ¸å˜ |
| **indicators è¿‡æ»¤** | æŸ¥çœ‹æŒ‡æ ‡å¡ç‰‡ | ä¸æ˜¾ç¤º leg1_price ç­‰ |

---

## 7. å…¼å®¹æ€§

### 7.1 ç­–ç•¥å…¼å®¹æ€§

| ç­–ç•¥ç±»å‹ | GetLegsInfo() | Legs æ˜¾ç¤º | è¯´æ˜ |
|---------|--------------|----------|------|
| **PairwiseArbStrategy** | âœ… å®ç° | âœ… æ˜¾ç¤º | é…å¯¹ç­–ç•¥ï¼Œå®Œæ•´æ”¯æŒ |
| **AggressiveStrategy** | âŒ æœªå®ç° | âšª éšè— | å•èµ„äº§ç­–ç•¥ï¼Œæ—  legs |
| **PassiveStrategy** | âŒ æœªå®ç° | âšª éšè— | å•èµ„äº§ç­–ç•¥ï¼Œæ—  legs |
| **HedgingStrategy** | âŒ æœªå®ç° | âšª éšè— | å¯¹å†²ç­–ç•¥ï¼ˆæœªæ¥å¯æ‰©å±•ï¼‰ |

**è®¾è®¡ç‰¹æ€§**:
- ä½¿ç”¨ duck typingï¼ˆæ¥å£æ£€æµ‹ï¼‰
- ä¸æ”¯æŒ GetLegsInfo() çš„ç­–ç•¥ä¸å—å½±å“
- Legs card åªåœ¨æœ‰æ•°æ®æ—¶æ˜¾ç¤ºï¼ˆ`display: none`ï¼‰

### 7.2 æµè§ˆå™¨å…¼å®¹æ€§

| æµè§ˆå™¨ | ç‰ˆæœ¬è¦æ±‚ | æ”¯æŒçŠ¶æ€ |
|-------|---------|---------|
| Chrome | 90+ | âœ… å®Œå…¨æ”¯æŒ |
| Firefox | 88+ | âœ… å®Œå…¨æ”¯æŒ |
| Safari | 14+ | âœ… å®Œå…¨æ”¯æŒ |
| Edge | 90+ | âœ… å®Œå…¨æ”¯æŒ |

**ä½¿ç”¨çš„ç°ä»£ç‰¹æ€§**:
- CSS Grid Layout
- CSS Custom Properties (å·²æœ‰)
- Array.forEach()
- Template Literals

---

## 8. æ€§èƒ½å½±å“

### 8.1 åç«¯æ€§èƒ½

| æ“ä½œ | å¢åŠ å¼€é”€ | å½±å“è¯„ä¼° |
|------|---------|---------|
| **GetLegsInfo()** | ~50ns | âšª å¯å¿½ç•¥ï¼ˆä»…è¯»å–4ä¸ªå­—æ®µï¼‰ |
| **API type assertion** | ~10ns | âšª å¯å¿½ç•¥ |
| **JSON åºåˆ—åŒ–** | +20 bytes | âšª å¯å¿½ç•¥ |

**æ€»ä½“**: æ€§èƒ½å½±å“æå°ï¼ˆ< 0.1Î¼sï¼‰

### 8.2 å‰ç«¯æ€§èƒ½

| æ“ä½œ | è€—æ—¶ | å½±å“è¯„ä¼° |
|------|-----|---------|
| **updateLegsDisplay()** | ~1ms | âšª å¯å¿½ç•¥ |
| **DOM æ“ä½œ** | ~0.5ms | âšª å¯å¿½ç•¥ï¼ˆä»…2ä¸ªå…ƒç´ ï¼‰ |
| **CSS æ¸²æŸ“** | ~1ms | âšª å¯å¿½ç•¥ |

**æ€»ä½“**: å‰ç«¯æ¸²æŸ“å¼€é”€æå°ï¼ˆ< 3msï¼‰

---

## 9. æœªæ¥æ‰©å±•

### 9.1 åŠŸèƒ½å¢å¼º

#### A. æ·»åŠ ç›ˆäºæ˜¾ç¤º
```go
type LegInfo struct {
    Symbol   string  `json:"symbol"`
    Price    float64 `json:"price"`
    Position int64   `json:"position"`
    Side     string  `json:"side"`
    // æ–°å¢
    UnrealizedPnL float64 `json:"unrealized_pnl"` // æœªå®ç°ç›ˆäº
    RealizedPnL   float64 `json:"realized_pnl"`   // å·²å®ç°ç›ˆäº
}
```

#### B. æ·»åŠ å…¥åœºä»·æ ¼
```go
type LegInfo struct {
    // ... ç°æœ‰å­—æ®µ
    EntryPrice float64 `json:"entry_price"` // å…¥åœºå‡ä»·
    PnLPercent float64 `json:"pnl_percent"` // ç›ˆäºç™¾åˆ†æ¯”
}
```

#### C. æ·»åŠ é£é™©æŒ‡æ ‡
```go
type LegInfo struct {
    // ... ç°æœ‰å­—æ®µ
    Exposure float64 `json:"exposure"` // é£é™©æ•å£
    Margin   float64 `json:"margin"`   // å ç”¨ä¿è¯é‡‘
}
```

### 9.2 æ‰©å±•åˆ°å…¶ä»–ç­–ç•¥

#### HedgingStrategy
```go
// å¦‚æœ HedgingStrategy ä¹Ÿä½¿ç”¨é…å¯¹å¯¹å†²
func (hs *HedgingStrategy) GetLegsInfo() []map[string]interface{} {
    return []map[string]interface{}{
        {
            "symbol":   hs.targetSymbol,
            "price":    hs.targetPrice,
            "position": hs.targetPosition,
            "side":     hs.getSide(hs.targetPosition),
        },
        {
            "symbol":   hs.hedgeSymbol,
            "price":    hs.hedgePrice,
            "position": hs.hedgePosition,
            "side":     hs.getSide(hs.hedgePosition),
        },
    }
}
```

### 9.3 UI å¢å¼º

#### A. æ·»åŠ å›¾è¡¨å±•ç¤º
```javascript
// ä½¿ç”¨ Chart.js æˆ– ECharts
function renderLegsChart(legs) {
    // ä»·æ ¼èµ°åŠ¿å›¾
    // æŒä»“å˜åŒ–å›¾
    // ç›ˆäºæ›²çº¿
}
```

#### B. æ·»åŠ è­¦æŠ¥åŠŸèƒ½
```javascript
// å½“æŒä»“ä¸å¹³è¡¡æ—¶æç¤º
if (Math.abs(leg1.position + leg2.position) > threshold) {
    showWarning('æŒä»“ä¸å¹³è¡¡ï¼');
}
```

---

## 10. æ€»ç»“

### 10.1 åŠŸèƒ½æˆæœ

| é¡¹ç›® | æˆæœ |
|------|------|
| **æ–°å¢ç­–ç•¥æ–¹æ³•** | `GetLegsInfo()` |
| **æ–°å¢ API ç±»å‹** | `LegInfo` struct |
| **æ–°å¢ API å­—æ®µ** | `StrategyStatusResponse.Legs` |
| **æ–°å¢ UI å¡ç‰‡** | Legs Cardï¼ˆ2åˆ—ç½‘æ ¼ï¼‰ |
| **æ–°å¢ JS å‡½æ•°** | `updateLegsDisplay()` |

### 10.2 æ”¹è¿›æ•ˆæœ

âœ… **å¯è§æ€§æå‡**:
- äº¤æ˜“å‘˜å¯ä»¥ä¸€çœ¼çœ‹åˆ°ä¸¤æ¡è…¿çš„çŠ¶æ€
- æ–¹å‘ç”¨é¢œè‰²åŒºåˆ†ï¼ˆç»¿=å¤šï¼Œçº¢=ç©ºï¼‰
- ç‹¬ç«‹å¡ç‰‡ï¼Œä¸ä¸æŒ‡æ ‡æ··æ·†

âœ… **å¯ç»´æŠ¤æ€§**:
- Duck typing è®¾è®¡ï¼Œå…¶ä»–ç­–ç•¥ä¸å—å½±å“
- å‰åç«¯è§£è€¦ï¼Œæ˜“äºæ‰©å±•
- CSS æ¨¡å—åŒ–ï¼Œæ˜“äºå®šåˆ¶

âœ… **ç”¨æˆ·ä½“éªŒ**:
- è§†è§‰æ¸…æ™°ï¼Œé¢œè‰²åŒºåˆ†æ˜æ˜¾
- å®æ—¶æ›´æ–°ï¼ˆ10ç§’è‡ªåŠ¨åˆ·æ–°ï¼‰
- å“åº”å¼å¸ƒå±€ï¼ˆé€‚é…ç§»åŠ¨ç«¯ï¼‰

### 10.3 ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¡Œæ•°å˜åŒ– |
|------|---------|---------|
| `pkg/strategy/pairwise_arb_strategy.go` | æ–°å¢æ–¹æ³• + ä¿®æ”¹ indicators | +39 è¡Œ |
| `pkg/trader/api.go` | æ–°å¢ç±»å‹ + ä¿®æ”¹ handleStatus | +33 è¡Œ |
| `web/control.html` | æ–°å¢ CSS + HTML + JS | +149 è¡Œ |

**æ€»è®¡**: +221 è¡Œä»£ç 

---

## 11. ç›¸å…³æ–‡æ¡£

- [golang_å¸‚åœºæ•°æ®æ¨¡æ‹Ÿæµ‹è¯•_2026-01-23-14_40.md](./golang_å¸‚åœºæ•°æ®æ¨¡æ‹Ÿæµ‹è¯•_2026-01-23-14_40.md) - åŸå§‹æµ‹è¯•æ–‡æ¡£
- [QuantlinkTrader_äº¤æ˜“æ¡ä»¶æ˜¾ç¤º_2026-01-23-12_59.md](./QuantlinkTrader_äº¤æ˜“æ¡ä»¶æ˜¾ç¤º_2026-01-23-12_59.md) - UI æ¡ä»¶æ˜¾ç¤ºåŠŸèƒ½
- [golang_Spreadåˆ†æå™¨å®ç°_2026-01-23-15_04.md](./golang_Spreadåˆ†æå™¨å®ç°_2026-01-23-15_04.md) - SpreadAnalyzer å®ç°

---

**å®æ–½äººå‘˜**: Claude Code
**ç”¨æˆ·éœ€æ±‚**: åœ¨ UI ä¸ŠæŠŠ2æ¡è…¿çš„è®¡ç®—ç»“æœåˆ†åˆ«æ˜¾ç¤ºï¼Œæ–¹ä¾¿äº¤æ˜“å‘˜è§‚å¯Ÿ
**å®æ–½å®Œæˆ**: 2026-01-23 17:30

---

## 12. ä½¿ç”¨ç¤ºä¾‹

### 12.1 å¯åŠ¨ç³»ç»Ÿ

```bash
# 1. ç¼–è¯‘
go build -o bin/trader ./cmd/trader

# 2. å¯åŠ¨ trader
./bin/trader -config config/trader.yaml

# 3. æ‰“å¼€ UI
open web/control.html
# æˆ–åœ¨æµè§ˆå™¨ä¸­è®¿é—® file:///path/to/web/control.html

# 4. é…ç½® API åœ°å€ï¼ˆå¦‚éœ€è¦ï¼‰
# åœ¨ UI ä¸­è¾“å…¥: localhost:9201

# 5. ç‚¹å‡»"è¿æ¥å¹¶åˆ·æ–°çŠ¶æ€"

# é¢„æœŸçœ‹åˆ°ï¼š
# - ğŸ¯ ä¸¤æ¡è…¿çŠ¶æ€å¡ç‰‡
# - æ˜¾ç¤º ag2502 å’Œ ag2504
# - åˆå§‹çŠ¶æ€éƒ½æ˜¯ FLAT
```

### 12.2 æ¨¡æ‹Ÿäº¤æ˜“æµ‹è¯•

```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæ¨¡æ‹Ÿå™¨
./continuous_market_sim.sh

# UI å°†å®æ—¶æ›´æ–°ï¼š
# 1. å½“ z-score è¶…è¿‡é˜ˆå€¼æ—¶ï¼š
#    - Leg1 (ag2502): LONG +10 (ç»¿è‰²)
#    - Leg2 (ag2504): SHORT -10 (çº¢è‰²)

# 2. å½“ z-score å›å½’å‡å€¼æ—¶ï¼š
#    - ä¸¤æ¡è…¿å¹³ä»“ï¼Œå›åˆ° FLAT çŠ¶æ€
```

### 12.3 æŸ¥çœ‹ API å“åº”

```bash
# è·å–å®Œæ•´çŠ¶æ€ï¼ˆåŒ…å« legsï¼‰
curl http://localhost:9201/api/v1/strategy/status | jq '.data.legs'

# é¢„æœŸè¾“å‡ºï¼š
# [
#   {
#     "symbol": "ag2502",
#     "price": 5050.0,
#     "position": 10,
#     "side": "long"
#   },
#   {
#     "symbol": "ag2504",
#     "price": 5100.0,
#     "position": -10,
#     "side": "short"
#   }
# ]
```

---

**æœ€åæ›´æ–°**: 2026-01-23 17:30
