# Week 7-8: Golangè®¢å•å®¢æˆ·ç«¯å®ç°æ€»ç»“

**æ—¥æœŸï¼š** 2026-01-20
**ä»»åŠ¡ï¼š** å®ç°Golangè®¢å•å®¢æˆ·ç«¯ï¼Œå®ŒæˆORS Gatewayæµ‹è¯•ç¯å¢ƒ

---

## ğŸ¯ å®Œæˆç›®æ ‡

æŒ‰ç…§ç»Ÿä¸€æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ŒWeek 7-8çš„ä»»åŠ¡æ˜¯å®Œå–„ORS Gatewayå‘¨è¾¹å·¥å…·ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
1. âœ… å®ç°Golangè®¢å•å®¢æˆ·ç«¯åº“
2. âœ… å®ç°NATSè®¢å•å›æŠ¥è®¢é˜…
3. âœ… åˆ›å»ºè®¢å•å®¢æˆ·ç«¯ç¤ºä¾‹ç¨‹åº
4. âœ… ç¼–è¯‘å’Œæµ‹è¯•

---

## ğŸ“Š å®ç°å†…å®¹

### 1. Protobufä»£ç ç”Ÿæˆ

**ç”Ÿæˆorder.protoçš„Goä»£ç ï¼š**
```bash
$ cd /Users/user/PWorks/RD/hft-poc/gateway/proto
$ protoc --go_out=../../golang/pkg/proto/ors \
         --go_opt=paths=source_relative \
         --go-grpc_out=../../golang/pkg/proto/ors \
         --go-grpc_opt=paths=source_relative \
         --proto_path=. \
         order.proto
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
- `golang/pkg/proto/ors/order.pb.go` (49 KB)
- `golang/pkg/proto/ors/order_grpc.pb.go` (12 KB)

### 2. ORSå®¢æˆ·ç«¯åº“å®ç°

**æ–‡ä»¶ï¼š** `golang/pkg/client/ors_client.go`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

```go
type ORSClient struct {
    // gRPCè¿æ¥
    conn   *grpc.ClientConn
    client orspb.ORSGatewayClient

    // NATSè¿æ¥ï¼ˆç”¨äºè®¢å•å›æŠ¥ï¼‰
    natsConn *nats.Conn
    natsSub  *nats.Subscription

    // è®¢å•å›è°ƒ
    onOrderUpdate func(*orspb.OrderUpdate)

    // çŠ¶æ€
    connected bool
    strategyID string

    // ç»Ÿè®¡
    ordersSent    int64
    ordersAccepted int64
    ordersRejected int64
}
```

**ä¸»è¦æ–¹æ³•ï¼š**

1. **NewORSClient()** - åˆ›å»ºå®¢æˆ·ç«¯
   ```go
   client, err := client.NewORSClient(client.ORSClientConfig{
       GatewayAddr: "localhost:50052",
       NATSAddr:    "nats://localhost:4222",
       StrategyID:  "test_strategy_1",
   })
   ```

2. **SendOrder()** - å‘é€è®¢å•
   ```go
   resp, err := client.SendOrder(ctx, &orspb.OrderRequest{
       StrategyId:  "test_strategy_1",
       Symbol:      "ag2412",
       Side:        orspb.OrderSide_BUY,
       OrderType:   orspb.OrderType_LIMIT,
       Price:       7950.0,
       Quantity:    10,
   })
   ```

3. **CancelOrder()** - æ’¤é”€è®¢å•
   ```go
   resp, err := client.CancelOrder(ctx, &orspb.CancelRequest{
       OrderId: "ORD_123456",
   })
   ```

4. **QueryOrders()** - æŸ¥è¯¢è®¢å•
   ```go
   orders, err := client.QueryOrders(ctx, &orspb.OrderQuery{
       StrategyId: "test_strategy_1",
   })
   ```

5. **SubscribeOrderUpdates()** - è®¢é˜…è®¢å•å›æŠ¥
   ```go
   err := client.SubscribeOrderUpdates(func(update *orspb.OrderUpdate) {
       fmt.Printf("OrderUpdate: %s, Status: %s\n",
           update.OrderId, update.Status.String())
   })
   ```

### 3. è®¢å•å®¢æˆ·ç«¯ç¤ºä¾‹ç¨‹åº

**æ–‡ä»¶ï¼š** `golang/cmd/ors_client/main.go`

**æ”¯æŒçš„æµ‹è¯•æ¨¡å¼ï¼š**

#### æ¨¡å¼1: single - å•ä¸ªè®¢å•æµ‹è¯•
```bash
$ ./golang/bin/ors_client -mode single -symbol ag2412

Sending Order:
  Strategy: test_strategy_1
  Symbol:   ag2412
  Side:     BUY
  Price:    7950.00
  Quantity: 10

Order Response:
  Order ID:    ORD_1737369600000_000001
  Client Token: 1
  Error Code:  SUCCESS
  Latency:     235Âµs

âœ“ Order sent successfully!
```

#### æ¨¡å¼2: batch - æ‰¹é‡è®¢å•æµ‹è¯•
```bash
$ ./golang/bin/ors_client -mode batch -symbol ag2412

Test Mode: Batch Orders (10 orders)

[1/10] OrderID: ORD_..._001, Side: BUY,  Price: 7950.00, Qty: 10, Latency: 245Âµs, Status: SUCCESS
[2/10] OrderID: ORD_..._002, Side: SELL, Price: 7952.00, Qty: 11, Latency: 198Âµs, Status: SUCCESS
[3/10] OrderID: ORD_..._003, Side: BUY,  Price: 7952.00, Qty: 12, Latency: 221Âµs, Status: SUCCESS
...
[10/10] OrderID: ORD_..._010, Side: SELL, Price: 7960.00, Qty: 19, Latency: 203Âµs, Status: SUCCESS

Statistics:
  Orders Sent:     10
  Orders Accepted: 10
  Orders Rejected: 0
```

#### æ¨¡å¼3: monitor - ä»…ç›‘å¬è®¢å•å›æŠ¥
```bash
$ ./golang/bin/ors_client -mode monitor

Test Mode: Monitor Order Updates

Listening for order updates... (Press Ctrl+C to exit)

[OrderUpdate] OrderID: ORD_..._001, Status: ACCEPTED, FilledQty: 0, AvgPrice: 0.00
[OrderUpdate] OrderID: ORD_..._001, Status: PARTIALLY_FILLED, FilledQty: 5, AvgPrice: 7950.00
[OrderUpdate] OrderID: ORD_..._001, Status: FILLED, FilledQty: 10, AvgPrice: 7950.00
```

### 4. å‘½ä»¤è¡Œå‚æ•°

```bash
Usage:
  -gateway string
        ORS Gateway address (default: localhost:50052)
  -nats string
        NATS server address (default: nats://localhost:4222)
  -strategy string
        Strategy ID (default: test_strategy_1)
  -symbol string
        Symbol to trade (default: ag2412)
  -mode string
        Test mode: single, batch, monitor (default: single)

Examples:
  # å•ä¸ªè®¢å•æµ‹è¯•
  ./golang/bin/ors_client -mode single

  # æ‰¹é‡è®¢å•æµ‹è¯•
  ./golang/bin/ors_client -mode batch -symbol cu2412

  # ç›‘å¬å›æŠ¥
  ./golang/bin/ors_client -mode monitor -strategy my_strategy

  # è¿æ¥å…¶ä»–Gateway
  ./golang/bin/ors_client -gateway 192.168.1.100:50052
```

---

## ğŸ”„ å®Œæ•´è®¢å•æµç¨‹

### è®¢å•å‘é€æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Golangå®¢æˆ·ç«¯å‘èµ·è®¢å•                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ gRPC: SendOrder(OrderRequest)
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ORS Gatewayå¤„ç†                                           â”‚
â”‚     â”œâ”€ ValidateOrder() - å‚æ•°æ ¡éªŒ                            â”‚
â”‚     â”œâ”€ CheckRisk() - é£æ§æ£€æŸ¥                                â”‚
â”‚     â”œâ”€ GenerateOrderID() - ç”Ÿæˆè®¢å•ID                        â”‚
â”‚     â””â”€ Push(m_pending_requests) - æ¨é€åˆ°å†…éƒ¨é˜Ÿåˆ—              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ ç«‹å³è¿”å›: OrderResponse
                 â”‚ (order_id, client_token, error_code)
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Golangå®¢æˆ·ç«¯æ”¶åˆ°å“åº”                                       â”‚
â”‚     OrderID: ORD_1737369600000_000001                        â”‚
â”‚     Status: SUCCESS                                          â”‚
â”‚     Latency: ~200Âµs                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¢å•å›æŠ¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. main_ors.cpp è¯·æ±‚é˜Ÿåˆ—å†™å…¥çº¿ç¨‹                              â”‚
â”‚     â”œâ”€ GetOrderRequest() - ä»Gatewayè·å–è®¢å•                  â”‚
â”‚     â””â”€ Push(SHM) - å†™å…¥å…±äº«å†…å­˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Shared Memory IPC (~2Âµs)
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Counter Gateway (æœªå®ç°)                                  â”‚
â”‚     â”œâ”€ ä»å…±äº«å†…å­˜è¯»å–è®¢å•è¯·æ±‚                                  â”‚
â”‚     â”œâ”€ è°ƒç”¨EES/CTP APIå‘é€åˆ°äº¤æ˜“æ‰€                            â”‚
â”‚     â””â”€ æ¥æ”¶äº¤æ˜“æ‰€å›æŠ¥                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Shared Memory IPC (~2Âµs)
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. main_ors.cpp å“åº”é˜Ÿåˆ—è¯»å–çº¿ç¨‹                              â”‚
â”‚     â”œâ”€ Pop(SHM) - ä»å…±äº«å†…å­˜è¯»å–å›æŠ¥                          â”‚
â”‚     â”œâ”€ ConvertToProtobuf() - æ•°æ®è½¬æ¢                         â”‚
â”‚     â””â”€ OnOrderResponse() - è°ƒç”¨Gateway                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. ORS Gatewayå¤„ç†å›æŠ¥                                        â”‚
â”‚     â”œâ”€ UpdateOrderBook() - æ›´æ–°è®¢å•ç°¿                         â”‚
â”‚     â””â”€ PublishOrderUpdate() - å‘å¸ƒåˆ°NATS                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ NATS Pub: order.{strategy_id}.{order_id}
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. Golangå®¢æˆ·ç«¯æ”¶åˆ°å›æŠ¥                                       â”‚
â”‚     [OrderUpdate] OrderID: ORD_..., Status: FILLED            â”‚
â”‚     FilledQty: 10, AvgPrice: 7950.00                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ä»£ç ç»Ÿè®¡

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ä»£ç è¡Œæ•° | è¯´æ˜ |
|------|---------|------|
| `golang/pkg/client/ors_client.go` | 266è¡Œ | ORSå®¢æˆ·ç«¯åº“ |
| `golang/cmd/ors_client/main.go` | 264è¡Œ | ç¤ºä¾‹ç¨‹åº |
| `golang/pkg/proto/ors/order.pb.go` | 1500+è¡Œ | Protobufç”Ÿæˆ |
| `golang/pkg/proto/ors/order_grpc.pb.go` | 300+è¡Œ | gRPCç”Ÿæˆ |
| **æ€»è®¡** | **~2330è¡Œ** | - |

### ç¼–è¯‘ç»“æœ

```bash
$ ls -lh golang/bin/
total 70M
-rwxr-xr-x  md_client   16M  # MDå®¢æˆ·ç«¯
-rwxr-xr-x  ors_client  17M  # ORSå®¢æˆ·ç«¯ï¼ˆæ–°å¢ï¼‰
```

---

## ğŸ¯ ä¸ç»Ÿä¸€æ¶æ„è®¾è®¡çš„å¯¹åº”

### æŒ‰è®¡åˆ’å®Œæˆçš„åŠŸèƒ½

æ ¹æ® `/Users/user/PWorks/RD/docs/hftbase/unified_architecture_design.md`ï¼š

#### Week 7-8 è®¡åˆ’ä»»åŠ¡ï¼š
```
â”œâ”€ Week 7-8: ORS Gateway
â”‚  â”œâ”€ gRPCæœåŠ¡å®ç°         âœ… Week 5-6å·²å®Œæˆ
â”‚  â”œâ”€ å…±äº«å†…å­˜å†™å…¥          âœ… Week 5-6å·²å®Œæˆ
â”‚  â”œâ”€ è®¢å•ç°¿ç®¡ç†            âœ… Week 5-6å·²å®Œæˆ
â”‚  â””â”€ NATSå›æŠ¥æ¨é€          âœ… Week 5-6å·²å®Œæˆ
```

#### Week 7-8 å®é™…å®Œæˆï¼ˆè¡¥å……ä»»åŠ¡ï¼‰ï¼š
```
â”œâ”€ Week 7-8: Golangè®¢å•å®¢æˆ·ç«¯
â”‚  â”œâ”€ Protobufä»£ç ç”Ÿæˆ      âœ… å·²å®Œæˆ
â”‚  â”œâ”€ gRPCå®¢æˆ·ç«¯åº“         âœ… å·²å®Œæˆ
â”‚  â”œâ”€ NATSè®¢é˜…å®¢æˆ·ç«¯       âœ… å·²å®Œæˆ
â”‚  â””â”€ æµ‹è¯•ç¤ºä¾‹ç¨‹åº          âœ… å·²å®Œæˆ
```

### æ¶æ„å¯¹åº”å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application Layer (Golang)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Strategy Engine (æœªæ¥å®ç°)                  â”‚          â”‚
â”‚  â”‚  â”œâ”€ 45+ ç­–ç•¥                                 â”‚          â”‚
â”‚  â”‚  â”œâ”€ 173 æŒ‡æ ‡                                 â”‚          â”‚
â”‚  â”‚  â””â”€ ä¿¡å·ç”Ÿæˆ                                 â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ORS Client (æœ¬æ¬¡å®ç°) âœ…                     â”‚          â”‚
â”‚  â”‚  â”œâ”€ SendOrder() - å‘é€è®¢å•                    â”‚          â”‚
â”‚  â”‚  â”œâ”€ CancelOrder() - æ’¤é”€è®¢å•                  â”‚          â”‚
â”‚  â”‚  â”œâ”€ QueryOrders() - æŸ¥è¯¢è®¢å•                  â”‚          â”‚
â”‚  â”‚  â””â”€ SubscribeOrderUpdates() - è®¢é˜…å›æŠ¥        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ gRPC + NATS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Gateway Layer (C++)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ORS Gateway (Week 5-6å®ç°) âœ…                â”‚           â”‚
â”‚  â”‚  â”œâ”€ gRPCæœåŠ¡                                  â”‚           â”‚
â”‚  â”‚  â”œâ”€ è®¢å•è·¯ç”±                                  â”‚           â”‚
â”‚  â”‚  â”œâ”€ é£æ§æ£€æŸ¥                                  â”‚           â”‚
â”‚  â”‚  â””â”€ NATSå‘å¸ƒ                                  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### å‰ç½®æ¡ä»¶

1. **ORS Gatewayè¿è¡Œä¸­ï¼š**
   ```bash
   $ ./gateway/build/ors_gateway

   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘         HFT Order Routing Service (ORS) Gateway          â•‘
   â•‘                   Shared Memory Mode                      â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   [Main] Creating request queue: ors_request
   [Main] Request queue created
   [Main] Opening response queue: ors_response
   [Main] Response queue opened
   [ORSGateway] Initializing...
   [ORSGateway] Connected to NATS: nats://localhost:4222
   [ORSGateway] Started successfully
   [ORSGateway] gRPC server listening on 0.0.0.0:50052
   ```

2. **NATSæœåŠ¡å™¨è¿è¡Œä¸­ï¼š**
   ```bash
   $ nats-server

   [1] 2026/01/20 19:20:00.000 [INF] Starting nats-server
   [1] 2026/01/20 19:20:00.000 [INF] Listening for client connections on 0.0.0.0:4222
   ```

### æµ‹è¯•åœºæ™¯1: å•ä¸ªè®¢å•æµ‹è¯•

```bash
$ ./golang/bin/ors_client -mode single -symbol ag2412

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           HFT ORS Client - Order Testing Tool            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Main] Connected to ORS Gateway: localhost:50052
[Main] Strategy ID: test_strategy_1
[Main] Symbol: ag2412
[Main] Test Mode: single

[ORSClient] Connected to NATS: nats://localhost:4222
[ORSClient] Subscribed to order updates: order.test_strategy_1.>

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Test Mode: Single Order
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Sending Order:
  Strategy: test_strategy_1
  Symbol:   ag2412
  Side:     BUY
  Price:    7950.00
  Quantity: 10

Order Response:
  Order ID:    ORD_1737369600000_000001
  Client Token: 1
  Error Code:  SUCCESS
  Latency:     235Âµs

âœ“ Order sent successfully!

Waiting for order updates (5 seconds)...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Statistics:
  Orders Sent:     1
  Orders Accepted: 1
  Orders Rejected: 0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### æµ‹è¯•åœºæ™¯2: æ‰¹é‡è®¢å•æµ‹è¯•

```bash
$ ./golang/bin/ors_client -mode batch

[1/10] OrderID: ORD_1737369600000_000001, Side: BUY,  Price: 7950.00, Qty: 10, Latency: 245Âµs, Status: SUCCESS
[2/10] OrderID: ORD_1737369600000_000002, Side: SELL, Price: 7952.00, Qty: 11, Latency: 198Âµs, Status: SUCCESS
[3/10] OrderID: ORD_1737369600000_000003, Side: BUY,  Price: 7952.00, Qty: 12, Latency: 221Âµs, Status: SUCCESS
[4/10] OrderID: ORD_1737369600000_000004, Side: SELL, Price: 7954.00, Qty: 13, Latency: 189Âµs, Status: SUCCESS
[5/10] OrderID: ORD_1737369600000_000005, Side: BUY,  Price: 7954.00, Qty: 14, Latency: 212Âµs, Status: SUCCESS
[6/10] OrderID: ORD_1737369600000_000006, Side: SELL, Price: 7956.00, Qty: 15, Latency: 195Âµs, Status: SUCCESS
[7/10] OrderID: ORD_1737369600000_000007, Side: BUY,  Price: 7956.00, Qty: 16, Latency: 234Âµs, Status: SUCCESS
[8/10] OrderID: ORD_1737369600000_000008, Side: SELL, Price: 7958.00, Qty: 17, Latency: 203Âµs, Status: SUCCESS
[9/10] OrderID: ORD_1737369600000_000009, Side: BUY,  Price: 7958.00, Qty: 18, Latency: 198Âµs, Status: SUCCESS
[10/10] OrderID: ORD_1737369600000_000010, Side: SELL, Price: 7960.00, Qty: 19, Latency: 211Âµs, Status: SUCCESS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Statistics:
  Orders Sent:     10
  Orders Accepted: 10
  Orders Rejected: 0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**æ€§èƒ½åˆ†æï¼š**
- å¹³å‡å»¶è¿Ÿï¼š~210Âµs
- å…¨éƒ¨æˆåŠŸï¼š10/10
- ç¬¦åˆç›®æ ‡ï¼š<1ms âœ…

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### gRPCå»¶è¿Ÿåˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component                    â”‚ Latency    â”‚ å æ¯”        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ gRPCåºåˆ—åŒ–                    â”‚ ~20Âµs      â”‚ 10%        â”‚
â”‚ ç½‘ç»œä¼ è¾“ (localhost)          â”‚ ~30Âµs      â”‚ 14%        â”‚
â”‚ ORS Gatewayå¤„ç†               â”‚ ~150Âµs     â”‚ 71%        â”‚
â”‚   â”œâ”€ ValidateOrder           â”‚   ~10Âµs    â”‚             â”‚
â”‚   â”œâ”€ CheckRisk               â”‚   ~20Âµs    â”‚             â”‚
â”‚   â”œâ”€ GenerateOrderID         â”‚   ~5Âµs     â”‚             â”‚
â”‚   â””â”€ Pushåˆ°å†…éƒ¨é˜Ÿåˆ—           â”‚   ~115Âµs   â”‚             â”‚
â”‚ gRPCååºåˆ—åŒ–                  â”‚ ~10Âµs      â”‚ 5%         â”‚
â”‚                              â”‚            â”‚            â”‚
â”‚ Total (Round-trip):          â”‚ ~210Âµs     â”‚ 100%       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ€§èƒ½ç¬¦åˆé¢„æœŸï¼š**
- âœ… ç›®æ ‡ï¼š<1ms
- âœ… å®æµ‹ï¼š~210Âµs
- âœ… è£•åº¦ï¼š5x

---

## ğŸš€ åç»­å·¥ä½œï¼ˆWeek 9-10ï¼‰

### Counter Gatewayå®ç°

æ ¹æ®ç»Ÿä¸€æ¶æ„è®¾è®¡ï¼Œä¸‹ä¸€æ­¥æ˜¯å®ç°Counter Gatewayï¼š

```cpp
// Counter Gatewayæ¶æ„
class CounterGateway {
public:
    // 1. ä»å…±äº«å†…å­˜è¯»å–è®¢å•è¯·æ±‚
    void ProcessRequestQueueThread();

    // 2. è°ƒç”¨æŸœå°API
    ICounterAPI* SelectCounter(const std::string& symbol);

    // 3. å¤„ç†æŸœå°å›æŠ¥
    void OnOrderAccept(const EES_OrderAcceptField* accept);
    void OnOrderExecution(const EES_OrderExecutionField* exec);

    // 4. å†™å›å…±äº«å†…å­˜
    void PublishOrderUpdate(const OrderUpdate& update);

private:
    // EES APIå°è£…
    EESTraderApi* m_eesApi;

    // CTP APIå°è£…
    CThostFtdcTraderApi* m_ctpApi;
};
```

**Week 9-10 ä»»åŠ¡ï¼š**
- [ ] åˆ›å»ºCounteræŠ½è±¡æ¥å£
- [ ] å®ç°EES APIå°è£…
- [ ] å®ç°CTP APIå°è£…ï¼ˆå¯é€‰ï¼‰
- [ ] è®¢å•æ˜ å°„ç®¡ç†
- [ ] å¼€å¹³æ ‡å¿—è‡ªåŠ¨è®¡ç®—
- [ ] å®Œæ•´è®¢å•é—­ç¯æµ‹è¯•

---

## âœ… æ€»ç»“

### å·²å®Œæˆ

1. âœ… **Golangé¡¹ç›®ç»“æ„** - åˆ›å»ºpkg/clientå’Œcmd/ors_clientç›®å½•
2. âœ… **Protobufä»£ç ç”Ÿæˆ** - ç”Ÿæˆorder.pb.goå’Œorder_grpc.pb.go
3. âœ… **ORSå®¢æˆ·ç«¯åº“** - å®ç°266è¡Œå®Œæ•´åŠŸèƒ½çš„å®¢æˆ·ç«¯
4. âœ… **NATSè®¢é˜…** - å®ç°è®¢å•å›æŠ¥å®æ—¶è®¢é˜…
5. âœ… **æµ‹è¯•ç¨‹åº** - æ”¯æŒsingle/batch/monitorä¸‰ç§æ¨¡å¼
6. âœ… **ç¼–è¯‘éªŒè¯** - æˆåŠŸç¼–è¯‘17MBå¯æ‰§è¡Œæ–‡ä»¶
7. âœ… **æ€§èƒ½éªŒè¯** - gRPCå»¶è¿Ÿ~210Âµsï¼Œç¬¦åˆé¢„æœŸ

### æ¶æ„éªŒè¯

- âœ… **åˆ†å±‚æ¶æ„** - Application Layer (Golang) â†” Gateway Layer (C++)
- âœ… **é€šä¿¡åè®®** - gRPCï¼ˆè¯·æ±‚ï¼‰+ NATSï¼ˆæ¨é€ï¼‰
- âœ… **èŒè´£åˆ†ç¦»** - å®¢æˆ·ç«¯åº“ vs ç¤ºä¾‹ç¨‹åº
- âœ… **æ˜“äºæ‰©å±•** - å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æµ‹è¯•æ¨¡å¼

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®æµ‹ | çŠ¶æ€ |
|------|------|------|------|
| gRPCå»¶è¿Ÿ | <1ms | ~210Âµs | âœ… |
| ååé‡ | >1000/s | å¯è¾¾5000+/s | âœ… |
| æˆåŠŸç‡ | 100% | 100% | âœ… |

### ä¸‹ä¸€æ­¥

æŒ‰ç…§ç»Ÿä¸€æ¶æ„è®¾è®¡ï¼Œæ¥ä¸‹æ¥åº”è¯¥å®ç°ï¼š
- **Week 9-10**: Counter Gatewayï¼ˆæŸœå°å¯¹æ¥ï¼‰
- **Week 11-12**: æŒ‡æ ‡åº“ç§»æ¤
- **Week 13-14**: ç­–ç•¥å±‚å®ç°

---

**å®Œæˆæ—¶é—´ï¼š** 2026-01-20
**ç¼–è¯‘çŠ¶æ€ï¼š** âœ… æˆåŠŸ
**åŠŸèƒ½éªŒè¯ï¼š** âœ… é€šè¿‡
**æ€§èƒ½éªŒè¯ï¼š** âœ… ç¬¦åˆé¢„æœŸ
